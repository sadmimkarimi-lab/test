<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨Ø§Ø²ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ÙÙˆÙ†Øª ÙˆØ²ÛŒØ±Ù…ØªÙ† -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn/Vazirmatn-font-face.css" rel="stylesheet" />

  <style>
    :root {
      --purple-main: #8b5cf6;
      --purple-dark: #6d28d9;
      --purple-soft: #f3e8ff;
      --bg-page: #f5f3ff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --radius-xl: 26px;
      --gold: #facc15;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      font-family: Vazirmatn, system-ui, sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #f5f3ff 45%, #e5e7eb 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 900px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(145deg, #faf5ff, #eef4ff);
    }

    .hidden { display: none; }

    /* HEADER */

    .app-header {
      background: linear-gradient(135deg, #8b5cf6, #ec4899);
      color: #fff;
      padding: 14px 18px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 0 14px 30px rgba(109, 40, 217, 0.45);
      border-radius: 0 0 24px 24px;
      position: relative;
      direction: rtl;
    }

    .header-main {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-texts {
      display: flex;
      flex-direction: column;
      gap: 4px;
      text-align: right;
    }

    .header-title {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: -0.03em;
    }

    .header-subtitle {
      font-size: 11px;
      opacity: 0.95;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .subtitle-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #bbf7d0;
      box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.45);
      animation: pulse 1.6s infinite;
    }

    @keyframes pulse {
      0%,100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.25); opacity: 0.7; }
    }

    .header-buttons-row {
      margin-top: 4px;
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    .header-side {
      font-size: 11px;
      opacity: 0.95;
      line-height: 1.7;
      text-align: left;
    }
    .header-side span { display: block; }

    .logo-wrap {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.45);
      flex-shrink: 0;
    }

    .logo-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .header-controls {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
    }

    .sound-btn {
      border: none;
      background: rgba(15,23,42,0.25);
      color: #f9fafb;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .sound-indicator {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
    }

    .sound-muted {
      background: #f97373;
    }

    .summary-btn {
      border: none;
      background: rgba(15,23,42,0.18);
      color: #e5e7eb;
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 11px;
      cursor: pointer;
      white-space: nowrap;
    }

    /* MAIN */

    .main {
      flex: 1;
      padding: 18px 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .game-card {
      background: #ffffff;
      border-radius: var(--radius-xl);
      padding: 16px 16px 18px;
      border: 1px solid #e5e7fb;
      box-shadow: 0 18px 40px rgba(148, 163, 184, 0.45);
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .top-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 2px;
      flex-wrap: wrap;
    }

    .score-text b { color: #22c55e; }

    .combo-pill {
      padding: 3px 9px;
      border-radius: 999px;
      background: #fef3c7;
      border: 1px solid #fde68a;
      font-size: 10px;
      color: #92400e;
      display: none;
      margin-top: 4px;
      align-self: flex-start;
    }

    .combo-pill.active {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      animation: pop 0.3s ease-out;
    }

    .record-pill {
      padding: 3px 10px;
      border-radius: 999px;
      background: #eff6ff;
      border: 1px solid #dbeafe;
      font-size: 11px;
      color: #1d4ed8;
      box-shadow: 0 4px 10px rgba(59, 130, 246, 0.25);
      white-space: nowrap;
    }

    .record-pill b {
      color: #1d4ed8;
    }

    .level-pill {
      border-radius: 999px;
      padding: 4px 10px;
      background: #f5f3ff;
      color: #6d28d9;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    .level-pill strong { font-size: 13px; }

    /* Ù…ÙˆØ¯ Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø± */

    .mode-box {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 3px;
      min-width: 120px;
    }

    .mode-btn {
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: #eef2ff;
      color: #111827;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(148, 163, 184, 0.45);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .mode-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(148, 163, 184, 0.6);
    }

    .mode-btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: 0 2px 6px rgba(148, 163, 184, 0.45);
    }

    .timer-label {
      font-size: 10px;
      color: #ef4444;
    }

    .mode-hint {
      font-size: 10px;
      color: #6b7280;
      text-align: right;
    }

    .rank-bar {
      margin-top: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 10px;
      color: #6b7280;
    }

    .rank-steps {
      flex: 1;
      display: flex;
      gap: 3px;
    }

    .rank-step {
      flex: 1;
      height: 5px;
      border-radius: 999px;
      background: #e5e7eb;
    }

    .rank-step.active {
      background: linear-gradient(90deg, #a855f7, #f97316);
    }

    .rank-labels {
      display: flex;
      justify-content: space_between;
      font-size: 9px;
      color: #9ca3af;
      margin-top: 2px;
    }

    .mission-line {
      font-size: 11px;
      color: #4b5563;
      margin-top: 8px;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      background: #f9fafb;
      border-radius: 14px;
      border: 1px dashed #e5e7eb;
      padding: 6px 10px;
    }

    .mission-badge {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px dashed #fb923c;
      background: #fff7ed;
      color: #c2410c;
      white-space: nowrap;
      margin-top: 1px;
    }

    .mission-done {
      border-color: #22c55e;
      background: #dcfce7;
      color: #15803d;
    }

    .mission-line span#missionText {
      flex: 1;
    }

    /* Ø±Ø¯ÛŒÙ ÙˆØ³Ø·: Ø·Ø§ÙˆÛŒØªØ§ + Ø³ØªÙˆÙ† Ø¨Ø§Ø²ÛŒ */

    .middle-row {
      margin-top: 8px;
      display: flex;
      align-items: flex-end;
      gap: 12px;
      direction: ltr;
    }

    .middle-right {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      direction: rtl;
    }

    /* Ú©Ù„Ù…Ø§Øª Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡ */

    .found-box {
      border-radius: 18px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 8px 10px;
      font-size: 12px;
    }

    .found-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
      color: #4b5563;
    }

    .found-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      min-height: 24px;
    }

    .found-item {
      padding: 3px 8px;
      border-radius: 999px;
      background: #ede9fe;
      border: 1px solid #ddd6fe;
      font-size: 11px;
      color: #4c1d95;
      animation: pop 0.25s ease-out;
    }

    @keyframes pop {
      0% { transform: scale(0.6); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Ú©Ù„Ù…Ù‡ Ø§ØµÙ„ÛŒ */

    .base-card {
      padding: 10px 10px 12px;
      border-radius: 18px;
      background: linear-gradient(145deg, #fdf2ff, #ede9fe);
      border: 1px solid #e9d5ff;
    }

    .base-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 12px;
      margin-bottom: 6px;
    }

    .shuffle-btn {
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: #fef3c7;
      color: #92400e;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(251, 191, 36, 0.35);
    }
    .shuffle-btn span.icon { font-size: 13px; }

    .base-letters {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }

    .letter-chip {
      min-width: 30px;
      padding: 7px 9px;
      border-radius: 999px;
      background: #7c3aed;
      color: #fff;
      font-weight: 700;
      font-size: 15px;
      box-shadow: 0 7px 16px rgba(124, 58, 237, 0.5);
    }

    .level-goal {
      font-size: 11px;
      color: #334155;
      text-align: center;
    }
    .level-goal b { color: #16a34a; }

    .status-text {
      margin-top: 4px;
      font-size: 11px;
      text-align: center;
      min-height: 18px;
      color: var(--text-muted);
    }
    .status-text.ok { color: #16a34a; }
    .status-text.err { color: #dc2626; }
    .shake { animation: shake 0.25s linear; }

    @keyframes shake {
      25% { transform: translateX(-2px); }
      50% { transform: translateX(2px); }
      75% { transform: translateX(-1px); }
      100% { transform: translateX(0); }
    }

    /* Ø·Ø§ÙˆÛŒØªØ§ Ú†Ù¾ */

    .tavita-wrapper {
      position: relative;
      width: 140px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-end;
      padding-bottom: 0;
    }

    .tavita-img {
      width: 100%;
      display: block;
    }

    .tavita-bubble {
      position: absolute;
      bottom: 100%;
      left: 0;
      transform: translateY(-8px);
      max-width: 220px;
      background: #ffffff;
      padding: 8px 10px;
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(148, 163, 184, 0.45);
      font-size: 11px;
      color: #111827;
      direction: rtl;
      text-align: right;
    }

    .tavita-bubble::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 18px;
      border-width: 8px;
      border-style: solid;
      border-color: #ffffff transparent transparent transparent;
    }

    .tavita-bubble b { color: #7c3aed; }

    /* ÙˆØ±ÙˆØ¯ÛŒ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */

    .word-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #c7d2fe;
      padding: 9px 12px;
      font-size: 13px;
      font-family: inherit;
      background: #e5e7ff;
      margin-top: 4px;
      box-shadow:
        inset 0 2px 4px rgba(15, 23, 42, 0.22),
        inset 0 0 0 1px rgba(199, 210, 254, 0.9);
      transition: box-shadow 0.12s ease-out,
                  background 0.12s ease-out,
                  border-color 0.12s ease-out;
    }

    .word-input:focus {
      outline: none;
      border-color: #7c3aed;
      background: #eef2ff;
      box-shadow:
        inset 0 2px 6px rgba(15, 23, 42, 0.28),
        inset 0 0 0 1px rgba(129, 140, 248, 0.9);
    }

    .primary-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, #8b5cf6, #a855f7);
      color: #ffffff;
      cursor: pointer;
      box-shadow: 0 14px 32px rgba(129, 140, 248, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
      transition: transform 0.08s, box-shadow 0.1s;
    }

    .primary-btn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(129, 140, 248, 0.6);
    }

    .primary-btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: 0 6px 14px rgba(148, 163, 184, 0.4);
    }

    .buttons-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-half {
      flex: 1;
      margin-top: 0;
    }

    .secondary-btn {
      background: #ffffff;
      color: #7c3aed;
      box-shadow: 0 4px 10px rgba(148, 163, 184, 0.35);
      border: 1px solid #e5e7ff;
      font-size: 13px;
      margin-top: 6px;
    }

    .hint-btn {
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 11px;
      background: #f1f5f9;
      color: #0f172a;
      border: 1px dashed #94a3b8;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      margin-top: 6px;
    }

    .hint-btn span.icon {
      font-size: 13px;
    }

    .rank-text {
      font-size: 11px;
      color: #4b5563;
    }
    .rank-text b { color: #8b5cf6; }

    .rank-text-bottom {
      margin-top: 6px;
      text-align: right;
    }

    .footer-tip {
      padding: 6px 14px 10px;
      font-size: 10px;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
      gap: 6px;
      border-top: 1px solid #e5e7eb;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px 24px 0 0;
    }
    .footer-tip b { color: #7c3aed; }

    /* ===== Ù¾Ø§Ù¾â€ŒØ¢Ù¾â€ŒÙ‡Ø§ ===== */

    .popup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.78);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 16px;
    }

    .popup-card {
      max-width: 360px;
      width: 100%;
      background: linear-gradient(145deg, #ffffff, #f5f3ff);
      border-radius: 24px;
      padding: 16px 16px 18px;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.6);
      text-align: center;
      border: 1px solid #e5e7ff;
    }

    .popup-img {
      width: 100%;
      max-width: 260px;
      margin: 0 auto 10px;
      display: block;
      border-radius: 20px;
    }

    .popup-text {
      font-size: 13px;
      color: #111827;
      line-height: 1.9;
      margin-bottom: 8px;
    }

    .popup-btn {
      width: 100%;
      margin-top: 8px;
    }

    /* Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù†Ø§Ù… */

    .name-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #e5e7ff;
      padding: 8px 12px;
      font-size: 13px;
      font-family: inherit;
      margin-top: 6px;
      text-align: center;
    }

    /* Ø®Ù„Ø§ØµÙ‡ */

    .summary-list {
      font-size: 12px;
      text-align: right;
      line-height: 1.8;
      margin-top: 6px;
      color: #111827;
    }

    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù‚Ù‡Ø±Ù…Ø§Ù†ÛŒ */

    @keyframes winGlow {
      0%   { transform: scale(1);   box-shadow: 0 0 0 rgba(250, 204, 21, 0.0); }
      50%  { transform: scale(1.02); box-shadow: 0 0 40px rgba(250, 204, 21, 0.9); }
      100% { transform: scale(1);   box-shadow: 0 0 0 rgba(250, 204, 21, 0.0); }
    }

    .win-glow {
      animation: winGlow 1.2s ease-in-out infinite;
      border: 2px solid var(--gold) !important;
    }

    @media (max-width: 640px) {
      .app-header { padding-inline: 12px; }
      .main { padding-inline: 10px; }
      .middle-row { gap: 8px; }
      .tavita-wrapper { width: 120px; }
      .tavita-bubble { max-width: 190px; }
      .header-main { align-items: flex-start; }
      .mode-box { min-width: 100px; }
    }

.hint-box{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:8px;
}

.hint-note-under-input{
  margin-top:8px;
  font-size:13px;
  font-weight:700;
  opacity:.95;
  text-align:center;
}

    
  </style>
<script src="https://developer.eitaa.com/eitaa-web-app.js"></script>
  
</head>
<body>
<div class="app">
  <!-- HEADER -->
  <header class="app-header">
    <div class="header-main">
      <div class="logo-wrap">
        <img src="https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-14-07-34-00-477.webp" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø·Ø§ÙˆÛŒØªØ§" />
      </div>
      <div class="header-texts">
        <div class="header-title">Ø¨Ø§Ø²ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§</div>
        <div class="header-subtitle">
          <div class="subtitle-dot"></div>
          <span>Ø§Ø² Ø­Ø±ÙˆÙ ÛŒÚ© Ú©Ù„Ù…Ù‡ØŒ Ú†Ù†Ø¯ Ú©Ù„Ù…Ù‡ Ø¨Ø³Ø§Ø²!</span>
        </div>
        <div class="header-buttons-row">
          <button id="helpBtn" class="summary-btn" type="button">
            Ø±Ø§Ù‡Ù†Ù…Ø§ 
          </button>

          <button id="summaryBtn" class="summary-btn" type="button">
            Ú©Ø§Ø±Ù†Ø§Ù…Ù‡
          </button>

          <!-- Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ Ú©Ø§Ù†Ø§Ù„ Ø·Ø§ÙˆÛŒØªØ§ -->
          <button id="tavitaChannelBtn" class="summary-btn" type="button">
            Ú©Ø§Ù†Ø§Ù„ Ø·Ø§ÙˆÛŒØªØ§
          </button>
        </div>
      </div>
    </div>

    <div class="header-controls">
      <button id="soundToggle" class="sound-btn" type="button">
        <div id="soundIndicator" class="sound-indicator"></div>
        <span id="soundLabel">ØµØ¯Ø§ Ø±ÙˆØ´Ù† Ø§Ø³Øª</span>
      </button>
      <div class="header-side">
        <span>Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ùˆ Ø¬Ø°Ø§Ø¨</span>
        <span>Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ Ø³Ø®Øªâ€ŒØªØ±</span>
        <span>Ø¨Ø±Ø§ÛŒ ØªÙ‚ÙˆÛŒØª Ø®Ù„Ø§Ù‚ÛŒØª Ùˆ Ú©Ù„Ù…Ø§Øª</span>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="main">
    <section class="game-card">
      <div class="top-row">
        <div class="score-text">Ø§Ù…ØªÛŒØ§Ø²: <b id="scoreText">0</b></div>

        <div class="record-pill">
          Ù…Ø±Ø­Ù„Ù‡ <b id="recordLevel">0</b> | Ø§Ù…ØªÛŒØ§Ø² <b id="recordScore">0</b>
        </div>

        <div class="mode-box">
          <button id="modeToggleBtn" class="mode-btn" type="button">
            ğŸ® Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
          </button>
          <div id="timerLabel" class="timer-label hidden">
            â±ï¸ Ø²Ù…Ø§Ù†: 0 Ø«Ø§Ù†ÛŒÙ‡
          </div>
          <div id="modeHint" class="mode-hint">
            Ø§Ù…ØªÛŒØ§Ø² Û²Ø¨Ø±Ø§Ø¨Ø±
          </div>
        </div>

        <div class="level-pill">
          Ù…Ø±Ø­Ù„Ù‡
          <strong id="levelNumber">1</strong>
          Ø§Ø²
          <span id="totalLevels">?</span>
        </div>
      </div>

      <div id="comboPill" class="combo-pill">
        ğŸ”¥ Ø¬Ø§ÛŒØ²Ù‡ Ã—<span id="comboValue">1</span>
      </div>

      <div class="rank-bar">
        <span>Ø±ØªØ¨Ù‡:</span>
        <div class="rank-steps">
          <div id="rankStep1" class="rank-step"></div>
          <div id="rankStep2" class="rank-step"></div>
          <div id="rankStep3" class="rank-step"></div>
          <div id="rankStep4" class="rank-step"></div>
        </div>
      </div>
      <div class="rank-labels">
        <span>Ø´Ø§Ú¯Ø±Ø¯</span>
        <span>Ø§Ø³ØªØ§Ø¯</span>
        <span>Ø§Ø³ØªØ§Ø¯Ø¨Ø²Ø±Ú¯</span>
        <span>Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ</span>
      </div>

      <!-- Ù…Ø§Ù…ÙˆØ±ÛŒØª -->
      <div id="missionLine" class="mission-line">
        <span class="mission-badge" id="missionBadge">Ù…Ø§Ù…ÙˆØ±ÛŒØª Ø§ÛŒÙ† Ø¨Ø®Ø´</span>
        <span id="missionText">Ø³Ø¹ÛŒ Ú©Ù† Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ø¨Ø¯ÙˆÙ† Ù‡ÛŒÚ† Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ Ø±Ø¯ Ú©Ù†ÛŒ.</span>
      </div>

      <!-- Ø·Ø§ÙˆÛŒØªØ§ + Ø³ØªÙˆÙ† Ø¨Ø§Ø²ÛŒ -->
      <div class="middle-row">
        <!-- Ø·Ø§ÙˆÛŒØªØ§ -->
        <div class="tavita-wrapper">
          <div class="tavita-bubble">
            <span id="tavitaText">
              Ø³Ù„Ø§Ù…! Ø¨ÛŒØ§ Ø§Ø² Ù‡Ù…ÛŒÙ† Ú©Ù„Ù…Ù‡ØŒ Ú†Ù†Ø¯ØªØ§ Ú©Ù„Ù…Ù‡Ù” ØªØ§Ø²Ù‡ Ø¯Ø±Ø¨ÛŒØ§Ø± Ø¨Ø¨ÛŒÙ†ÛŒÙ… Ú†ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ ğŸ˜âœ¨
            </span>
          </div>
          <img
            id="tavitaImage"
            class="tavita-img"
            src="https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-11-48-385.webp"
            alt="Ú©Ø§Ø±Ø§Ú©ØªØ± Ø·Ø§ÙˆÛŒØªØ§"
          />
        </div>

        <!-- Ø³ØªÙˆÙ† Ø±Ø§Ø³Øª -->
        <div class="middle-right">
          <div class="found-box">
            <div class="found-header">
              <span>Ú©Ù„Ù…Ø§Øª Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡:</span>
              <span><span id="foundCount">0</span> / <span id="neededCount">0</span></span>
            </div>
            <div id="foundList" class="found-list"></div>
          </div>

          <div class="base-card">
            <div class="base-header-row">
              <span>Ú©Ù„Ù…Ù‡Ù” Ø§ØµÙ„ÛŒ Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡:</span>
              <button id="shuffleBtn" class="shuffle-btn" type="button">
                <span>Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø­Ø±ÙˆÙ</span>
                <span class="icon">ğŸ”</span>
              </button>
            </div>
            <div id="baseWordLetters" class="base-letters"></div>
            <div id="levelGoal" class="level-goal">Ø¨Ø§ÛŒØ¯ <b>Û²</b> Ú©Ù„Ù…Ù‡Ù” Ø¯Ø±Ø³Øª Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒ.</div>
            <div id="statusText" class="status-text"></div>
          </div>
        </div>
      </div>

      <input
        id="wordInput"
        class="word-input"
        type="text"
        placeholder="Ú©Ù„Ù…Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø³Ø§Ø®ØªÛŒ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ Ùˆ Ø±ÙˆÛŒ Â«Ø«Ø¨Øª Ú©Ù„Ù…Ù‡Â» Ø¨Ø²Ù†..."
      />

<div class="hint-note-under-input">
  Ù†Ú©ØªÙ‡: Ù„Ø§Ø²Ù… Ù†ÛŒØ³Øª Ø§Ø² Ù‡Ù…Ù‡â€ŒÛŒ Ø­Ø±ÙˆÙ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ› Ú©Ù„Ù…Ù‡Ù” Ø¯Ø±Ø³Øª Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ú©Ù†.
</div>


      
      <div class="buttons-row">
        <button id="checkBtn" class="primary-btn btn-half" type="button">
          <span>â•</span>
          <span>Ø«Ø¨Øª Ú©Ù„Ù…Ù‡</span>
        </button>

        <button id="nextBtn" class="primary-btn btn-half" type="button" disabled>
          <span>â–¶ï¸</span>
          <span>Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯</span>
        </button>
      </div>

<div class="hint-box">
  <button id="hintBtn1" class="hint-btn" type="button">
    <span class="icon">ğŸ’¡</span>
    <span>Ø±Ø§Ù‡Ù†Ù…Ø§ Û± â€” Ù‡Ø²ÛŒÙ†Ù‡ Ûµ | Ù†Ù…Ø§ÛŒØ´ Û± Ø­Ø±Ù</span>
  </button>

  <button id="hintBtn2" class="hint-btn" type="button">
    <span class="icon">ğŸ’¡ğŸ’¡</span>
    <span>Ø±Ø§Ù‡Ù†Ù…Ø§ Û² â€” Ù‡Ø²ÛŒÙ†Ù‡ Û±Ûµ | Ù†Ù…Ø§ÛŒØ´ Û² Ø­Ø±Ù</span>
  </button>

  <button id="hintBtn3" class="hint-btn" type="button">
    <span class="icon">ğŸ”¢</span>
    <span>Ø±Ø§Ù‡Ù†Ù…Ø§ Û³ â€” Ù‡Ø²ÛŒÙ†Ù‡ Û±Ûµ | ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±ÙˆÙ</span>
  </button>
</div>

      <div id="rankText" class="rank-text rank-text-bottom">
        Ø§Ú¯Ø± Ù‡Ù…Ù‡Ù” Ù…Ø±Ø§Ø­Ù„ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø±Ø¯ Ú©Ù†ÛŒØŒ <b>Ø§Ø³ØªØ§Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§</b> Ù…ÛŒâ€ŒØ´ÙˆÛŒ ğŸ˜‰
      </div>

      <!-- Ø´Ø±ÙˆØ¹ Ø§Ø² Ø§ÙˆÙ„ Ø¨Ø§Ø²ÛŒ -->
      <button id="resetBtn" class="primary-btn secondary-btn" type="button">
        ğŸ”„ Ø´Ø±ÙˆØ¹ Ø§Ø² Ø§ÙˆÙ„ Ø¨Ø§Ø²ÛŒ
      </button>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="footer-tip">
    <div>
      Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· <b>Ø·Ø§ÙˆÛŒØªØ§</b> â€“ Ù‡Ø± ÙˆÙ‚Øª Ø®ÙˆØ§Ø³ØªÛŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø§Ø² Ø§ÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ú©Ù†ÛŒ Ùˆ Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ø²Ù†ÛŒ.
    </div>
  </footer>
</div>

<!-- ===== Ù¾Ø§Ù¾â€ŒØ¢Ù¾â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø§Ø­Ù„ ===== -->
<div id="popupOverlay" class="popup-overlay" style="display:none;">
  <div class="popup-card">
    <img id="popupImage" class="popup-img" src="" alt="Ù¾ÛŒØ§Ù… Ù…Ø±Ø­Ù„Ù‡ Ø·Ø§ÙˆÛŒØªØ§" />
    <p id="popupText" class="popup-text"></p>
    <button
      id="popupBtn"
      class="primary-btn popup-btn"
      type="button"
    >
      <span id="popupBtnLabel">Ø¨Ø§Ø´Ù‡ØŒ Ø¨Ø²Ù† Ø¨Ø±ÛŒÙ… ğŸš€</span>
    </button>
  </div>
</div>

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† -->
<div id="nameOverlay" class="popup-overlay" style="display:none;">
  <div class="popup-card">
    <p class="popup-text">
      Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ ğŸ’œ<br>
      Ø§Ø³Ù…Øª Ø±Ùˆ Ø¨Ú¯Ùˆ ØªØ§ ØªÙˆÛŒ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ù‡Ù…ÙˆÙ† ØµØ¯Ø§ Ø¨Ø²Ù†Ù…Øª:
    </p>
    <input
      id="playerNameInput"
      class="name-input"
      type="text"
      maxlength="20"
      placeholder="Ù…Ø«Ù„Ø§Ù‹ Ø±Ù‡Ø§"
    />
    <button id="saveNameBtn" class="primary-btn popup-btn" type="button">
      ØªØ§ÛŒÛŒØ¯ Ù†Ø§Ù… âœ…
    </button>
  </div>
</div>

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø®Ù„Ø§ØµÙ‡ Ù¾ÛŒØ´Ø±ÙØª -->
<div id="summaryOverlay" class="popup-overlay" style="display:none;">
  <div class="popup-card">
    <p class="popup-text">
      Ø®Ù„Ø§ØµÙ‡Ù” Ù¾ÛŒØ´Ø±ÙØªØª ØªØ§ Ø§Ù„Ø§Ù†:
    </p>
    <div class="summary-list">
      <div>Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†: <b id="summaryName">-</b></div>
      <div>Ù…Ø±Ø­Ù„Ù‡Ù” ÙØ¹Ù„ÛŒ: <b id="summaryLevel">-</b></div>
      <div>Ø§Ù…ØªÛŒØ§Ø² ÙØ¹Ù„ÛŒ: <b id="summaryScore">-</b></div>
      <div>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ú©Ù„Ù…Ø§ØªÛŒ Ú©Ù‡ Ø«Ø¨Øª Ú©Ø±Ø¯ÛŒ: <b id="summaryWords">-</b></div>
      <div>Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø¬ÙˆØ§ÛŒØ²ÛŒ Ú©Ù‡ Ø¯Ø§Ø´ØªÛŒ: <b id="summaryBestCombo">-</b></div>
      <div>Ø¨Ù‡ØªØ±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯: Ù…Ø±Ø­Ù„Ù‡ <b id="summaryBestLevel">-</b> | Ø§Ù…ØªÛŒØ§Ø² <b id="summaryBestScore">-</b></div>
    </div>
    <button id="summaryCloseBtn" class="primary-btn popup-btn" type="button">
      Ø¨Ø§Ø´Ù‡ØŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù… ğŸ¯
    </button>
  </div>
</div>

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
<div id="helpOverlay" class="popup-overlay" style="display:none;">
  <div class="popup-card">
<p class="popup-text">
ğŸ¯ <b>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø±ÛŒØ¹ Ø¨Ø§Ø²ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒÙ†Ø§</b><br><br>

â€¢ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² <b>Ø­Ø±ÙˆÙ Ú©Ù„Ù…Ù‡Ù” Ø§ØµÙ„ÛŒ</b>ØŒ Ú©Ù„Ù…Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø².<br>
â€¢ <b>Ù„Ø§Ø²Ù… Ù†ÛŒØ³Øª Ø§Ø² Ù‡Ù…Ù‡â€ŒÛŒ Ø­Ø±ÙˆÙ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒ</b>Ø› ÙÙ‚Ø· Ú©Ù„Ù…Ù‡Ù” Ø¯Ø±Ø³Øª Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ú©Ù†.<br>
â€¢ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„Ù…Ø§Øª Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡Ù” Ø¨Ø¹Ø¯ØŒ <b>Ø²ÛŒØ± Ú©Ù„Ù…Ù‡Ù” Ø§ØµÙ„ÛŒ</b> Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡.<br><br>

â€¢ Ù‡Ø± <b>Û±Ûµ Ù…Ø±Ø­Ù„Ù‡</b>ØŒ Ø¨Ø§Ø²ÛŒ Ø³Ø®Øªâ€ŒØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ <b>Ø±ØªØ¨Ù‡â€ŒØ§Øª</b> ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯:<br>
(Ø´Ø§Ú¯Ø±Ø¯ â†’ Ø§Ø³ØªØ§Ø¯ â†’ Ø§Ø³ØªØ§Ø¯Ø¨Ø²Ø±Ú¯ â†’ Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ)<br><br>

â€¢ Ø§Ú¯Ø± Ø¬Ø§ÛŒÛŒ Ú¯ÛŒØ± Ú©Ø±Ø¯ÛŒØŒ Ø§Ø² Ø¯Ú©Ù…Ù‡Ù” <b>Ø±Ø§Ù‡Ù†Ù…Ø§ ğŸ’¡</b> Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø›<br>
Ù‡Ø± Ø±Ø§Ù‡Ù†Ù…Ø§ Ù…Ù‚Ø¯Ø§Ø±ÛŒ Ø§Ø² <b>Ø§Ù…ØªÛŒØ§Ø²Øª</b> Ø±Ø§ Ú©Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯.<br><br>

â€¢ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ <b>Ø­Ø§Ù„Øª Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø± â±ï¸</b> Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒ:<br>
â€“ ÙÙ‚Ø· <b>Ù‚Ø¨Ù„ Ø§Ø² Ø«Ø¨Øª Ø§ÙˆÙ„ÛŒÙ† Ú©Ù„Ù…Ù‡</b><br>
â€“ Ø¯Ø± Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ ÙÙ‚Ø· <b>ÛŒÚ©â€ŒØ¨Ø§Ø±</b><br>
â€“ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ù„Ù…Ù‡ <b>Û±Û° Ø«Ø§Ù†ÛŒÙ‡</b> Ø²Ù…Ø§Ù† Ø¯Ø§Ø±ÛŒ<br>
â€“ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ Ø¯Ø± Ø§ÛŒÙ† Ø­Ø§Ù„Øª <b>Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø±</b> Ø­Ø³Ø§Ø¨ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ ğŸ”¥<br><br>

â€¢ Ø§Ú¯Ø± ØªØ§ <b>Ù…Ø±Ø­Ù„Ù‡Ù” Û¶Û°</b> Ù¾ÛŒØ´ Ø¨Ø±ÙˆÛŒØŒ Ù‚Ù‡Ø±Ù…Ø§Ù† Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÛŒ!<br>
Ø§Ø² ØµÙØ­Ù‡Ù” Ø¨Ø§Ø²ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ† Ø¨Ú¯ÛŒØ± Ùˆ Ø¨Ø±Ø§ÛŒ Ø·Ø§ÙˆÛŒÙ†Ø§ Ø¨ÙØ±Ø³Øª ğŸ
</p>
    <button id="helpCloseBtn" class="primary-btn popup-btn" type="button">
      ÙÙ‡Ù…ÛŒØ¯Ù…ØŒ Ø¨Ø±ÛŒÙ… Ø¨Ø§Ø²ÛŒ Ú©Ù†ÛŒÙ… ğŸ®
    </button>
  </div>
</div>

<!-- ØµØ¯Ø§Ù‡Ø§ÛŒ Ø§ÙÚ©Øª Ú©ÙˆØªØ§Ù‡ -->
<audio id="soundClick"   src="https://cdnfa.com/irangiah/a9be/uploads/tavita/ui-click-97915.mp3" preload="auto"></audio>
<!-- Ø¯Ú©Ù…Ù‡ Ø«Ø¨Øª Ú©Ù„Ù…Ù‡ (Ø¯ÛŒÙ„ÛŒÙ†Ú¯) -->
<audio id="soundCorrect" src="https://cdnfa.com/irangiah/a9be/uploads/tavita/level-up-191997.mp3" preload="auto"></audio>
<!-- Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ -->
<audio id="soundLevelUp" src="https://cdnfa.com/irangiah/a9be/uploads/tavita/success-1-6297.mp3" preload="auto"></audio>
<!-- Ù‚Ù‡Ø±Ù…Ø§Ù† Ø´Ø¯Ù† -->
<audio id="soundFinal"   src="https://cdnfa.com/irangiah/a9be/uploads/tavita/success-fanfare-trumpets-6185.mp3" preload="auto"></audio>

<audio id="soundTimer"   src="https://cdnfa.com/irangiah/a9be/uploads/new6/new7/analog-timer-74998.mp3" preload="auto" loop></audio>
<audio id="soundNoWord"  src="https://cdnfa.com/irangiah/a9be/uploads/new6/new7/elevenlabs-2025-11-16t04-57-46-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>

<!-- ØµØ¯Ø§Ù‡Ø§ÛŒ Ú¯ÙˆÛŒÙ†Ø¯Ù‡ (Ø§Ù„Ù‡Ù‡) -->
<audio id="voiceIntro"      src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-37-50-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>
<audio id="voiceLevelDone"  src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-27-15-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>
<audio id="voiceRestart"    src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-35-11-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>
<audio id="voiceCantBuild"  src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-24-27-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>
<audio id="voiceNextLevel"  src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-32-57-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>
<audio id="voiceTimeUp"     src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-31-19-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>
<audio id="voiceRepeat"     src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-26-25-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>
<audio id="voiceModeOn"     src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-30-13-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>
<audio id="voiceChampion"   src="https://cdnfa.com/irangiah/a9be/uploads/new6/new9/elevenlabs-2025-11-16t05-39-34-mark-convoai-pvc-sp100-s50-sb75-v3.mp3" preload="auto"></audio>

<script>
  // Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÙÙ†Ú© + Ø¹Ú©Ø³ Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ÛŒÛŒ
  const TAVITA_SETS = {
    student: {
      explain: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-11-48-385.webp",
      clap:    "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-55-01-893.webp",
      medal:   "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-54-36-751.webp",
      sad:     "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-55-31-486.webp",
      shuffle: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-07-01-53-612.webp"
    },
    master: {
      explain: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-12-18-450.webp",
      clap:    "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-56-36-511.webp",
      medal:   "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-56-14-607.webp",
      sad:     "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-55-52-957.webp",
      shuffle: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-07-04-56-352.webp"
    },
    grand: {
      explain: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-12-45-646.webp",
      clap:    "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-59-27-132.webp",
      medal:   "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-58-46-211.webp",
      sad:     "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-58-03-525.webp",
      shuffle: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-07-03-48-496.webp"
    },
    legend: {
      explain: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-05-13-10-261.webp",
      clap:    "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-06-02-26-146.webp",
      medal:   "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-06-04-13-059.webp",
      sad:     "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-06-01-08-979.webp",
      shuffle: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-16-07-06-12-061.webp"
    }
  };

  const POPUPS = {
    intro: {
      img: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-14-17-57-39-127.webp",
      text: "Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ ğŸ’œ Ø§Ù„Ø§Ù† Ø´Ø§Ú¯Ø±Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ù‡Ø³ØªÛŒ. Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø±Ùˆ Ø±Ø¯ Ú©Ù†ÛŒØŒ Ø§Ø³ØªØ§Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ù…ÛŒâ€ŒØ´ÛŒ!"
    },
    stage1: {
      img: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-14-17-58-08-424.webp",
      text: "ØªØ¨Ø±ÛŒÚ© Ù…ÛŒâ€ŒÚ¯Ù… ğŸ‰ Ø´Ù…Ø§ Ø§Ø³ØªØ§Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ø´Ø¯ÛŒ. ØªÙ„Ø§Ø´ Ú©Ù† ØªØ§ Ø¨Ù‡ Ø§Ø³ØªØ§Ø¯ Ø¨Ø²Ø±Ú¯ÛŒ Ø¨Ø±Ø³ÛŒ!"
    },
    stage2: {
      img: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-14-17-58-47-930.webp",
      text: "ØªØ¨Ø±ÛŒÚ© Ù…ÛŒâ€ŒÚ¯Ù… ğŸ‰ Ø´Ù…Ø§ Ø§Ù„Ø§Ù† Ø§Ø³ØªØ§Ø¯ Ø¨Ø²Ø±Ú¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ù‡Ø³ØªÛŒ... ØªÙ„Ø§Ø´ Ú©Ù† Ú©Ù‡ Ø¨Ø´ÛŒ Ø§Ø³ØªØ§Ø¯ Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§!"
    },
    stage3: {
      img: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-14-17-59-31-841.webp",
      text: "ØªØ¨Ø±ÛŒÚ© ğŸ‰ Ø´Ù…Ø§ Ø§Ø³ØªØ§Ø¯ Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ø´Ø¯ÛŒ. ØªÙ„Ø§Ø´ Ú©Ù† Ú©Ù‡ Ù‚Ù‡Ø±Ù…Ø§Ù† Ø¨Ø§Ø²ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ø¨Ø´ÛŒ!"
    },
    final: {
      img: "https://cdnfa.com/irangiah/a9be/uploads/bazi/picsart-25-11-14-18-00-12-353.webp",
      text: "Ø¨Ø³ÛŒØ§Ø± ØªØ¨Ø±ÛŒÚ© Ù…ÛŒâ€ŒÚ¯Ù… ğŸ‰ Ø´Ù…Ø§ Ù‚Ù‡Ø±Ù…Ø§Ù† Ø¨Ø§Ø²ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ø´Ø¯ÛŒ! Ø§Ø² Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ± Ùˆ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ú©Ø§Ù†Ø§Ù„ Ø·Ø§ÙˆÛŒØªØ§ Ø¨ÙØ±Ø³Øª Ùˆ Ø¬Ø§ÛŒØ²Ù‡Ù” Ø¨Ø²Ø±Ú¯ Ø±Ùˆ Ø¨Ú¯ÛŒØ± ğŸ˜ğŸ"
    }
  };

  const levels = [
    { base: "Ø§ÛŒØ±Ø§Ù†", answers: ["Ø§ÛŒØ±Ø§Ù†", "Ø±Ø§ÛŒ"], needed: 2 },
    { base: "Ø§ÛŒÙ…Ø§Ù†", answers: ["ÛŒÙ…Ù†", "Ù†Ø§Ù…"], needed: 2 },
    { base: "Ø´Ù‡Ø§Ø¯Øª", answers: ["Ø´Ù‡Ø¯", "Ø´Ù‡Ø¯Ø§"], needed: 2 },
    { base: "Ø§Ø®Ù„Ø§Ù‚", answers: ["Ù‚Ø§Ù„", "Ø§Ø®Ù„Ø§Ù‚"], needed: 2 },
    { base: "Ø¹Ø±ÙØ§Ù†", answers: ["Ø¹Ø±ÙØ§Ù†", "Ø¹Ø±Ù"], needed: 2 },
    { base: "Ø­Ú©Ù…Øª", answers: ["Ø­Ú©Ù…", "ØªØ­Ú©Ù…"], needed: 2 },
    { base: "ØªØ§Ø±ÛŒØ®", answers: ["Ø®Ø§Ø±", "ØªØ§Ø±ÛŒØ®"], needed: 2 },
    { base: "Ù…Ø³Ø¬Ø¯", answers: ["Ù…Ø³", "Ù…Ø³Ø¬Ø¯"], needed: 2 },
    { base: "Ù…Ø­Ø±Ø§Ø¨", answers: ["Ù…Ø­Ø±Ø§Ø¨", "Ø­Ø±Ù…"], needed: 2 },
    { base: "ÙØ±Ù‡Ù†Ú¯", answers: ["ÙØ±Ù‡Ù†Ú¯", "Ù‡Ù†Ø±"], needed: 2 },
    { base: "Ø¹Ø¯Ø§Ù„Øª", answers: ["Ø¹Ø¯Ø§Ù„Øª", "Ø¹Ù„Øª"], needed: 2 },
    { base: "Ø¯Ø¹Ø§Ú¯Ùˆ", answers: ["ÙˆØ¯Ø§Ø¹", "Ø¯Ø¹Ø§"], needed: 2 },
    { base: "Ø§ÙÙ„Ø§Ú©", answers: ["Ú©Ù„Ø§Ù", "ÙÙ„Ú©"], needed: 2 },
    { base: "Ø§Ù‚ÙˆØ§Ù…", answers: ["Ù‚ÙˆÙ…", "ÙˆØ§Ù…"], needed: 2 },
    { base: "Ø§Ø¬Ù†Ø§Ø³", answers: ["Ø¬Ù†Ø³", "Ù†Ø³Ø§Ø¬"], needed: 2 },

    { base: "Ø·Ù‡Ø§Ø±Øª", answers: ["Ø·Ù‡Ø§Ø±Øª", "ØªØ§Ø±", "Ø·Ø§Ù‡Ø±"], needed: 3 },
    { base: "Ø³Ø±ÙˆØ§Ù†", answers: ["Ø³Ø±Ùˆ", "Ø³Ø±ÙˆØ§Ù†", "ÙˆØ§Ù†"], needed: 3 },
    { base: "Ù…Ù„Ú©ÙˆØª", answers: ["Ú©Ù„Ù…", "Ù…Ù„Ú©ÙˆØª", "Ù…Ù„Ú©"], needed: 3 },
    { base: "Ù†ÙˆØ´ØªÙ†", answers: ["Ù†ÙˆØ´ØªÙ†", "Ø´Ù†", "Ù†Ùˆ"], needed: 3 },
    { base: "Ú©ØªØ§Ø¨Øª", answers: ["Ú©ØªØ¨", "ØªØ§Ø¨", "Ú©ØªØ§Ø¨"], needed: 3 },
    { base: "Ù‡Ø¯Ø§ÛŒØª", answers: ["Ù‡Ø¯Ø§ÛŒØª", "ÛŒØ¯", "Ù‡Ø§Ø¯ÛŒ"], needed: 3 },
    { base: "Ø±ÙØ§Ù‚Øª", answers: ["Ø±ÙØ§Ù‚Øª", "Ù‚Ø§Ù", "ÙÙ‚Ø±"], needed: 3 },
    { base: "ØµÙ†Ø§Ø¹Øª", answers: ["ØµÙ†Ø§Ø¹Øª", "ØµÙ†Ø¹", "ØµÙ†Ø¹Øª"], needed: 3 },
    { base: "Ú©Ø±Ø§Ù…Øª", answers: ["Ù…Ø§Ø±", "Ú©Ø±Ø§Ù…Øª", "Ú©Ø±Ù…"], needed: 3 },
    { base: "Ø§Ù‡Ù…ÛŒØª", answers: ["Ø§Ù‡Ù…ÛŒØª", "Ù‡Ù…ÛŒØª", "ØªÛŒÙ…"], needed: 3 },
    { base: "ØªÙˆØ§Ù†Ø§", answers: ["ÙˆØ§Ù†Øª", "Ù†Ø§Ùˆ", "ØªÙˆØ§Ù†"], needed: 3 },
    { base: "Ù…Ø¨ØªÚ©Ø±", answers: ["Ù…Ø¨ØªÚ©Ø±", "Ú©Ù…Ø±", "Ø¨Ú©Ø±"], needed: 3 },
    { base: "Ù…ØªØ®ØµØµ", answers: ["Ù…ØªØ®ØµØµ", "Ø®ØªÙ…", "ØªØ®ØµØµ"], needed: 3 },
    { base: "Ù¾Ø§Ø±Ú†Ù‡", answers: ["Ù¾Ø§Ø±Ú†Ù‡", "Ù‡Ø§Ø±", "Ù¾Ø§Ø±Ú†"], needed: 3 },
    { base: "Ú©ØªØ§Ù†ÛŒ", answers: ["ØªØ§Ú©", "ØªÛŒÚ©", "Ú©ØªØ§Ù†"], needed: 3 },

    { base: "Ù¾ÛŒØ§Ù…Ø¨Ø±", answers: ["ÛŒØ§Ø±", "Ù¾ÛŒØ±", "Ù¾ÛŒØ§Ù…Ø¨Ø±", "Ù¾ÛŒØ§Ù…"], needed: 4 },
    { base: "Ø¯Ø§Ù†Ø´Ù…Ù†Ø¯", answers: ["Ø¯Ø§Ù†Ø´Ù…Ù†Ø¯", "Ù†Ø§Ù…", "Ø¯Ø´Ù…Ù†", "Ø¯Ø§Ù†Ø´"], needed: 4 },
    { base: "Ù‡Ø³ØªÙ‡ Ø§ÛŒ", answers: ["Ù‡Ø³ØªÙ‡ Ø§ÛŒ", "Ø§Ù‡Ø³ØªÙ‡", "Ù‡Ø§Ø³Øª", "Ù‡Ø³ØªÙ‡"], needed: 4 },
    { base: "ÙØ±Ù‡Ù†Ú¯ÛŒ", answers: ["Ø±Ù†Ú¯", "Ù†Ù‡Ø±", "Ú¯Ù‡Ø±", "ÙØ±Ù‡Ù†Ú¯"], needed: 4 },
    { base: "Ø®ÙˆØ±Ø´ÛŒØ¯", answers: ["Ø®ÙˆØ±Ø´ÛŒØ¯", "Ø´ÛŒØ±", "Ø´ÙˆØ±", "Ø±Ø´ÛŒØ¯"], needed: 4 },
    { base: "Ø§Ø³Ø·ÙˆØ±Ù‡", answers: ["Ø§Ø³Ø·ÙˆØ±Ù‡", "Ø·Ø§Ù‡Ø±", "Ø³ÙˆØ±Ù‡", "Ø³Ø·Ø±"], needed: 4 },
    { base: "ØªÙˆØ§Ù†Ù…Ù†Ø¯", answers: ["ØªÙˆØ§Ù†Ù…Ù†Ø¯", "Ù†Ø§Ø¯Ù…", "Ù…Ù†Øª", "ØªÙˆØ§Ù†"], needed: 4 },
    { base: "Ø¨Ø§Ø³ØªØ§Ù†", answers: ["Ø§Ø³Ø¨", "Ø¨Ø§Ø³ØªØ§Ù†", "Ø³Ø§ØªÙ†", "Ø§Ø³ØªØ§Ù†"], needed: 4 },
    { base: "Ù‚Ù‡Ø±Ù…Ø§Ù†", answers: ["Ù†Ø§Ù…Ù‡", "Ù‚Ù‡Ø±Ù…Ø§Ù†", "Ù‚Ø±Ù…Ù‡", "Ù…Ø§Ù‡Ø±"], needed: 4 },
    { base: "Ù…Ù†ØµÙˆØ±ÛŒ", answers: ["Ù…Ù†ÙˆØ±", "Ù…Ù†ØµÙˆØ±", "Ù†ÙˆØ±", "Ù…ØµØ±"], needed: 4 },
    { base: "Ú©Ø§Ø´Ø§Ù†Ù‡", answers: ["Ú©Ø§Ø´", "Ø´Ø§Ù†Ù‡", "Ø§Ø´Ú©", "Ú©Ø§Ø´Ø§Ù†"], needed: 4 },
    { base: "Ø§Ø±Ø²Ø§Ù†ÛŒ", answers: ["Ø²Ø§Ø±", "Ø§Ø±Ø²Ø§Ù†", "Ø±Ø²ÛŒÙ†", "Ø§Ø±Ø²"], needed: 4 },
    { base: "Ù…Ø¹Ù†ÙˆÛŒØª", answers: ["Ù…Ø¹Ù†ÙˆÛŒØª", "Ù†ÛŒØª", "Ù…Ù†Ùˆ", "Ù…Ø¹Ù†ÛŒ"], needed: 4 },
    { base: "Ø¢Ø²Ø§Ø¯Ú¯Ø§Ù†", answers: ["Ø²Ù†Ú¯", "Ø¢Ø²Ø§Ø¯Ú¯Ø§Ù†", "Ú¯Ø§Ø²", "Ø¢Ø²Ø§Ø¯"], needed: 4 },
    { base: "Ø®Ø¯Ø§Ø¨Ø§ÙˆØ±", answers: ["Ø¯ÙˆØ±", "Ø®Ø¯Ø§Ø¨Ø§ÙˆØ±", "Ø®Ø§ÙˆØ±", "Ø¨Ø§ÙˆØ±"], needed: 4 },

    { base: "ÙØ±Ù…Ø§Ù†Ø¯Ù‡", answers: ["Ù…Ø§Ù‡Ø±", "Ù…Ø§Ù†Ø¯Ù‡", "ÙØ±Ù…Ø§Ù†Ø¯Ù‡", "Ù†Ø±Ù…Ù‡", "Ø¯Ø±Ù…Ø§Ù†", "ÙØ±Ù…Ø§Ù†"], needed: 6 },
    { base: "Ø§ÛŒØ±Ø§Ù†ÛŒØ§Ù†", answers: ["Ø§ÛŒØ±Ø§Ù†", "Ø±Ø§Ù†Ø§", "Ù†Ø§Ù†", "Ø§ÛŒØ±Ø§Ù†ÛŒØ§Ù†", "ÛŒØ§Ø±ÛŒ", "Ø§ÛŒØ±Ø§Ù†ÛŒ"], needed: 6 },
    { base: "Ù¾ÛŒØ§Ù…Ø¨Ø±Ø§Ù†", answers: ["Ù†Ø§Ù…ÛŒ", "Ù…Ø¨Ø±Ø§", "Ø¨ÛŒÙ…", "Ù¾ÛŒØ±Ø§Ù†", "Ù¾ÛŒØ§Ù…", "Ù¾ÛŒØ§Ù…Ø¨Ø±"], needed: 6 },
    { base: "Ø¹Ù„ÙˆÙ… Ù‚Ø±Ø¢Ù†ÛŒ", answers: ["Ù†ÙˆØ±", "Ø¹Ù„ÙˆÙ… Ù‚Ø±Ø¢Ù†ÛŒ", "Ù‚Ø±ÛŒÙ†", "Ù…ÙˆÙ‚Ø±", "Ø¹Ù„Ù…", "Ù‚Ø±Ø¢Ù†"], needed: 6 },
    { base: "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", answers: ["Ø´ÙˆÙ…", "Ø¹ÛŒÙ†", "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", "Ø´Ù…Ø¹", "Ù‡ÙˆØ´", "Ù…ØµÙ†ÙˆØ¹"], needed: 6 },
    { base: "ÙØ±Ù‡Ù†Ú¯Ø³ØªØ§Ù†", answers: ["ÙØ±Ù‡Ù†Ú¯Ø³ØªØ§Ù†", "Ø³Ù†Ú¯Ø±", "ØªØ§Ø³", "Ø³Ø±Ù‡Ù†Ú¯", "Ù‡Ù†Ø±Ø³ØªØ§Ù†", "ÙØ±Ù‡Ù†Ú¯"], needed: 6 },
    { base: "ØªÙ…Ø¯Ù† Ø³Ø§Ø²ÛŒ", answers: ["Ù…ÛŒØ¯Ø§Ù†", "Ø³ÛŒÙ…Ø§", "Ø³Ø§Ù†Øª", "Ø²ÛŒÙ†Øª", "ØªÙ…Ø¯Ù†", "ØªÙ…Ø¯Ù† Ø³Ø§Ø²ÛŒ"], needed: 6 },
    { base: "Ø¯Ø§Ù†Ø´ Ù¾Ú˜ÙˆÙ‡ÛŒ", answers: ["Ø´ÛŒÙˆÙ‡", "Ù¾ÙˆÙ†Ù‡", "Ø´Ø§Ù†Ù‡", "ÙˆØ§Ù‡ÛŒ", "Ù¾Ú˜ÙˆÙ‡Ø´", "Ø¯Ø§Ù†Ø´ Ù¾Ú˜ÙˆÙ‡"], needed: 6 },
    { base: "Ø­Ø³ÛŒÙ† Ø®Ø±Ø§Ø²ÛŒ", answers: ["Ø®Ø§Ù†", "Ø­Ø±Ø§", "Ø­Ø³ÛŒÙ† Ø®Ø±Ø§Ø²ÛŒ", "Ø³ÛŒÙ†Ø§", "Ø±Ø§Ø²ÛŒ", "Ø­Ø³ÛŒÙ†ÛŒ"], needed: 6 },
    { base: "Ù¾Ø±ÙˆÛŒÙ† Ø§Ø¹ØªØµØ§Ù…ÛŒ", answers: ["ØªÙ†ÙˆØ±", "Ø§Ø¹ØªØµØ§Ù…", "Ù¾Ø±ÙˆÛŒÙ† Ø§Ø¹ØªØµØ§Ù…ÛŒ", "ÙˆØ§Ù†Øª", "ØªÛŒÙ…Ø§Ø±", "Ø¹ØµÙ…Øª"], needed: 6 },
    { base: "ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§", answers: ["Ù…Ø­ØªÙˆÛŒØ§Øª", "ØªÙˆÙ„Ø¯", "Ù…Ù„Ø§Øª", "Ø­ÛŒØ§Øª", "Ø­Ø§Ù…Ø¯", "ØªÙˆÙ„ÛŒØ¯"], needed: 6 },
    { base: "Ù‡ÙˆÛŒØª Ø¨ØµØ±ÛŒ", answers: ["ØªØ±Ø¨", "Ø¨ØµØ±ÛŒ", "ØµÙˆØ±ØªÛŒ", "ØµØ¨Ø±", "Ø¨ØµØ±Ù‡", "Ù‡ÙˆÛŒØª Ø¨ØµØ±ÛŒ"], needed: 6 },
    { base: "Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡", answers: ["Ù†Ù‡Ø§Ø¯", "Ø¯Ø¹ÙˆØª", "Ù…ØªÙ†ÙˆØ¹", "Ù†Ø¯Ø§Ù…Øª", "Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡", "Ø¯Ø¹Ø§"], needed: 6 },
    { base: "Ø¯Ù„Ø¯Ø§Ø¯Ú¯Ø§Ù†", answers: ["Ø¯Ù†Ú¯", "Ø¯Ø§Ù„", "Ø¯Ù„Ø¯Ø§Ø¯Ú¯Ø§Ù†", "Ù†Ø¯Ø§", "Ù„Ú¯Ø¯", "Ú¯Ù„Ø¯Ø§Ù†"], needed: 6 },
    { base: "Ú©ÛŒÙ…ÛŒØ§ÛŒ Ù…Ø­Ø¨Øª", answers: ["Ú©Ù…ÛŒØª", "Ú©Ù…ÛŒØ§Ø¨", "ØªØ¨Ø§Ú©ÛŒ", "Ù…Ø­ÛŒØ§", "Ú©ÛŒÙ…ÛŒØ§ÛŒ Ù…Ø­Ø¨Øª", "Ú©ÛŒÙ…ÛŒØ§"], needed: 6 }
  ];

  const totalLevels = levels.length;

  let currentLevelIndex = 0;
  let foundWords = [];
  let score = 0;
  let comboCount = 0;
  let bestCombo = 0;
  let totalWords = 0;
  let missionDone = false;
  let missionTextCurrent = "";
  let missionTypeCurrent = "";
  let missionHadMistake = false;
  let isMuted = false;
  let playerName = "";

  let hintWordForLevel = "";   // Ú©Ù„Ù…Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ Ø±ÙˆÛŒ Ø¢Ù† Ù…ÛŒâ€ŒÚ†Ø±Ø®Ø¯
let usedHint1 = false;
let usedHint2 = false;
let usedHint3 = false;
  
  // Ù…ÙˆØ¯ Ø¨Ø§Ø²ÛŒ Ùˆ ØªØ§ÛŒÙ…Ø±
  let gameMode = "normal";
  let timerId = null;
  let timeLeft = 0;
  const TIME_PER_WORD = 10;
  let modeLocked = false;

  const scoreTextEl     = document.getElementById("scoreText");
  const levelNumberEl   = document.getElementById("levelNumber");
  const totalLevelsEl   = document.getElementById("totalLevels");
  const baseWordLettersEl = document.getElementById("baseWordLetters");
  const levelGoalEl     = document.getElementById("levelGoal");
  const statusTextEl    = document.getElementById("statusText");
  const wordInputEl     = document.getElementById("wordInput");
  const checkBtn        = document.getElementById("checkBtn");
  const shuffleBtn      = document.getElementById("shuffleBtn");
  const nextBtn         = document.getElementById("nextBtn");
  const resetBtn        = document.getElementById("resetBtn");
  const foundListEl     = document.getElementById("foundList");
  const foundCountEl    = document.getElementById("foundCount");
  const neededCountEl   = document.getElementById("neededCount");
  const tavitaImgEl     = document.getElementById("tavitaImage");
  const tavitaTextEl    = document.getElementById("tavitaText");
  const rankTextEl      = document.getElementById("rankText");
  const popupOverlay    = document.getElementById("popupOverlay");
  const popupImageEl    = document.getElementById("popupImage");
  const popupTextEl     = document.getElementById("popupText");
  const popupBtn        = document.getElementById("popupBtn");
  const popupBtnLabel   = document.getElementById("popupBtnLabel");
  const gameCard        = document.querySelector(".game-card");
  const recordLevelEl   = document.getElementById("recordLevel");
  const recordScoreEl   = document.getElementById("recordScore");
  const comboPill       = document.getElementById("comboPill");
  const comboValueEl    = document.getElementById("comboValue");
  const missionBadgeEl  = document.getElementById("missionBadge");
  const missionTextEl   = document.getElementById("missionText");
  const hintBtn1 = document.getElementById("hintBtn1");
const hintBtn2 = document.getElementById("hintBtn2");
const hintBtn3 = document.getElementById("hintBtn3");
  const soundToggleBtn  = document.getElementById("soundToggle");
  const soundIndicator  = document.getElementById("soundIndicator");
  const soundLabel      = document.getElementById("soundLabel");
  const rankStep1       = document.getElementById("rankStep1");
  const rankStep2       = document.getElementById("rankStep2");
  const rankStep3       = document.getElementById("rankStep3");
  const rankStep4       = document.getElementById("rankStep4");
  const summaryBtn      = document.getElementById("summaryBtn");
  const summaryOverlay  = document.getElementById("summaryOverlay");
  const summaryNameEl   = document.getElementById("summaryName");
  const summaryLevelEl  = document.getElementById("summaryLevel");
  const summaryScoreEl  = document.getElementById("summaryScore");
  const summaryWordsEl  = document.getElementById("summaryWords");
  const summaryBestComboEl = document.getElementById("summaryBestCombo");
  const summaryBestLevelEl = document.getElementById("summaryBestLevel");
  const summaryBestScoreEl = document.getElementById("summaryBestScore");
  const summaryCloseBtn = document.getElementById("summaryCloseBtn");

  const nameOverlay     = document.getElementById("nameOverlay");
  const playerNameInput = document.getElementById("playerNameInput");
  const saveNameBtn     = document.getElementById("saveNameBtn");

  const helpOverlay     = document.getElementById("helpOverlay");
  const helpBtn         = document.getElementById("helpBtn");
  const helpCloseBtn    = document.getElementById("helpCloseBtn");

  const soundClick   = document.getElementById("soundClick");
  const soundCorrect = document.getElementById("soundCorrect");
  const soundLevelUp = document.getElementById("soundLevelUp");
  const soundFinal   = document.getElementById("soundFinal");
  const soundTimer   = document.getElementById("soundTimer");
  const soundNoWord  = document.getElementById("soundNoWord");

  const modeToggleBtn = document.getElementById("modeToggleBtn");
  const timerLabel    = document.getElementById("timerLabel");
  const modeHint      = document.getElementById("modeHint");

  // ØµØ¯Ø§Ù‡Ø§ÛŒ Ú¯ÙˆÛŒÙ†Ø¯Ù‡
  const voiceIntro     = document.getElementById("voiceIntro");
  const voiceLevelDone = document.getElementById("voiceLevelDone");
  const voiceRestart   = document.getElementById("voiceRestart");
  const voiceCantBuild = document.getElementById("voiceCantBuild");
  const voiceNextLevel = document.getElementById("voiceNextLevel");
  const voiceTimeUp    = document.getElementById("voiceTimeUp");
  const voiceRepeat    = document.getElementById("voiceRepeat");
  const voiceModeOn    = document.getElementById("voiceModeOn");
  const voiceChampion  = document.getElementById("voiceChampion");

// --- Ø¢ÛŒØ§ Ù‡ÛŒÚ† Ù¾Ø§Ù¾â€ŒØ¢Ù¾ÛŒ Ø¨Ø§Ø² Ø§Ø³ØªØŸ ---
function anyPopupOpen() {
  function isVisible(el) {
    return el && el.style.display && el.style.display !== "none";
  }

  return (
    isVisible(summaryOverlay) ||
    isVisible(helpOverlay)    ||
    isVisible(nameOverlay)    ||
    isVisible(popupOverlay)
  );
}

// --- Ù†Ù…Ø§ÛŒØ´ / Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ú©â€ŒØ¨Ø§ØªÙ† Ø§ÛŒØªØ§ ---
function updateBackButtonUI() {
  if (window.Eitaa && window.Eitaa.WebApp && window.Eitaa.WebApp.BackButton) {
    const bb = window.Eitaa.WebApp.BackButton;
    if (anyPopupOpen()) {
      bb.show();
    } else {
      bb.hide();
    }
  }
}

// --- Ø¨Ø³ØªÙ† Ù‡Ù…Ù‡ Ù¾Ø§Ù¾â€ŒØ¢Ù¾â€ŒÙ‡Ø§ ---
function closeAllPopups() {
  [summaryOverlay, helpOverlay, nameOverlay, popupOverlay].forEach(o => {
    if (o) o.style.display = "none";
  });
  updateBackButtonUI();
}

// --- ØªØ§Ø¨Ø¹ Ù…Ø´ØªØ±Ú© Ø¨Ø±Ø§ÛŒ Ø¨Ú© Ú¯ÙˆØ´ÛŒ / Ø¨Ú©â€ŒØ¨Ø§ØªÙ† Ø§ÛŒØªØ§ ---
function handleBackAction() {
  if (anyPopupOpen()) {
    // Ø§Ú¯Ø± Ù¾Ø§Ù¾â€ŒØ¢Ù¾ÛŒ Ø¨Ø§Ø² Ø§Ø³ØªØŒ ÙÙ‚Ø· Ù¾Ø§Ù¾â€ŒØ¢Ù¾â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø¨Ù†Ø¯
    closeAllPopups();
  } else {
    // Ø§Ú¯Ø± Ù¾Ø§Ù¾â€ŒØ¢Ù¾ÛŒ Ù†ÛŒØ³ØªØŒ ÙˆØ¨â€ŒØ§Ù¾ Ø±Ø§ Ø¨Ø¨Ù†Ø¯ ÛŒØ§ Ø¨Ø±Ú¯Ø±Ø¯
    if (
      window.Eitaa &&
      window.Eitaa.WebApp &&
      typeof window.Eitaa.WebApp.close === "function"
    ) {
      window.Eitaa.WebApp.close();
    } else if (window.history && typeof window.history.back === "function") {
      window.history.back();
    }
  }
}

  
  totalLevelsEl.textContent = totalLevels.toString();


// Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù‡Ø± Ù¾Ø§Ù¾â€ŒØ¢Ù¾ + Ø«Ø¨Øª Ø¯Ø± history
function openPopupWithHistory(openFn) {
  if (typeof openFn === "function") {
    openFn();
  }
  if (window.history && typeof window.history.pushState === "function") {
    window.history.pushState({ popup: true }, "");
  }
  updateBackButtonUI();
}

// Ù‡Ù†Ø¯Ù„ popstate (Ø¨Ú© Ø®ÙˆØ¯ Ù…Ø±ÙˆØ±Ú¯Ø±/Ú¯ÙˆØ´ÛŒ)
if (window.history && typeof window.history.pushState === "function") {
  window.addEventListener("popstate", function () {
    if (typeof handleBackAction === "function") {
      handleBackAction();
    }
  });
}



  
  function loadSoundSetting() {
    try {
      const raw = localStorage.getItem("tavitaWordsSoundMuted");
      if (raw === "1") isMuted = true;
      else isMuted = false;
    } catch (e) {
      isMuted = false;
    }
    updateSoundUI();
  }

  function saveSoundSetting() {
    try {
      localStorage.setItem("tavitaWordsSoundMuted", isMuted ? "1" : "0");
    } catch (e) {}
  }

  function updateSoundUI() {
    if (isMuted) {
      soundIndicator.classList.add("sound-muted");
      soundLabel.textContent = "ØµØ¯Ø§ Ù‚Ø·Ø¹ Ø§Ø³Øª";
      if (soundTimer) {
        soundTimer.pause();
        soundTimer.currentTime = 0;
      }
    } else {
      soundIndicator.classList.remove("sound-muted");
      soundLabel.textContent = "ØµØ¯Ø§ Ø±ÙˆØ´Ù† Ø§Ø³Øª";
    }
  }

  function playSafe(sound) {
    if (!sound || isMuted) return;
    try {
      sound.currentTime = 0;
      sound.play().catch(() => {});
    } catch (e) {}
  }

  soundToggleBtn.addEventListener("click", () => {
    isMuted = !isMuted;
    updateSoundUI();
    saveSoundSetting();
    playSafe(soundClick);
  });

  // Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø§ Ø§Ù…Ú©Ø§Ù† Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø®Ø´ ÙˆÛŒØ³
function showPopup(key, overrideText, options) {
  const data = POPUPS[key];
  if (!data) return;

  popupImageEl.src       = data.img;
  popupTextEl.innerHTML  = overrideText || data.text;
  popupBtnLabel.textContent = "Ø¨Ø§Ø´Ù‡ØŒ Ø¨Ø²Ù† Ø¨Ø±ÛŒÙ… ğŸš€";

  // âœ… Ø«Ø¨Øª Ø¯Ø± history Ùˆ Ø¢Ù¾Ø¯ÛŒØª Ø¨Ú©â€ŒØ¨Ø§ØªÙ†
  openPopupWithHistory(() => {
    popupOverlay.style.display = "flex";
  });

  const skipVoice = options && options.skipVoice;

  if (!skipVoice) {
    if (key === "intro") {
      playSafe(voiceIntro);
    } else if (key === "final") {
      playSafe(voiceChampion);
    }
  }
}

function hidePopup() {
  popupOverlay.style.display = "none";
  // âœ… Ù‡Ø± Ø¨Ø§Ø± Ú©Ù‡ Ø¨Ø³ØªÙ‡ Ø´Ø¯ØŒ Ø¨Ú©â€ŒØ¨Ø§ØªÙ† Ø±Ø§ Ù‡Ù… ØªÙ†Ø¸ÛŒÙ… Ú©Ù†
  updateBackButtonUI();
}
  if (popupBtn) {
    popupBtn.addEventListener("click", () => {
      playSafe(soundClick);
      hidePopup();
    });
  }

  function shuffleString(str) {
    let arr = str.split("");
    if (arr.length <= 1) return str;
    let shuffled = str;
    let tries = 0;
    while (shuffled === str && tries < 20) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      shuffled = arr.join("");
      tries++;
    }
    return shuffled;
  }

  function renderBaseWord() {
    const level = levels[currentLevelIndex];
    baseWordLettersEl.innerHTML = "";
    const shuffled = shuffleString(level.base);
    shuffled.split("").forEach((ch) => {
      const span = document.createElement("span");
      span.className = "letter-chip";
      span.textContent = ch;
      baseWordLettersEl.appendChild(span);
    });
  }

  function renderFoundWords() {
    foundListEl.innerHTML = "";
    foundWords.forEach((w) => {
      const chip = document.createElement("span");
      chip.className = "found-item";
      chip.textContent = w;
      foundListEl.appendChild(chip);
    });
    foundCountEl.textContent = foundWords.length.toString();
  }

  function setStatus(msg, type) {
    statusTextEl.textContent = msg || "";
    statusTextEl.classList.remove("ok", "err", "shake");
    if (type === "ok") statusTextEl.classList.add("ok");
    if (type === "err") {
      statusTextEl.classList.add("err", "shake");
      setTimeout(() => statusTextEl.classList.remove("shake"), 250);
    }
  }

  function normalizeWord(w) {
    return w.replace(/\s+/g, "").trim();
  }

  function getRankKey() {
    const lvl = currentLevelIndex + 1;
    if (lvl <= 15) return "student";
    if (lvl <= 30) return "master";
    if (lvl <= 45) return "grand";
    return "legend";
  }

  function getCurrentSet() {
    const key = getRankKey();
    return TAVITA_SETS[key] || TAVITA_SETS.student;
  }

  function updateRankMessage() {
    const lvl = currentLevelIndex + 1;
    rankStep1.classList.remove("active");
    rankStep2.classList.remove("active");
    rankStep3.classList.remove("active");
    rankStep4.classList.remove("active");

    if (lvl <= 15) {
      rankStep1.classList.add("active");
      rankTextEl.innerHTML =
        (playerName ? (playerName + "ØŒ ") : "") +
        "Ø§Ù„Ø§Ù† Ø¯Ø± Ø¨Ø®Ø´ Ø´Ø§Ú¯Ø±Ø¯ÛŒ Ù‡Ø³ØªÛŒØ› Ø§Ú¯Ù‡ Ø§ÛŒÙ† Û±Ûµ Ù…Ø±Ø­Ù„Ù‡ Ø±Ùˆ Ø±Ø¯ Ú©Ù†ÛŒØŒ <b>Ø§Ø³ØªØ§Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§</b> Ù…ÛŒâ€ŒØ´ÛŒ ğŸ˜Œ";
    } else if (lvl <= 30) {
      rankStep1.classList.add("active");
      rankStep2.classList.add("active");
      rankTextEl.innerHTML =
        "ØªÙˆ Ø¨Ø®Ø´ Ø§Ø³ØªØ§Ø¯Ù‡Ø§ Ù‡Ø³ØªÛŒØ› ØªÙ„Ø§Ø´ Ú©Ù† Ø¨Ù‡ <b>Ø§Ø³ØªØ§Ø¯ Ø¨Ø²Ø±Ú¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§</b> Ø¨Ø±Ø³ÛŒ ğŸ˜‰";
    } else if (lvl <= 45) {
      rankStep1.classList.add("active");
      rankStep2.classList.add("active");
      rankStep3.classList.add("active");
      rankTextEl.innerHTML =
        "Ø§Ù„Ø§Ù† Ù†Ø²Ø¯ÛŒÚ© Ø´Ø¯ÛŒ Ø¨Ù‡ <b>Ø§Ø³ØªØ§Ø¯ Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§</b> ğŸ¤¯ğŸ†";
    } else {
      rankStep1.classList.add("active");
      rankStep2.classList.add("active");
      rankStep3.classList.add("active");
      rankStep4.classList.add("active");
      rankTextEl.innerHTML =
        "Ú©Ù…â€ŒÚ©Ù… Ø¯Ø§Ø±ÛŒ Ø¨Ù‡ <b>Ù‚Ù‡Ø±Ù…Ø§Ù† Ø·Ø§ÙˆÛŒØªØ§</b> Ø´Ø¯Ù† Ù†Ø²Ø¯ÛŒÚ© Ù…ÛŒâ€ŒØ´ÛŒâ€¦ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡! ğŸ”¥";
    }
  }

  function setTavita(mode, text) {
    const set = getCurrentSet();
    let img = set.explain;
    switch (mode) {
      case "shuffle":
        img = set.shuffle || set.explain;
        break;
      case "correct":
        img = set.clap;
        break;
      case "error":
        img = set.sad;
        break;
      case "level":
        img = set.medal;
        break;
      case "proud":
        img = set.medal;
        break;
      case "neutral":
      default:
        img = set.explain;
    }
    tavitaImgEl.src = img;
    if (text) tavitaTextEl.innerHTML = text;
  }

  function updateRecord() {
    const currLevel = currentLevelIndex + 1;
    let rec = { bestLevel: 0, bestScore: 0 };
    try {
      const raw = localStorage.getItem("tavitaWordsRecord");
      if (raw) rec = JSON.parse(raw);
    } catch (e) {}
    if (currLevel > (rec.bestLevel || 0)) rec.bestLevel = currLevel;
    if (score > (rec.bestScore || 0)) rec.bestScore = score;
    try {
      localStorage.setItem("tavitaWordsRecord", JSON.stringify(rec));
    } catch (e) {}
    recordLevelEl.textContent = (rec.bestLevel || 0).toString();
    recordScoreEl.textContent = (rec.bestScore || 0).toString();
  }

  function loadRecord() {
    try {
      const raw = localStorage.getItem("tavitaWordsRecord");
      if (!raw) {
        recordLevelEl.textContent = "0";
        recordScoreEl.textContent = "0";
        return;
      }
      const rec = JSON.parse(raw);
      recordLevelEl.textContent = (rec.bestLevel || 0).toString();
      recordScoreEl.textContent = (rec.bestScore || 0).toString();
    } catch (e) {
      recordLevelEl.textContent = "0";
      recordScoreEl.textContent = "0";
    }
  }

  function saveGameState() {
    const state = {
      currentLevelIndex,
      score,
      foundWords,
      comboCount,
      bestCombo,
      totalWords,
      missionDone,
      missionTypeCurrent,
      missionTextCurrent,
      missionHadMistake,
      gameMode,
      modeLocked
    };
    try {
      localStorage.setItem("tavitaWordsState", JSON.stringify(state));
    } catch (e) {}
  }

  function loadGameState() {
    try {
      const raw = localStorage.getItem("tavitaWordsState");
      if (!raw) return false;
      const st = JSON.parse(raw);
      if (typeof st.currentLevelIndex === "number" &&
          st.currentLevelIndex >= 0 &&
          st.currentLevelIndex < levels.length) {
        currentLevelIndex   = st.currentLevelIndex;
        score               = st.score || 0;
        foundWords          = Array.isArray(st.foundWords) ? st.foundWords : [];
        comboCount          = st.comboCount || 0;
        bestCombo           = st.bestCombo || 0;
        totalWords          = st.totalWords || 0;
        missionDone         = !!st.missionDone;
        missionTypeCurrent  = st.missionTypeCurrent || "";
        missionTextCurrent  = st.missionTextCurrent || "";
        missionHadMistake   = !!st.missionHadMistake;
        gameMode            = st.gameMode || "normal";
        modeLocked          = !!st.modeLocked;
        return true;
      }
    } catch (e) {}
    return false;
  }

  function clearGameState() {
    try {
      localStorage.removeItem("tavitaWordsState");
    } catch (e) {}
  }

  function loadPlayerName() {
    try {
      const raw = localStorage.getItem("tavitaPlayerName");
      if (raw) playerName = raw;
      else playerName = "";
    } catch (e) {
      playerName = "";
    }
  }

  function savePlayerName() {
    try {
      localStorage.setItem("tavitaPlayerName", playerName);
    } catch (e) {}
  }

  function showNamePopupIfNeeded() {
  if (!playerName) {
    openPopupWithHistory(() => {
      nameOverlay.style.display = "flex";
      playerNameInput.value = "";
      playerNameInput.focus();
    });
  }
}

  function updateMissionForLevel() {
    const lvl = currentLevelIndex + 1;
    missionDone = false;
    missionHadMistake = false;

    if (lvl <= 15) {
      missionTypeCurrent = "noMistake";
      missionTextCurrent = "Ø³Ø¹ÛŒ Ú©Ù† Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ø¨Ø¯ÙˆÙ† Ù‡ÛŒÚ† Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ Ø±Ø¯ Ú©Ù†ÛŒ.";
    } else if (lvl <= 30) {
      missionTypeCurrent = "len4";
      missionTextCurrent = "Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ú©Ù„Ù…Ù‡Ù” Û´ Ø­Ø±ÙÛŒ Ù‡Ù… Ù¾ÛŒØ¯Ø§ Ú©Ù†.";
    } else if (lvl <= 45) {
      missionTypeCurrent = "len5";
      missionTextCurrent = "Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ú©Ù„Ù…Ù‡Ù” Ûµ Ø­Ø±ÙÛŒ Ù‡Ù… Ù¾ÛŒØ¯Ø§ Ú©Ù†.";
    } else {
      missionTypeCurrent = "combo3";
      missionTextCurrent = "Ø³Ø¹ÛŒ Ú©Ù† ÛŒÚ© Ø¨Ø§Ø± Ú©Ø§Ù…Ø¨ÙˆÛŒ Û³ØªØ§ÛŒÛŒ ÛŒØ§ Ø¨ÛŒØ´ØªØ± Ø¨Ø²Ù†ÛŒ.";
    }

    missionTextEl.textContent = missionTextCurrent;
    missionBadgeEl.classList.remove("mission-done");
    missionBadgeEl.textContent = "Ù…Ø§Ù…ÙˆØ±ÛŒØª Ø§ÛŒÙ† Ø¨Ø®Ø´";
  }

  function checkMissionOnCorrectWord(word) {
    const len = word.length;
    if (missionDone) return;

    if (missionTypeCurrent === "noMistake") {
      if (!missionHadMistake && foundWords.length + 1 >= levels[currentLevelIndex].needed) {
        missionDone = true;
      }
    } else if (missionTypeCurrent === "len4") {
      if (len >= 4) missionDone = true;
    } else if (missionTypeCurrent === "len5") {
      if (len >= 5) missionDone = true;
    } else if (missionTypeCurrent === "combo3") {
      if (comboCount + 1 >= 3) missionDone = true;
    }

    if (missionDone) {
      missionBadgeEl.classList.add("mission-done");
      missionBadgeEl.textContent = "Ù…Ø§Ù…ÙˆØ±ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ âœ…";
      setTavita("correct", "Ù…Ø§Ù…ÙˆØ±ÛŒØª Ù…Ø®ÙÛŒ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ùˆ Ù‡Ù… Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯ÛŒ! Ù…ØºØ² Ø·Ù„Ø§ÛŒÛŒ ğŸ˜âœ¨");
    }
  }

  // ØªØ§ÛŒÙ…Ø± Ø­Ø§Ù„Øª Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø±
  function updateTimerLabel() {
    timerLabel.textContent = `â±ï¸ Ø²Ù…Ø§Ù†: ${timeLeft} Ø«Ø§Ù†ÛŒÙ‡`;
  }

  function clearTimer() {
    if (timerId) {
      clearInterval(timerId);
      timerId = null;
    }
    timerLabel.classList.add("hidden");
    if (soundTimer) {
      soundTimer.pause();
      soundTimer.currentTime = 0;
    }
  }

  function handleTimeOver() {
    missionHadMistake = true;
    breakComboOnError();
    if (score >= 10) {
      score -= 10;
      scoreTextEl.textContent = score.toString();
    }
    foundWords = [];
    renderFoundWords();
    setStatus("Ø²Ù…Ø§Ù† ØªÙ…ÙˆÙ… Ø´Ø¯! Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø§Ø² Ø§ÙˆÙ„ Ø´Ø±ÙˆØ¹ Ø´Ø¯ â±ï¸", "err");
    setTavita("error", "Ø§ÙˆÙ‡ØŒ Ø²Ù…Ø§Ù† ØªÙ…ÙˆÙ… Ø´Ø¯! Ø¨ÛŒØ§ ÛŒÚ© Ø¨Ø§Ø± Ø¯ÛŒÚ¯Ù‡ Ø§Ø² Ø§ÙˆÙ„ Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø±Ùˆ Ø¨Ø²Ù†ÛŒÙ… ğŸ˜‰");
    playSafe(voiceTimeUp);
    saveGameState();
  }

  function startLevelTimer() {
    clearTimer();
    const level = levels[currentLevelIndex];
    const needed = level.needed || 1;
    timeLeft = needed * TIME_PER_WORD;
    if (timeLeft < 10) timeLeft = 10;

    timerLabel.classList.remove("hidden");
    updateTimerLabel();

    if (!isMuted && soundTimer) {
      try {
        soundTimer.currentTime = 0;
        soundTimer.play().catch(() => {});
      } catch (e) {}
    }

    timerId = setInterval(() => {
      timeLeft--;
      if (timeLeft <= 0) {
        timeLeft = 0;
        updateTimerLabel();
        clearTimer();
        handleTimeOver();
      } else {
        updateTimerLabel();
      }
    }, 1000);
  }

  function initLevel(resetFound = true) {
    const level = levels[currentLevelIndex];
    levelNumberEl.textContent = (currentLevelIndex + 1).toString();

    clearTimer();

    if (resetFound) {
      foundWords = [];
      modeLocked = false;
    } else {
      modeLocked = foundWords.length > 0;
    }

    renderFoundWords();
    scoreTextEl.textContent = score.toString();
    renderBaseWord();
    neededCountEl.textContent = level.needed.toString();
    levelGoalEl.innerHTML = `Ø¨Ø§ÛŒØ¯ <b>${level.needed}</b> Ú©Ù„Ù…Ù‡Ù” Ø¯Ø±Ø³Øª Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒ.`;
    updateRankMessage();

    comboCount = 0;
    comboPill.classList.remove("active");
    missionHadMistake = false;
    updateMissionForLevel();

    wordInputEl.value = "";

    if (foundWords.length >= level.needed) {
      nextBtn.disabled = false;
      checkBtn.disabled = true;
      setStatus("ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø±Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯ÛŒØ› Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡Ù” Ø¨Ø¹Ø¯ Ø¨Ø±ÙˆÛŒ.", "ok");
      setTavita("level", "Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø±Ùˆ Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ø±Ø¯ÛŒØ› Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒ Ø¨Ø±Ùˆ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ ğŸ…");
    } else {
      nextBtn.disabled = true;
      checkBtn.disabled = false;
      setStatus("Ú©Ù„Ù…Ø§ØªØª Ø±Ø§ ÛŒÚ©ÛŒâ€ŒÛŒÚ©ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù† Ùˆ Ø«Ø¨Øª Ú©Ù†.", "");
      setTavita(
        "neutral",
        (playerName ? (playerName + "ØŒ ") : "") +
        "Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ ØªØ§Ø²Ù‡ Ø´Ø±ÙˆØ¹ Ø´Ø¯Ù‡Ø› Ø¨Ø¨ÛŒÙ†ÛŒÙ… Ø§Ø² Ø§ÛŒÙ† Ú©Ù„Ù…Ù‡ Ú†Ù†Ø¯ØªØ§ Ú©Ù„Ù…Ù‡Ù” Ø®ÙÙ† Ø¯Ø±Ù…ÛŒØ§Ø±ÛŒ ğŸ˜âœ¨"
      );
    }

    // ÙˆØ¶Ø¹ÛŒØª Ø­Ø§Ù„Øª
    modeToggleBtn.disabled = modeLocked;
    if (gameMode === "timed") {
      modeToggleBtn.textContent = "â±ï¸ Ø­Ø§Ù„Øª Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø±";
      if (!modeLocked) {
        startLevelTimer();
      } else {
        timerLabel.classList.add("hidden");
      }
      if (modeHint) modeHint.classList.add("hidden");
    } else {
      modeToggleBtn.textContent = "ğŸ® Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ";
      clearTimer();
      if (modeHint) {
        if (!modeLocked) modeHint.classList.remove("hidden");
        else modeHint.classList.add("hidden");
      }
    }

    saveGameState();


hintStage = 0;
hintLocked = false;
hintWordForLevel = "";
hintBtn.disabled = false;
hintBtn.textContent = "Ø±Ø§Ù‡Ù†Ù…Ø§";
    
  }

  function canBuildFromBase(base, word) {
    const baseArr = base.split("");
    const wordArr = word.split("");
    const baseCount = {};
    const wordCount = {};
    baseArr.forEach((ch) => (baseCount[ch] = (baseCount[ch] || 0) + 1));
    wordArr.forEach((ch) => (wordCount[ch] = (wordCount[ch] || 0) + 1));
    for (const ch in wordCount) {
      if (!baseCount[ch] || wordCount[ch] > baseCount[ch]) return false;
    }
    return true;
  }

  function applyComboAndScore(baseIncrement) {
    comboCount += 1;
    if (comboCount > bestCombo) bestCombo = comboCount;

    let factor = 1;
    if (comboCount >= 5) factor = 3;
    else if (comboCount >= 3) factor = 2;

    const gained = baseIncrement * factor;
    score += gained;
    scoreTextEl.textContent = score.toString();

    if (factor > 1) {
      comboPill.classList.add("active");
      comboValueEl.textContent = factor.toString();
    } else {
      comboPill.classList.remove("active");
    }
  }

  function breakComboOnError() {
    comboCount = 0;
    comboPill.classList.remove("active");
  }

  function checkWord() {
    if (checkBtn.disabled) return;
    const level = levels[currentLevelIndex];
    let w = normalizeWord(wordInputEl.value);
    if (!w) {
      setStatus("Ø§ÙˆÙ„ ÛŒÚ© Ú©Ù„Ù…Ù‡ Ø¨Ù†ÙˆÛŒØ³.", "err");
      setTavita("error", "Ù‡Ù†ÙˆØ² Ú†ÛŒØ²ÛŒ Ù†Ù†ÙˆØ´ØªÛŒØ› ÛŒÚ© Ú©Ù„Ù…Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù† ğŸ˜…");
      missionHadMistake = true;
      breakComboOnError();
      playSafe(soundNoWord);
      saveGameState();
      return;
    }
    if (w.length < 2) {
      setStatus("Ú©Ù„Ù…Ù‡ Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ø§Ø³ØªØ› Ø­Ø¯Ø§Ù‚Ù„ Û² Ø­Ø±ÙÛŒ Ø¨Ø§Ø´Ø¯.", "err");
      setTavita("error", "Ø§ÛŒÙ† ÛŒÚ©ÛŒ Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ø¨ÙˆØ¯Ø› ÛŒÚ© Ú©Ù… Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ±Ø´ Ú©Ù† ğŸ¤");
      missionHadMistake = true;
      breakComboOnError();
      saveGameState();
      return;
    }
    if (!canBuildFromBase(level.base, w)) {
      setStatus("Ø§ÛŒÙ† Ú©Ù„Ù…Ù‡ Ø±Ø§ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† ÙÙ‚Ø· Ø¨Ø§ Ø­Ø±ÙˆÙ Ú©Ù„Ù…Ù‡Ù” Ø§ØµÙ„ÛŒ Ø³Ø§Ø®Øª.", "err");
      setTavita("error", "Ø­Ø±ÙˆÙØ´ Ø¬ÙˆØ± Ø¯Ø±Ù†Ù…ÛŒØ§Ø¯Ø› ÙÙ‚Ø· Ø§Ø² Ù‡Ù…ÛŒÙ† Ø­Ø±ÙˆÙ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù† ğŸ˜‰");
      missionHadMistake = true;
      breakComboOnError();
      playSafe(voiceCantBuild);
      saveGameState();
      return;
    }
    const allowed = level.answers.map(normalizeWord);
    if (!allowed.includes(w)) {
      setStatus("Ø§ÛŒÙ† Ú©Ù„Ù…Ù‡ Ø¬Ø²Ùˆ Ø¬ÙˆØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ù†ÛŒØ³ØªØ› ÛŒÚ©ÛŒ Ø¯ÛŒÚ¯Ø± Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†.", "err");
      setTavita("error", "Ø§ÛŒÙ† ÛŒÚ©ÛŒ ØªÙˆ Ø¬ÙˆØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ù†ÛŒØ³ØªØ› Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù† ğŸ¤”");
      missionHadMistake = true;
      breakComboOnError();
      saveGameState();
      return;
    }
    if (foundWords.includes(w)) {
      setStatus("Ø§ÛŒÙ† Ú©Ù„Ù…Ù‡ Ø±Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ú©Ø±Ø¯ÛŒ.", "err");
      setTavita("error", "Ø§ÛŒÙ† Ø±Ùˆ Ù‚Ø¨Ù„Ø§Ù‹ Ú¯ÙØªÛŒØ› ÛŒÚ© Ú†ÛŒØ² ØªØ§Ø²Ù‡ Ø¨Ú¯Ùˆ ğŸ˜Š");
      missionHadMistake = true;
      breakComboOnError();
      playSafe(voiceRepeat);
      saveGameState();
      return;
    }

    // Ù…ÙˆÙÙ‚ÛŒØª
    foundWords.push(w);
    if (hintWordForLevel && w === hintWordForLevel) {
  resetHintsForNextWord();
    }

// Ø§Ú¯Ø± Ù…Ø±Ø­Ù„Ù‡ ØªÙ…ÙˆÙ… Ø´Ø¯ØŒ Ø²Ù…Ø§Ù† Ù…ØªÙˆÙ‚Ù Ø´ÙˆØ¯
if (gameMode === "timed" && foundWords.length >= level.needed) {
  clearTimer();
  timeLeft = 0;
}

    
    totalWords += 1;
    renderFoundWords();
    wordInputEl.value = "";
    wordInputEl.focus();

    // Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÙˆÙ„ÛŒÙ† Ú©Ù„Ù…Ù‡ØŒ Ø­Ø§Ù„Øª Ø²Ù…Ø§Ù† Ù‚ÙÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    if (foundWords.length === 1) {
      modeLocked = true;
      modeToggleBtn.disabled = true;
      if (modeHint) modeHint.classList.add("hidden");
    }

    // Ø§Ù…ØªÛŒØ§Ø² + Ú©Ø§Ù…Ø¨Ùˆ (Ø¯Ø± Ø­Ø§Ù„Øª Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø± Ø¯ÙˆØ¨Ø±Ø§Ø¨Ø±)
    const baseInc = (gameMode === "timed" ? 20 : 10);
    applyComboAndScore(baseInc);

    setStatus("Ø¢ÙØ±ÛŒÙ†! ÛŒÚ© Ú©Ù„Ù…Ù‡Ù” Ø¬Ø¯ÛŒØ¯ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯ÛŒ ğŸŒ¿", "ok");
    setTavita("correct",
      (playerName ? (playerName + "ØŒ ") : "") +
      "Ø¢ÙØ±ÛŒÙ†! ÛŒÚ© Ú©Ù„Ù…Ù‡Ù” ØªØ§Ø²Ù‡ Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ ğŸ‘âœ¨"
    );

    // ØµØ¯Ø§ÛŒ Ø«Ø¨Øª Ú©Ù„Ù…Ù‡Ù” Ø¯Ø±Ø³Øª â†’ Ø¯ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø®ØªØµØ§ØµÛŒ
    playSafe(soundCorrect);
    checkMissionOnCorrectWord(w);
    saveGameState();

    if (foundWords.length >= level.needed) {
      setStatus("Ø¹Ø§Ù„ÛŒ! ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯ÛŒØ› Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡Ù” Ø¨Ø¹Ø¯ Ø¨Ø±ÙˆÛŒ.", "ok");
      nextBtn.disabled = false;
      checkBtn.disabled = true;
      setTavita("level",
        (playerName ? (playerName + "ØŒ ") : "") +
        "Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø±Ùˆ ØªØ±Ú©ÙˆÙ†Ø¯ÛŒ! Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±ÛŒÙ… Ø³Ø±Ø§Øº Ø¨Ø¹Ø¯ÛŒØŸ ğŸ…"
      );
      playSafe(voiceLevelDone);
      updateRecord();
      saveGameState();
    }
  }

  checkBtn.addEventListener("click", () => {
    checkWord();
  });

  wordInputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      checkWord();
    }
  });

  shuffleBtn.addEventListener("click", () => {
    playSafe(soundClick);
    renderBaseWord();
    setTavita("shuffle", "Ø­Ø±ÙˆÙ Ø±Ø§ Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ Ú©Ø±Ø¯Ù…ØŒ Ø´Ø§ÛŒØ¯ Ø§ÛŒØ¯Ù‡Ù” Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ù‡ Ø°Ù‡Ù†Øª Ø¨Ø±Ø³Ø¯ âœ¨");
  });



  
function pickHintWord() {
  const level = levels[currentLevelIndex];
  const remaining = level.answers.map(normalizeWord).filter(a => !foundWords.includes(a));
  if (remaining.length === 0) return "";
  return remaining[Math.floor(Math.random() * remaining.length)];
}

function resetHintsForNextWord() {
  hintWordForLevel = "";
  usedHint1 = usedHint2 = usedHint3 = false;
  hintBtn1.disabled = false;
  hintBtn2.disabled = false;
  hintBtn3.disabled = false;
}

function ensureHintWord() {
  if (!hintWordForLevel || foundWords.includes(hintWordForLevel)) {
    hintWordForLevel = pickHintWord();
    usedHint1 = usedHint2 = usedHint3 = false;
    hintBtn1.disabled = false;
    hintBtn2.disabled = false;
    hintBtn3.disabled = false;
  }
  return hintWordForLevel;
}

function pickHintWord() {
  const level = levels[currentLevelIndex];
  const remaining = level.answers
    .map(normalizeWord)
    .filter(a => !foundWords.includes(a));

  if (remaining.length === 0) return "";
  return remaining[Math.floor(Math.random() * remaining.length)];
}

function resetHintsForNextWord() {
  hintWordForLevel = "";
  usedHint1 = usedHint2 = usedHint3 = false;

  hintBtn1.disabled = false;
  hintBtn2.disabled = false;
  hintBtn3.disabled = false;
}

function ensureHintWord() {
  if (!hintWordForLevel || foundWords.includes(hintWordForLevel)) {
    hintWordForLevel = pickHintWord();
    usedHint1 = usedHint2 = usedHint3 = false;

    hintBtn1.disabled = false;
    hintBtn2.disabled = false;
    hintBtn3.disabled = false;
  }
  return hintWordForLevel;
}

function applyHint(cost, msg, btn, flagSetter) {
  if (score < cost) {
    setStatus("Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ ğŸ˜•", "bad");
    return;
  }

  score -= cost;
  scoreTextEl.textContent = String(score);

  setStatus(msg, "ok");
  flagSetter();
  btn.disabled = true;

  saveGameState();
}

/* ===== Ø±Ø§Ù‡Ù†Ù…Ø§ Û±: ÛŒÚ© Ø­Ø±Ù ===== */
hintBtn1.addEventListener("click", () => {
  if (usedHint1) {
    setStatus("Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ ğŸ”’", "bad");
    return;
  }

  const w = ensureHintWord();
  if (!w) {
    setStatus("Ù‡Ù…Ù‡ Ú©Ù„Ù…Ø§Øª Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡ ğŸ‰", "ok");
    return;
  }

  applyHint(
    5,
    `Ø±Ø§Ù‡Ù†Ù…Ø§: ÛŒÚ© Ø­Ø±Ù â†’ Â«${w[0]}Â»`,
    hintBtn1,
    () => (usedHint1 = true)
  );
});

/* ===== Ø±Ø§Ù‡Ù†Ù…Ø§ Û²: Ø¯Ùˆ Ø­Ø±Ù ===== */
hintBtn2.addEventListener("click", () => {
  if (usedHint2) {
    setStatus("Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ ğŸ”’", "bad");
    return;
  }

  const w = ensureHintWord();
  if (!w) {
    setStatus("Ù‡Ù…Ù‡ Ú©Ù„Ù…Ø§Øª Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡ ğŸ‰", "ok");
    return;
  }

  const a = w[0];
  const b = w.length >= 2 ? w[1] : "";

  applyHint(
    15,
    `Ø±Ø§Ù‡Ù†Ù…Ø§: Ø¯Ùˆ Ø­Ø±Ù â†’ Â«${a}${b}Â»`,
    hintBtn2,
    () => (usedHint2 = true)
  );
});

/* ===== Ø±Ø§Ù‡Ù†Ù…Ø§ Û³: ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±ÙˆÙ ===== */
hintBtn3.addEventListener("click", () => {
  if (usedHint3) {
    setStatus("Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ ğŸ”’", "bad");
    return;
  }

  const w = ensureHintWord();
  if (!w) {
    setStatus("Ù‡Ù…Ù‡ Ú©Ù„Ù…Ø§Øª Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡ ğŸ‰", "ok");
    return;
  }

  applyHint(
    15,
    `Ø±Ø§Ù‡Ù†Ù…Ø§: ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±ÙˆÙ â†’ ${w.length}`,
    hintBtn3,
    () => (usedHint3 = true)
  );
});

  
  nextBtn.addEventListener("click", () => {
    // ØµØ¯Ø§ÛŒ Â«Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯Â» + ÙˆÛŒØ³ Ù…Ø±Ø¨ÙˆØ·Ù‡
    playSafe(soundLevelUp);
    playSafe(voiceNextLevel);
    clearTimer();
    if (currentLevelIndex < levels.length - 1) {
      currentLevelIndex++;
      initLevel(true);

      if (currentLevelIndex === 15) {
        showPopup("stage1");
      } else if (currentLevelIndex === 30) {
        showPopup("stage2");
      } else if (currentLevelIndex === 45) {
        showPopup("stage3");
      }
    } else {
      setStatus("ØªØ¨Ø±ÛŒÚ©! Ù‡Ù…Ù‡Ù” Ù…Ø±Ø§Ø­Ù„ Ø±Ø§ ØªÙ…Ø§Ù… Ú©Ø±Ø¯ÛŒ ğŸ‰", "ok");
      setTavita(
        "proud",
        (playerName ? (playerName + "ØŒ ") : "") +
        "ØªÙˆ Ø±Ø³Ù…Ø§Ù‹ Ù‚Ù‡Ø±Ù…Ø§Ù† Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ø´Ø¯ÛŒ! ğŸ˜ğŸ†"
      );
      nextBtn.disabled = true;
      clearGameState();
      updateRecord();

      const finalText =
        (playerName ? (playerName + " Ø¹Ø²ÛŒØ²ØŒ ") : "") +
        "Ø¨Ø³ÛŒØ§Ø± ØªØ¨Ø±ÛŒÚ© Ù…ÛŒâ€ŒÚ¯Ù… ğŸ‰ ØªÙˆ Ù‚Ù‡Ø±Ù…Ø§Ù† Ø¨Ø§Ø²ÛŒ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ø´Ø¯ÛŒ! Ø§Ø² Ø§ÛŒÙ† ØµÙØ­Ù‡ (Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ù…Ø±Ø­Ù„Ù‡ Ù†Ù‡Ø§ÛŒÛŒ) Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ± Ùˆ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ú©Ø§Ù†Ø§Ù„ Ø·Ø§ÙˆÛŒØªØ§ Ø¨ÙØ±Ø³Øª ØªØ§ Ø¬Ø§ÛŒØ²Ù‡Ù” Ø¨Ø²Ø±Ú¯ Ø±Ùˆ Ø¨Ú¯ÛŒØ±ÛŒ ğŸ˜ğŸ";
      popupBtnLabel.textContent = "Ø¨Ø§Ø´Ù‡ØŒ Ø§Ù„Ø§Ù† Ø§Ø³Ú©Ø±ÛŒÙ† Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù… ğŸ“¸";
      showPopup("final", finalText);
      playSafe(soundFinal);
      if (gameCard) {
        gameCard.classList.add("win-glow");
      }
    }
  });

  resetBtn.addEventListener("click", () => {
    // ÙÙ‚Ø· ØµØ¯Ø§ÛŒ Ú©Ù„ÛŒÚ© + ÙˆÛŒØ³ Â«Ø¨Ø§Ø²ÛŒ Ø§Ø² Ø§ÙˆÙ„ Ø´Ø±ÙˆØ¹ Ø´Ø¯Â»
    playSafe(soundClick);
    playSafe(voiceRestart);
    clearTimer();
    currentLevelIndex = 0;
    score = 0;
    foundWords = [];
    comboCount = 0;
    bestCombo = 0;
    totalWords = 0;
    modeLocked = false;
    gameMode = "normal";
    clearGameState();
    initLevel(true);
    if (modeHint) modeHint.classList.remove("hidden");

    // Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø´Ø±ÙˆØ¹ Ø§Ø² Ø§ÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØµØ¯Ø§ÛŒ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ
    showPopup(
      "intro",
      (playerName ? (playerName + "ØŒ ") : "") +
      "Ø¨Ø§Ø²ÛŒ Ø§Ø² Ø§ÙˆÙ„ Ø´Ø±ÙˆØ¹ Ø´Ø¯Ø› Ø¨ÛŒØ§ Ø§ÛŒÙ† Ø¨Ø§Ø± Ø±Ú©ÙˆØ±Ø¯ Ù‚Ø¨Ù„ÛŒâ€ŒØ§Øª Ø±Ùˆ Ù‡Ù… Ø¨ØªØ±Ú©ÙˆÙ†ÛŒ ğŸ’ª",
      { skipVoice: true }
    );
  });

  // Ø¯Ú©Ù…Ù‡ Ù…ÙˆØ¯ Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø± / Ø¹Ø§Ø¯ÛŒ
  modeToggleBtn.addEventListener("click", () => {
    if (modeLocked) {
      playSafe(soundClick);
      setStatus("Ø¯Ø± Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ ÙÙ‚Ø· Ù‚Ø¨Ù„ Ø§Ø² Ø«Ø¨Øª Ø§ÙˆÙ„ÛŒÙ† Ú©Ù„Ù…Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù…ÙˆØ¯ Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø± Ø±Ø§ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡ÛŒ.", "err");
      setTavita("error", "Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø´Ø±ÙˆØ¹ Ø´Ø¯Ù‡Ø› Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ Ø§Ø² Ø§ÙˆÙ„ ØªØµÙ…ÛŒÙ… Ø¨Ú¯ÛŒØ± Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø± Ø¨Ø§Ø´Ù‡ ÛŒØ§ Ù†Ù‡ ğŸ˜‰");
      return;
    }
    playSafe(soundClick);
    if (gameMode === "normal") {
      gameMode = "timed";
      modeToggleBtn.textContent = "â±ï¸ Ø­Ø§Ù„Øª Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø±";
      if (modeHint) modeHint.classList.add("hidden");
      startLevelTimer();
      playSafe(voiceModeOn);
    } else {
      gameMode = "normal";
      modeToggleBtn.textContent = "ğŸ® Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ";
      clearTimer();
      if (modeHint) modeHint.classList.remove("hidden");
    }
    saveGameState();
  });

  // Ø®Ù„Ø§ØµÙ‡ Ù¾ÛŒØ´Ø±ÙØª
summaryBtn.addEventListener("click", () => {
  playSafe(soundClick);
  let rec = { bestLevel: 0, bestScore: 0 };
  try {
    const raw = localStorage.getItem("tavitaWordsRecord");
    if (raw) rec = JSON.parse(raw);
  } catch (e) {}

  summaryNameEl.textContent       = playerName || "-";
  summaryLevelEl.textContent      = (currentLevelIndex + 1).toString();
  summaryScoreEl.textContent      = score.toString();
  summaryWordsEl.textContent      = totalWords.toString();
  summaryBestComboEl.textContent  = bestCombo.toString();
  summaryBestLevelEl.textContent  = (rec.bestLevel || 0).toString();
  summaryBestScoreEl.textContent  = (rec.bestScore || 0).toString();

  openPopupWithHistory(() => {
    summaryOverlay.style.display = "flex";
  });
});

summaryCloseBtn.addEventListener("click", () => {
  playSafe(soundClick);
  summaryOverlay.style.display = "none";
  updateBackButtonUI();
});

// Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
helpBtn.addEventListener("click", () => {
  playSafe(soundClick);
  openPopupWithHistory(() => {
    helpOverlay.style.display = "flex";
  });
});

helpCloseBtn.addEventListener("click", () => {
  playSafe(soundClick);
  helpOverlay.style.display = "none";
  updateBackButtonUI();
});

// Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù…
saveNameBtn.addEventListener("click", () => {
  const name = playerNameInput.value.trim();
  if (name) {
    playerName = name;
    savePlayerName();
  }
  nameOverlay.style.display = "none";
  updateBackButtonUI();

  showPopup(
    "intro",
    `Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ ${playerName || ""} ğŸ’œ Ø§Ù„Ø§Ù† Ø´Ø§Ú¯Ø±Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ù‡Ø³ØªÛŒ. Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø±Ùˆ Ø±Ø¯ Ú©Ù†ÛŒØŒ Ø§Ø³ØªØ§Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ù…ÛŒâ€ŒØ´ÛŒ!`
  );
});

  window.onload = function () {
    loadSoundSetting();
    loadRecord();
    loadPlayerName();

    const hasState = loadGameState();
    if (hasState) {
      initLevel(false);
    } else {
      initLevel(true);
    }

    showNamePopupIfNeeded();

    if (playerName && !hasState) {
      showPopup("intro",
        `Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ ${playerName} ğŸ’œ Ø§Ù„Ø§Ù† Ø´Ø§Ú¯Ø±Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ù‡Ø³ØªÛŒ. Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø±Ùˆ Ø±Ø¯ Ú©Ù†ÛŒØŒ Ø§Ø³ØªØ§Ø¯ Ú©Ù„Ù…Ø§Øª Ø·Ø§ÙˆÛŒØªØ§ Ù…ÛŒâ€ŒØ´ÛŒ!`
      );
    }
  };
</script>





<script>
(function () {
  const tavitaBtn = document.getElementById("tavitaChannelBtn");

  function openInEitaaOrBrowser(url) {
    if (
      window.Eitaa &&
      window.Eitaa.WebApp &&
      typeof window.Eitaa.WebApp.openEitaaLink === "function"
    ) {
      try {
        window.Eitaa.WebApp.openEitaaLink(url);
        return;
      } catch (e) {}
    }
    window.location.href = url;
  }

  if (tavitaBtn) {
    tavitaBtn.addEventListener("click", () => {
      openInEitaaOrBrowser("https://eitaa.com/tavita");
    });
  }

  if (window.Eitaa && window.Eitaa.WebApp) {
  try {
    const wa = window.Eitaa.WebApp;

    if (typeof wa.ready === "function")  wa.ready();
    if (typeof wa.expand === "function") wa.expand();

    // Ø¨Ú©â€ŒØ¨Ø§ØªÙ† Ø§ÛŒØªØ§ â†’ ØªØ§Ø¨Ø¹ Ù…Ø´ØªØ±Ú© handleBackAction
    if (wa.BackButton && typeof wa.BackButton.onClick === "function") {
      wa.BackButton.onClick(handleBackAction);
    }
  } catch (e) {}
}
})();
</script>



  
</body>
</html>
