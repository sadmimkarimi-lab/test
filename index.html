<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ§Ù†Ú©ÛŒØªØ§ | Tankita</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  
  <!-- ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css" rel="stylesheet" />

 
<style>
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

    body{
      font-family: Vazir, Vazirmatn, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top,#111827,#020617);
      color:#f9fafb;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      padding:16px;
    }

    .game-wrapper{
      width:100%;
      max-width:420px;
    }

    /* Ù‡Ø¯Ø± Ú©Ø§Ø±Øªâ€ŒØ´Ø¯Ù‡ */
.header{
  display:flex;
  flex-direction: row;          /* Ø±Ø¯ÛŒÙ Ù…Ø¹Ù…ÙˆÙ„ÛŒ */
  justify-content:space-between;
  align-items:center;
  gap:10px;
  background:rgba(15,23,42,0.95);
  border-radius:20px;
  padding:8px 12px;
  border:1px solid rgba(148,163,184,.5);
  margin-bottom:12px;
  box-shadow:0 10px 30px rgba(15,23,42,.9);
}

    
/* Ø±Ø§Ø³Øª Ù‡Ø¯Ø±: Ù„ÙˆÚ¯Ùˆ Ø§ÙˆÙ„ + Ø¹Ù†ÙˆØ§Ù† Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† */
.header-right {
  display: flex;
  flex-direction: row; 
  align-items: center;
  gap: 6px;
  text-align: right;
  flex: 1;
  justify-content: flex-start;
}
    .logo-badge{
      width:64px;
      height:64px;
      border-radius:16px;
      background:radial-gradient(circle at top,#38bdf8,#0f172a);
      box-shadow:0 0 18px rgba(56,189,248,.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      font-size:20px;
      letter-spacing:1px;
      color:#e0faff;
      flex-shrink:0;
    }
  .title-block{
  display:flex;
  flex-direction:column;
  gap:2px;
  text-align:right;   
}
  .title-row{
  display:flex;
  align-items:center;
  gap:6px;
  justify-content:flex-start;
}
    h1{
      font-size:18px;
      font-weight:800;
      white-space:nowrap;
    }
    .subtitle{
      font-size:12px;
      opacity:.9;
      white-space:nowrap;
    }

    /* Ú†Ù¾ Ù‡Ø¯Ø±: ÙÙ‚Ø· Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§ */
    .header-left{
      display:flex;
      flex-direction:row;
      align-items:center;
      gap:6px;
    }
    .header-link{
      background:linear-gradient(135deg,#3b82f6,#0ea5e9);
      border:1px solid rgba(191,219,254,.9);
      color:#e5e7eb;
      cursor:pointer;
      padding:6px 11px;
      border-radius:999px;
      font-size:11px;
      font-weight:600;
      white-space:nowrap;
      box-shadow:0 6px 18px rgba(37,99,235,.8);
      transition:all .15s;
    }
    .header-link:hover{
      background:linear-gradient(135deg,#0ea5e9,#22c55e);
      border-color:rgba(190,242,100,1);
      color:#f9fafb;
      transform:translateY(-1px) scale(1.03);
      box-shadow:0 10px 24px rgba(34,197,94,.85);
    }
    .header-link:active{
      transform:translateY(1px) scale(.97);
      box-shadow:0 3px 10px rgba(15,23,42,.9);
    }

    .game-panel{
      background:radial-gradient(circle at top,#020617,#020617 60%,#000);
      border-radius:22px;
      padding:12px 12px 16px;
      box-shadow:0 16px 40px rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.3);
    }

    .canvas-wrap{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(148,163,184,.35);
      margin-bottom:10px;
    }
    canvas{ display:block; width:100%; height:auto; }

    /* Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ù„ÛŒ Ù¾ÛŒÚ©Ø³Ù„â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª */
    .stat-pill{
      display:inline-flex;
      align-items:center;
      gap:5px;
      padding:3px 9px;
      border-radius:999px;
      background:rgba(15,23,42,.85);
      border:1px solid rgba(148,163,184,.5);
      white-space:nowrap;
      transition:all .2s;
      font-size:11px;
    }
    .dot{
      width:6px;height:6px;border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 8px rgba(34,197,94,.9);
    }
    .badge-level{
      background:rgba(59,130,246,.2);
      border-color:rgba(59,130,246,.7);
    }
    .badge-coins{
      background:rgba(234,179,8,.12);
      border-color:rgba(234,179,8,.6);
    }
  .danger{
  background:rgba(248,113,113,0.2) !important;
  border-color:#ef4444 !important;
  animation:dangerPulse 0.6s ease-in-out 0s 2;
}
    @keyframes dangerPulse{
      0%{transform:scale(1);}
      50%{transform:scale(1.08);}
      100%{transform:scale(1);}
    }

    /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ÛŒ HUD (ØµØ¯Ø§ / Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª) */
    .top-actions{
      display:flex;
      align-items:center;
      gap:4px;
    }
    .top-icon-btn{
      width:30px;
      height:30px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      background:linear-gradient(135deg,#6366f1,#0ea5e9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:16px;
      padding:0;
      user-select:none;
      -webkit-user-select:none;
      box-shadow:0 6px 16px rgba(37,99,235,.8);
      transition:all .15s;
    }
    .top-icon-btn:hover{
      transform:translateY(-1px) scale(1.03);
      box-shadow:0 9px 22px rgba(59,130,246,.9);
    }
    .top-icon-btn:active{
      transform:translateY(1px) scale(.96);
      box-shadow:0 3px 10px rgba(15,23,42,.9);
    }

    /* HUD Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ */
    .hud{
      margin-top:6px;
      font-size:11px;
    }
    .hud-main{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:nowrap;
      margin-bottom:6px;
    }

    /* Ú©Ø§Ø¯Ø± ÙØ±ÙˆØ´Ú¯Ø§Ù‡ (Ù‡Ù…â€ŒÙ‚Ø¯ Ø¨Ø§ Ø¬ÙˆÙ†) */
  .shop-bar{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:4px;
  padding:2px 6px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.8);
  background:rgba(15,23,42,0.95);
  box-shadow:0 4px 12px rgba(15,23,42,0.9);
}

.shop-items{
  display:flex;
  align-items:center;
  gap:4px;
  flex:1;
  justify-content:flex-start;
}

.shop-item{
  display:flex;
  align-items:center;
  gap:2px;
  padding:1px 4px;
  border-radius:999px;
  background:rgba(30,64,175,0.9);
  border:1px solid rgba(129,140,248,0.9);
  cursor:pointer;
  font-size:10px;
}

.shop-item.passive{
  cursor:default;
  background:rgba(15,23,42,0.8);
  border-style:dashed;
}

.shop-icon{
  font-size:12px;
}

.shop-count{
  min-width:10px;
  text-align:center;
  font-weight:700;
  font-size:10px;
}

.shop-cart{
  width:26px;
  height:26px;
  border-radius:999px;
  border:1px solid rgba(248,113,113,0.9);
  background:radial-gradient(circle at center,#fecaca,#f97373);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  cursor:pointer;
  box-shadow:0 5px 14px rgba(248,113,113,0.8);
  user-select:none;
}
    .shop-cart:active{
      transform:scale(.95) translateY(1px);
      box-shadow:0 4px 12px rgba(15,23,42,.9);
    }

    .hud-sub{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }

    /* ØªÙˆØ¶ÛŒØ­Ø§Øª Ø²ÛŒØ± Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ */
    .controls-hint{
      margin-top:6px;
      font-size:11px;
      opacity:.85;
      line-height:1.7;
      text-align:right;
    }

    /* Ù¾ÛŒØ§Ù… Ø§Ù„Ù‡Ø§Ù…â€ŒØ¨Ø®Ø´ Ú©Ù†Ø§Ø± Ø§Ù…ØªÛŒØ§Ø² */
    .hud-hint{
      font-size:13px;
      opacity:.95;
      font-weight:500;
    }

    .overlay{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      justify-content:center; align-items:center;
      background:radial-gradient(circle at center,rgba(15,23,42,.35),rgba(15,23,42,.96));
      text-align:center; padding:14px; z-index:3;
    }
    .overlay.hidden{display:none;}
    .overlay h2{ font-size:19px; margin-bottom:6px; }
    .overlay p{
      font-size:12px; opacity:.9; margin-bottom:10px; line-height:1.9;
    }
    .overlay button{
      border:none; border-radius:999px;
      padding:7px 18px; font-size:13px; font-weight:600;
      cursor:pointer;
      background:linear-gradient(135deg,#ec4899,#6366f1);
      color:#fff; box-shadow:0 10px 26px rgba(129,140,248,.9);
      margin:2px;
    }
    .overlay .secondary{
      background:transparent;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:none;
    }

/* Ù…Ø®ØµÙˆØµ ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ */
#startOverlay button{
  width:100%;
  max-width:260px;
}

/* Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§Ø²ÛŒ */
#startOverlay #levelsBtn{
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:#ecfdf5;
  border:none;
  box-shadow:0 10px 26px rgba(34,197,94,0.85);
  margin-top:4px;
}

/* Ø¯Ú©Ù…Ù‡ Ø§Ø¯Ø§Ù…Ù‡ Ù…Ø«Ù„ Ù‚Ø¨Ù„ Ø³Ø§Ø¯Ù‡ Ø¨Ù…Ø§Ù†Ø¯ */
#startOverlay #continueBtn{
  background:transparent;
  border:1px solid rgba(148,163,184,.6);
  box-shadow:none;
}

  
    /* Controls */
    .controls{
      display:flex; justify-content:space-between;
      gap:10px; margin-top:8px; direction:ltr;
      animation:controlsPulse 3s ease-in-out 0s 2;
    }
    @keyframes controlsPulse{
      0%,100%{transform:translateY(0);}
      50%{transform:translateY(-3px);}
    }
    .ctrl-btn{
      flex:1; padding:14px 0; border-radius:22px;
      border:1px solid rgba(15,23,42,0.9);
      cursor:pointer; font-size:20px; font-weight:700;
      background:radial-gradient(circle at top,#1d4ed8,#0ea5e9);
      color:#e0faff; box-shadow:0 10px 32px rgba(59,130,246,.6);
      transition:transform .1s, box-shadow .15s, transform .15s;
      user-select:none;
      -webkit-user-select:none;
      text-shadow:0 0 8px rgba(15,23,42,.9);
    }
    .ctrl-btn:active{
      transform:scale(.9) translateY(1px);
      box-shadow:0 4px 16px rgba(15,23,42,.8);
    }
    .ctrl-btn.fire{
      flex:1.4;
      background:radial-gradient(circle at top,#f97316,#e11d48);
      box-shadow:0 12px 36px rgba(239,68,68,.7);
    }

    /* Modal base */
    .modal{
      position:fixed; inset:0;
      display:flex; justify-content:center; align-items:center;
      background:rgba(15,23,42,0.9);
      z-index:50;
    }
    .modal.hidden{ display:none; }
    .modal-box{
      background:radial-gradient(circle at top,#020617,#020617 60%,#000);
      border-radius:20px;
      padding:18px;
      max-width:380px;
      width:92%;
      border:1px solid rgba(148,163,184,0.45);
      box-shadow:0 18px 40px rgba(15,23,42,0.95);
      text-align:right;
    }

  /* ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ Ù…Ø±Ø§Ø­Ù„: Ø§Ø±ØªÙØ§Ø¹ Ù…Ø­Ø¯ÙˆØ¯ + Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¯Ø§Ø®Ù„ÛŒ */
#levelModal .modal-box{
  max-height:82vh;
  overflow-y:auto;
}
    .modal-box h2{ font-size:16px; margin-bottom:6px; }
    .modal-box p{
      font-size:12px; line-height:1.9; opacity:0.9; margin-bottom:10px;
    }
    .modal-actions{
      display:flex; justify-content:flex-end; gap:8px; margin-top:10px;
    }
    .modal-actions button{
      border:none; border-radius:999px;
      padding:6px 14px; font-size:12px; cursor:pointer;
      background:linear-gradient(135deg,#6366f1,#0ea5e9);
      color:#f9fafb;
    }
    .modal-actions .secondary{
      background:transparent;
      border:1px solid rgba(148,163,184,.6);
    }

    /* Shop modal */
    .shop-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:8px;
    }
    .shop-card{
      background:rgba(2,6,23,.9);
      border:1px solid rgba(148,163,184,.35);
      border-radius:14px;
      padding:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .shop-info{
      display:flex; flex-direction:column; gap:4px;
    }
    .shop-title{
      font-size:13px; font-weight:800;
    }
    .shop-desc{
      font-size:11px; opacity:.85; line-height:1.7;
    }
    .shop-buy{
      border:none; border-radius:999px;
      padding:6px 12px; font-size:12px; font-weight:700;
      cursor:pointer;
      background:linear-gradient(135deg,#f59e0b,#ef4444);
      color:#fff;
      white-space:nowrap;
      box-shadow:0 8px 20px rgba(239,68,68,.7);
    }
    .shop-buy:disabled{
      opacity:.5; cursor:not-allowed;
      box-shadow:none;
    }
    .shop-coins{
      margin-top:4px;
      font-size:12px;
      opacity:.9;
    }

    @media(max-width:480px){
      h1{font-size:17px;}
      .subtitle{font-size:11px;}
      .logo-badge{width:56px;height:56px;}
    }



/* Ø¯Ú©Ù…Ù‡â€ŒÛŒ Ù…Ø±Ø­Ù„Ù‡ ØªÙˆÛŒ HUD Ú©Ù„ÛŒÚ©â€ŒØ®ÙˆØ± Ø¨Ø§Ø´Ø¯ */
.badge-level{
  cursor:pointer;
}

/* Ú¯Ø±ÛŒØ¯ Ù…Ø±Ø§Ø­Ù„ â€“ Û´ Ø³ØªÙˆÙ†ØŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†ÛŒÚ© */
.level-grid{
  margin-top:12px;
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:8px;
}

/* Ù‡Ø± Ú©Ø§Ø±Øª Ù…Ø±Ø­Ù„Ù‡ */
.level-btn{
  border:none;
  border-radius:16px;
  padding:6px 4px;
  font-size:11px;
  cursor:pointer;
  background:linear-gradient(135deg,#020617,#020617);
  color:#e5e7eb;
  box-shadow:0 8px 18px rgba(15,23,42,0.9);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  gap:4px;
}

/* ØªØµÙˆÛŒØ± ØºÙˆÙ„ */
.level-boss-thumb{
  width:52px;
  height:52px;
  border-radius:14px;
  object-fit:cover;
  box-shadow:0 0 0 2px rgba(15,23,42,0.9),
             0 8px 18px rgba(15,23,42,0.95);
}

/* Ù…ØªÙ† Ø²ÛŒØ± ØªØµÙˆÛŒØ± */
.level-btn .level-label{
  text-align:center;
  font-weight:600;
}

/* ØªØµÙˆÛŒØ± ØºÙˆÙ„ Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ (Ø¯Ø§Ø®Ù„ Ø¯Ú©Ù…Ù‡) */
.level-boss-thumb{
  width:50px;
  height:50px;
  border-radius:14px;
  object-fit:cover;
  box-shadow:0 0 0 2px rgba(15,23,42,0.9),
             0 10px 22px rgba(15,23,42,0.9);
}

/* Ù…Ø±Ø­Ù„Ù‡ ÙØ¹Ù„ÛŒ */
.level-btn.current{
  background:linear-gradient(135deg,#16a34a,#22c55e);
}

/* Ù…Ø±Ø§Ø­Ù„ Ù‚ÙÙ„ Ø´Ø¯Ù‡ */
.level-btn.locked{
  background:#020617;
  color:#9ca3af;
  border:1px dashed rgba(148,163,184,.7);
  box-shadow:none;
  cursor:not-allowed;
}

/* ØºÙˆÙ„Ù Ù…Ø±Ø­Ù„Ù‡ Ù‚ÙÙ„â€ŒØ´Ø¯Ù‡Ø› Ú©Ù…â€ŒØ±Ù†Ú¯ Ùˆ Ø³ÛŒØ§Ù‡â€ŒÙˆØ³ÙÛŒØ¯ */
.level-btn.locked .level-boss-thumb{
  opacity:0.4;
  filter:grayscale(1);
}


  

/* ===== Ø§ÛŒÙ†ØªØ±ÙˆÛŒ ÙˆÛŒØ¯Ø¦ÙˆÛŒÛŒ ===== */
.intro-screen{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:100;
}

.intro-video{
  width:100%;
  max-width:420px;
  border-radius:18px;
  background:#000;
  box-shadow:0 20px 40px rgba(0,0,0,.9);
}


.intro-loader{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:150;
}

.intro-loader-bar{
  width:60%;
  max-width:260px;
  height:6px;
  border-radius:999px;
  background:#111827;
  overflow:hidden;
  box-shadow:0 0 18px rgba(59,130,246,0.9);
  margin-bottom:10px;
}

.intro-loader-fill{
  width:40%;
  height:100%;
  border-radius:999px;
  background:linear-gradient(90deg,#3b82f6,#a855f7,#f97316);
  animation:introLoading 1.1s linear infinite;
}

.intro-loader-text{
  font-size:13px;
  color:#e5e7eb;
  opacity:0.9;
}

@keyframes introLoading{
  0%{ transform:translateX(-120%); }
  100%{ transform:translateX(220%); }
}
    
/* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ¯Ø¦ÙˆÛŒ Ø§ÛŒÙ†ØªØ±Ùˆ â€“ Ù†ÙˆØ§Ø± Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„ Ø²ÛŒØ± ÙˆÛŒØ¯Ø¦Ùˆ */
.intro-controls{
  margin-top:10px;
  display:flex;
  gap:8px;
  padding:4px 10px;
  border-radius:999px;
  background:rgba(15,23,42,0.65);
  border:1px solid rgba(30,64,175,0.7);
  box-shadow:0 10px 24px rgba(15,23,42,0.9);
  backdrop-filter:blur(10px);
}

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†ØªØ±Ùˆ (Ú©ÙˆÚ†ÛŒÚ© Ùˆ Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„) */
.intro-btn{
  border-radius:999px;
  border:1px solid transparent;
  padding:4px 10px;
  font-size:11px;
  font-weight:500;
  cursor:pointer;
  white-space:nowrap;
  display:flex;
  align-items:center;
  gap:4px;
}

/* Ø¯Ú©Ù…Ù‡ ØµØ¯Ø§ â€“ ØªÛŒØ±Ù‡ Ùˆ Ø³Ø§Ø¯Ù‡ */
.intro-btn.mute{
  background:transparent;
  color:#e5e7eb;
  border-color:rgba(148,163,184,0.7);
}

/* Ø¯Ú©Ù…Ù‡ Ø±Ø¯ Ú©Ø±Ø¯Ù† â€“ Ú¯Ø±Ø§Ø¯ÛŒØ§Ù† Ú©ÙˆÚ†ÛŒÚ© Ùˆ Ø¬Ø°Ø§Ø¨ */
.intro-btn.skip{
  background:linear-gradient(135deg,#f97316,#ec4899);
  color:#fff;
  box-shadow:0 8px 18px rgba(248,113,113,0.8);
}
.hidden-game{
  display:none;
}

/* Ù†ÙˆØ§Ø± Ø¬ÙˆÙ† Ø¨Ø§Ø³ */
#bossHpBar {
  position: absolute;
  top: 5%;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  height: 16px;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.9);
  box-shadow: 0 0 18px rgba(248, 113, 113, 0.7);
  overflow: hidden;
  pointer-events: none;
  z-index: 5;
}

/* ÙˆÙ‚ØªÛŒ Ù†ÙˆØ§Ø± Ø¨Ø§Ø³ hidden Ø¨Ø´Ù‡ØŒ Ú©Ù„Ø§Ù‹ Ø§Ø² ØµÙØ­Ù‡ Ø¨Ø±Ù‡ */
#bossHpBar.hidden {
  display: none;
}
  
/* Ù¾Ø±Ø´Ø¯Ú¯ÛŒ Ù†ÙˆØ§Ø± */
#bossHpFill {
  height: 100%;
  width: 100%;
  background: linear-gradient(90deg, #22c55e, #eab308, #f97316, #ef4444);
  box-shadow: 0 0 14px rgba(248, 113, 113, 0.9);
  transition: width 0.18s ease-out;
}

/* Ø¹Ø¯Ø¯ HP ÙˆØ³Ø· Ù†ÙˆØ§Ø± */
#bossHpText {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: "Vazir", Vazirmatn, system-ui;
  font-size: 11px;
  font-weight: 700;
  color: #e5f6ff;
  text-shadow: 0 0 6px #020617;
}

.hidden{
  opacity:0;
  pointer-events:none;
}

/* Ù„Ø±Ø²Ø´ ØµÙØ­Ù‡ Ù‡Ù†Ú¯Ø§Ù… Ù…Ø±Ú¯ Ø¨Ø§Ø³ */
@keyframes bossDieShake {
  0%   { transform: translate(0,0); }
  15%  { transform: translate(-12px, 10px); }
  30%  { transform: translate(10px, -12px); }
  45%  { transform: translate(-14px, 8px); }
  60%  { transform: translate(12px, -10px); }
  75%  { transform: translate(-10px, 12px); }
  100% { transform: translate(0,0); }
}

.screen-shake {
  animation: bossDieShake 0.75s ease-out; /* Ù…Ø¯Øª Ø¨ÛŒØ´ØªØ± */
}
/* Ø§Ù†ÙØ¬Ø§Ø± / Ø¯ÙˆØ¯ Ø¨Ù†ÙØ´ */
@keyframes bossExplosion {
  0%   { opacity: 1; transform: scale(0.4); filter: blur(0px); }
  50%  { opacity: 1; transform: scale(2.4); filter: blur(2px); }
  100% { opacity: 0; transform: scale(3.1); filter: blur(4px); }
}

.boss-death-flash {
  position: absolute;
  left: 50%;     /* Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ØŒ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¨Ø§ JS override Ù…ÛŒâ€ŒØ´Ù‡ */
  top: 50%;
  width: 220px;
  height: 220px;
  transform: translate(-50%, -50%);
  background: radial-gradient(
    circle,
    rgba(0,0,0,0.85) 0%,      /* Ù…Ø±Ú©Ø² Ø®ÛŒÙ„ÛŒ ØªÛŒØ±Ù‡ */
    rgba(76,29,149,0.90) 35%, /* Ø¨Ù†ÙØ´ Ø®ÛŒÙ„ÛŒ ØªÛŒØ±Ù‡ */
    rgba(147,51,234,0.85) 70%,/* Ø¨Ù†ÙØ´ Ø±ÙˆØ´Ù†â€ŒØªØ± Ù…Ø«Ù„ Ø¯ÙˆØ¯ */
    rgba(15,23,42,0) 100%     /* Ù…Ø­Ùˆ Ø´Ø¯Ù† */
  );
  border-radius: 50%;
  pointer-events: none;
  z-index: 30;
  animation: bossExplosion 0.9s forwards;
}
    
  </style>
</head>
<body>

<div id="introLoader" class="intro-loader">
  <div class="intro-loader-bar">
    <div class="intro-loader-fill"></div>
  </div>
  <div class="intro-loader-text">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø¨Ø±Ø¯...</div>
</div>
  
<!-- ØµÙØ­Ù‡ Ø§ÛŒÙ†ØªØ±ÙˆÛŒ ÙˆÛŒØ¯Ø¦ÙˆÛŒÛŒ -->
  <div id="introScreen" class="intro-screen">
    <video
      id="introVideo"
      class="intro-video"
      src="https://cdnfa.com/irangiah/a9be/uploads/tank/tankk.mp4"
      autoplay
      playsinline
      muted
    ></video>

<audio id="startSfx" src="https://cdn.jsdelivr.net/gh/itsrahaa/sfx/tank-start.mp3" preload="auto"></audio>
    
    <div class="intro-controls">
      <button id="introMuteBtn" class="intro-btn mute">ğŸ”‡ ØµØ¯Ø§</button>
      <button id="introSkipBtn" class="intro-btn skip">Ø±Ø¯ Ú©Ø±Ø¯Ù† â­ï¸</button>
    </div>
  </div>

  <!-- Ø´Ø±ÙˆØ¹ Ù…Ø­ÛŒØ· Ø¨Ø§Ø²ÛŒ (ÙØ¹Ù„Ø§Ù‹ Ù…Ø®ÙÛŒ) -->
  <div class="game-wrapper hidden-game" id="gameWrapper">

    <!-- Ù‡Ø¯Ø± -->
    <header class="header">
      <!-- Ø±Ø§Ø³Øª: Ù„ÙˆÚ¯Ùˆ Ø¨Ø¹Ø¯ Ø¹Ù†ÙˆØ§Ù† -->
      <div class="header-right">
        <div class="logo-badge">T</div>
        <div class="title-block">
          <div class="title-row">
            <h1>ØªØ§Ù†Ú©ÛŒØªØ§</h1>
          </div>
          <div class="subtitle">Ø¨Ø§ ØªØ§Ù†Ú© Ø§Ø±Ø§Ø¯Ù‡ØŒ Ù‚Ù„Ù…Ø±Ùˆ Ø°Ù‡Ù†Øª Ø±Ùˆ Ù¾Ø§Ú© Ú©Ù†.</div>
        </div>
      </div>

      <!-- Ú†Ù¾: ÙÙ‚Ø· Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§ -->
      <div class="header-left">
        <button class="header-link" id="aboutBtn">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</button>
      </div>
    </header>

    <div class="game-panel">

      <div class="canvas-wrap">
      <canvas id="gameCanvas"></canvas>

<div id="bossHpBar" class="hidden">
  <div id="bossHpFill"></div>
  <span id="bossHpText"></span>
</div>
        
        <!-- Ø´Ø±ÙˆØ¹ -->
        <div id="startOverlay" class="overlay">
  <h2>ØªØ§Ù†Ú©ÛŒØªØ§ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Øª ğŸš€</h2>
  <p>
    Ø¨Ø§ ØªØ§Ù†Ú© Ø§Ø±Ø§Ø¯Ù‡â€ŒØ§ØªØŒ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø±Ùˆ Ù†Ø§Ø¨ÙˆØ¯ Ú©Ù† Ùˆ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡<br/>
    ØºÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ù„Ù…Ø±Ùˆ Ø°Ù‡Ù†Øª Ø±Ùˆ Ø´Ú©Ø³Øª Ø¨Ø¯Ù‡. <br>
    Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Â«Ø´Ø±ÙˆØ¹ Ø§Ø² Ù…Ø±Ø­Ù„Ù‡ Û±Â» Ø¨Ø²Ù†.
  </p>

  <button id="startBtn">Ø´Ø±ÙˆØ¹ Ø§Ø² Ù…Ø±Ø­Ù„Ù‡ Û±</button>
  <button id="continueBtn" class="secondary">Ø§Ø¯Ø§Ù…Ù‡ Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡</button>
  <!-- ğŸ‘‡ Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ -->
  <button id="levelsBtn" class="secondary">Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§Ø²ÛŒ</button>
</div>

        <!-- Ù¾Ø§ÛŒØ§Ù† Ù…Ø±Ø­Ù„Ù‡ -->
        <div id="levelOverlay" class="overlay hidden">
          <h2>Ù…Ø±Ø­Ù„Ù‡ ØªÙ…ÙˆÙ… Ø´Ø¯! ğŸ‰</h2>
          <p>
            ØºÙˆÙ„ Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ù†Ø§Ø¨ÙˆØ¯ Ø´Ø¯ Ùˆ Ù…Ø³ÛŒØ± Ø°Ù‡Ù† ØªÙ…ÛŒØ² Ø´Ø¯.<br/>
            Û² Ø¬Ø§Ù† Ù‡Ø¯ÛŒÙ‡ Ú¯Ø±ÙØªÛŒØ› Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±ÛŒ Ø³Ø±Ø§Øº ØºÙˆÙ„ Ø¨Ø¹Ø¯ÛŒØŸ
          </p>
          <button id="nextLevelBtn">Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ â–¶ï¸</button>
        </div>

        <!-- Ú¯ÛŒÙ…â€ŒØ§ÙˆØ± -->
        <div id="gameOverOverlay" class="overlay hidden">
          <h2>Ù¾Ø§ÛŒØ§Ù† Ø§ÛŒÙ† Ø¯ÙˆØ± ğŸ’”</h2>
          <p>
            Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ø¯ÙˆØ±: <span id="finalScore">0</span><br>
            Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²: <span id="bestScore">0</span>
          </p>
          <button id="restartBtn">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Ø§Ø² Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„</button>
        </div>
      </div>

      <!-- HUD Ù¾Ø§ÛŒÛŒÙ†: Ø¬Ø§Ù† / Ø³Ú©Ù‡ / ÙØ±ÙˆØ´Ú¯Ø§Ù‡ / ØµØ¯Ø§ / Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª -->
      <div class="hud">
      <div class="hud-main">
  <!-- Û±. Ø³Ú©Ù‡ -->
  <span class="stat-pill badge-coins">
    ğŸª™ <span id="coins">0</span>
  </span>

  <!-- Û². Ú©Ø§Ø¯Ø± ÙØ±ÙˆØ´Ú¯Ø§Ù‡ (Ø¬Ø§Ù† + Ø²Ù…Ø§Ù† + Ø³Ù¾Ø± + Ù…ÙˆØ´Ú© + Ø³Ù‡â€ŒØªØ§ÛŒÛŒ) -->
  <div class="shop-bar">
    <div class="shop-items">
      <!-- Ø¬Ø§Ù† - ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ØŒ Ú©Ù„ÛŒÚ©â€ŒØ®ÙˆØ± Ù†ÛŒØ³Øª -->
      <div class="shop-item passive" id="lifeDisplay">
        <span class="shop-icon">â¤ï¸</span>
        <span class="shop-count" id="lives">3</span>
      </div>

      <!-- Ø²Ù…Ø§Ù† Ú©Ù†Ø¯Ú©Ù†Ù†Ø¯Ù‡ -->
      <div class="shop-item" id="slowUseBtn">
        <span class="shop-icon">â³</span>
        <span class="shop-count" id="slowCount">0</span>
      </div>

      <!-- Ø³Ù¾Ø± -->
      <div class="shop-item" id="shieldUseBtn">
        <span class="shop-icon">ğŸ›¡</span>
        <span class="shop-count" id="shieldCount">0</span>
      </div>

      <!-- Ù…ÙˆØ´Ú© -->
      <div class="shop-item" id="rocketUseBtn">
        <span class="shop-icon">ğŸš€</span>
        <span class="shop-count" id="rocketCount">0</span>
      </div>

      <!-- Ø´Ù„ÛŒÚ© Ø³Ù‡â€ŒØªØ§ÛŒÛŒ -->
      <div class="shop-item" id="tripleUseBtn">
        <span class="shop-icon">âœ–ï¸3</span>
        <span class="shop-count" id="tripleCount">0</span>
      </div>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
    <button class="shop-cart" id="shopBtn" title="Ø´Ø§Ù¾">
      ğŸ›’
    </button>
  </div>

  <!-- Û³. ØµØ¯Ø§ + ØªÙˆÙ‚Ù/Ø§Ø¯Ø§Ù…Ù‡ -->
  <div class="top-actions">
    <button class="top-icon-btn" id="soundToggle" title="Ù‚Ø·Ø¹/ÙˆØµÙ„ ØµØ¯Ø§">ğŸ”Š</button>
    <button class="top-icon-btn" id="pauseBtn" title="ØªÙˆÙ‚Ù/Ø§Ø¯Ø§Ù…Ù‡">â¸ï¸</button>
  </div>
</div>

          

        <!-- Ø§Ù…ØªÛŒØ§Ø² / Ù…Ø±Ø­Ù„Ù‡ + Ù¾ÛŒØ§Ù… Ø§Ù„Ù‡Ø§Ù…â€ŒØ¨Ø®Ø´ -->
        <div class="hud-sub">
          <span class="stat-pill">
            <span class="dot"></span> Ø§Ù…ØªÛŒØ§Ø²: <span id="score">0</span>
          </span>
          <span class="stat-pill badge-level">
            Ù…Ø±Ø­Ù„Ù‡: <span id="levelLabel">Û±</span>
          </span>
          <span class="hud-hint" id="motivationText"></span>
        </div>
      </div>

      <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ -->
      <div class="controls">
        <button class="ctrl-btn" id="leftBtn">â—€ï¸</button>
        <button class="ctrl-btn fire" id="fireBtn">ğŸ”¥</button>
        <button class="ctrl-btn" id="rightBtn">â–¶ï¸</button>
      </div>

      <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª Ø²ÛŒØ± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ -->
      <div class="controls-hint">
        <div>Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.</div>
        <div>Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±: â—€ï¸â–¶ï¸ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©ØªØŒ Space Ø¨Ø±Ø§ÛŒ Ø´Ù„ÛŒÚ© | Ù…ÙˆØ¨Ø§ÛŒÙ„: Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.</div>
      </div>

    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø·Ø§ÙˆÛŒØªØ§ -->
  <div class="modal hidden" id="aboutModal">
    <div class="modal-box">
      <h2>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø·Ø§ÙˆÛŒØªØ§</h2>
      <p>
        Ø·Ø§ÙˆÛŒØªØ§ ÛŒÚ© ØªÛŒÙ… Ú©ÙˆÚ†Ú© Ø§Ù…Ø§ Ø¹Ø§Ø´Ù‚ Â«Ø±Ø´Ø¯ Ø°Ù‡Ù† Ùˆ Ø¨Ø§Ø²ÛŒâ€ŒØ³Ø§Ø²ÛŒÂ» Ø§Ø³Øª.
        Ù…Ø§ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒÛŒ Ù…ÛŒâ€ŒØ³Ø§Ø²ÛŒÙ… Ú©Ù‡ Ù‡Ù… Ø³Ø±Ú¯Ø±Ù… Ú©Ù†Ù†Ø¯ØŒ Ù‡Ù… Ø°Ù‡Ù† Ø±Ø§ Ø¨Ù‡ Ú†Ø§Ù„Ø´ Ø¨Ú©Ø´Ù†Ø¯
        Ùˆ Ø¯Ø± Ù…Ø³ÛŒØ± ØªØ±Ú© Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ùˆ Ø­Ø±Ú©Øª Ø¨Ù‡ Ø³Ù…Øª Ø®ÙˆØ¨ÛŒâ€ŒÙ‡Ø§ Ù‡Ù…Ø±Ø§Ù‡Øª Ø¨Ø§Ø´Ù†Ø¯.
      </p>
      <div class="modal-actions">
        <button class="secondary" id="aboutCloseBtn">Ø¨Ø³ØªÙ†</button>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
  <div class="modal hidden" id="shopModal">
    <div class="modal-box">
      <h2>Ø´Ø§Ù¾ ØªØ§Ù†Ú©ÛŒØªØ§ ğŸ›’</h2>
      <p>
        Ø¨Ø§ Ø³Ú©Ù‡â€ŒÙ‡Ø§ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù‚Ø¯Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ø¨Ú¯ÛŒØ±ÛŒ Ùˆ Ø¨Ø¹Ø¯Ø§Ù‹ Ù‡Ø± ÙˆÙ‚Øª Ø®ÙˆØ§Ø³ØªÛŒ
        Ø§Ø² Ø¯Ø§Ø®Ù„ Ú©Ø§Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡â€ŒØ´ÙˆÙ† Ú©Ù†ÛŒ.
      </p>

      <div class="shop-coins">
        Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§: <span id="shopCoins">0</span> ğŸª™
      </div>

      <div class="shop-grid">

  <!-- Ø´Ù„ÛŒÚ© Ø³Ù‡â€ŒØªØ§ÛŒÛŒ -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">Ø´Ù„ÛŒÚ© Ø³Ù‡â€ŒØªØ§ÛŒÛŒ Ã—3</div>
      <div class="shop-desc">Ù‚Ø¯Ø±Øª Ø´Ù„ÛŒÚ© Ø³Ù‡â€ŒØªØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡.</div>
      <div class="shop-desc">Ù‚ÛŒÙ…Øª: Û³Û°Û° ğŸª™</div>
    </div>
    <button class="shop-buy" id="buyTripleBtn">Ø®Ø±ÛŒØ¯</button>
  </div>

  <!-- Ø­ÙØ§Ø¸ Ø§Ù†Ø±Ú˜ÛŒ -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">Ø­ÙØ§Ø¸ Ø§Ù†Ø±Ú˜ÛŒ ğŸ›¡</div>
      <div class="shop-desc">Ø³Ù¾Ø± Ù…Ø­Ø§ÙØ¸ Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø¶Ø±Ø¨Ù‡â€ŒÙ‡Ø§.</div>
      <div class="shop-desc">Ù‚ÛŒÙ…Øª: Û±ÛµÛ° ğŸª™</div>
    </div>
    <button class="shop-buy" id="buyShieldBtn">Ø®Ø±ÛŒØ¯</button>
  </div>

  <!-- Ù…ÙˆØ´Ú© ÙˆÛŒÚ˜Ù‡ -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">Ù…ÙˆØ´Ú© ÙˆÛŒÚ˜Ù‡ ğŸš€</div>
      <div class="shop-desc">Ù…ÙˆØ´Ú© Ø®ÛŒÙ„ÛŒ Ù‚ÙˆÛŒ ØºÙˆÙ„ Ú©Ø´.</div>
      <div class="shop-desc">Ù‚ÛŒÙ…Øª: Û²Û°Û° ğŸª™</div>
    </div>
    <button class="shop-buy" id="buyRocketBtn">Ø®Ø±ÛŒØ¯</button>
  </div>

  <!-- Ø¬Ø§Ù† Ø§Ø¶Ø§ÙÙ‡ -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">Ø¬Ø§Ù† Ø§Ø¶Ø§ÙÙ‡ â¤ï¸</div>
      <div class="shop-desc">ÛŒÚ© Ø¬Ø§Ù† Ø§Ø¶Ø§ÙÙ‡Ø› Ø­Ø¯Ø§Ú©Ø«Ø± Û· Ø¨Ø§Ø±.</div>
      <div class="shop-desc">Ù‚ÛŒÙ…Øª: Û·ÛµÛ° ğŸª™</div>
    </div>
    <button class="shop-buy" id="buyLifeBtn">Ø®Ø±ÛŒØ¯</button>
  </div>

  <!-- Ú©Ù†Ø¯ Ú©Ø±Ø¯Ù† Ø²Ù…Ø§Ù† -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">Ú©Ù†Ø¯ Ú©Ø±Ø¯Ù† Ø²Ù…Ø§Ù† â³</div>
      <div class="shop-desc">Ø¯Ø´Ù…Ù†â€ŒÙ‡Ø§ Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ Ø¢Ù‡Ø³ØªÙ‡ Ù…ÛŒâ€ŒØ´Ù†.</div>
      <div class="shop-desc">Ù‚ÛŒÙ…Øª: ÛµÛµÛ° ğŸª™</div>
    </div>
    <button class="shop-buy" id="buySlowBtn">Ø®Ø±ÛŒØ¯</button>
  </div>

</div>

      <div class="modal-actions">
        <button class="secondary" id="shopCloseBtn">Ø¨Ø³ØªÙ†</button>
      </div>
    </div>
  </div>


<!-- Ù…ÙˆØ¯Ø§Ù„ Ù…Ø±Ø§Ø­Ù„ -->
<div class="modal hidden" id="levelModal">
  <div class="modal-box">
    <h2>Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§Ø²ÛŒ</h2>
    <p style="font-size:11px;opacity:.85;margin-top:4px;">
      Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§Ø² Ø´Ø¯Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒ. Ø¨Ù‚ÛŒÙ‡ Ù‚ÙÙ„ Ù‡Ø³ØªÙ†Ø¯.
    </p>

    <div class="level-grid" id="levelGrid"></div>

    <div class="modal-actions">
      <button class="secondary" id="levelCloseBtn">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>
</div>


  
  <script>
    // ======== Canvas & Ø§Ù†Ø¯Ø§Ø²Ù‡ ========
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");


// ======== Intro Video ========
const introScreen = document.getElementById("introScreen");
const gameWrapper = document.getElementById("gameWrapper");
const introVideo   = document.getElementById("introVideo");
const introLoader  = document.getElementById("introLoader");
    const introMuteBtn = document.getElementById("introMuteBtn");
const introSkipBtn = document.getElementById("introSkipBtn");

introVideo.addEventListener("loadeddata", () => {
  introLoader.style.transition = "opacity 0.3s ease";
  introLoader.style.opacity = "0";
  setTimeout(() => {
    introLoader.style.display = "none";
  }, 300);
});

    
function finishIntro(){
  const startSfx = document.getElementById("startSfx");

  // ÙÛŒØ¯ Ø§ÙˆØª Ù‚Ø´Ù†Ú¯
  introScreen.style.transition = "opacity 0.7s ease";
  introScreen.style.opacity = "0";

  setTimeout(() => {
    introScreen.style.display = "none";
    gameWrapper.classList.remove("hidden-game");


// Ø¨Ø¹Ø¯ Ø§Ø² Ø¸Ø§Ù‡Ø± Ø´Ø¯Ù† Ø¨Ø§Ø²ÛŒØŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø³Ù…Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    setTimeout(()=>{
      try{
        fireBtn.scrollIntoView({ behavior:"smooth", block:"end" });
      }catch(e){}
    }, 100);

    
    // Ù¾Ø®Ø´ ØµØ¯Ø§ÛŒ Ø´Ø±ÙˆØ¹ (Ø§Ú¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡ Ø¨Ø¯Ù‡)
    if (startSfx) {
      startSfx.currentTime = 0;
      startSfx.play().catch(()=>{});
    }
  }, 700);

  introVideo.pause();
  introVideo.currentTime = 0;
}

introVideo.addEventListener("ended", finishIntro);

introSkipBtn.addEventListener("click", finishIntro);

introMuteBtn.addEventListener("click", ()=>{
  introVideo.muted = !introVideo.muted;
  introMuteBtn.textContent = introVideo.muted ? "ğŸ”‡ ØµØ¯Ø§" : "ğŸ”Š ØµØ¯Ø§";
});

    
    function resizeCanvas(){
      const maxWidth = 420, ratio = 9/16;
      const width = Math.min(maxWidth, window.innerWidth - 32);
      const height = width / ratio;
      canvas.width = width; canvas.height = height;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    // ======== Ø¹Ù†Ø§ØµØ± UI ========
    const scoreEl = document.getElementById("score");
    const livesEl = document.getElementById("lives");
    const coinsEl = document.getElementById("coins");
    const levelLabel = document.getElementById("levelLabel");
    const resetRunBtn = document.getElementById("resetRunBtn");
    const lifeDisplay = document.getElementById("lifeDisplay");

    const startOverlay = document.getElementById("startOverlay");
    const levelOverlay = document.getElementById("levelOverlay");
    const gameOverOverlay = document.getElementById("gameOverOverlay");

    const startBtn = document.getElementById("startBtn");
    const continueBtn = document.getElementById("continueBtn");
    const nextLevelBtn = document.getElementById("nextLevelBtn");
    const restartBtn = document.getElementById("restartBtn");
    const levelsBtn     = document.getElementById("levelsBtn");
const levelModal    = document.getElementById("levelModal");
const levelGrid     = document.getElementById("levelGrid");
const levelCloseBtn = document.getElementById("levelCloseBtn");
const levelBadge    = document.querySelector(".badge-level");
    
    const finalScoreEl = document.getElementById("finalScore");
    const bestScoreEl = document.getElementById("bestScore");

    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");
    const fireBtn = document.getElementById("fireBtn");

    const aboutBtn = document.getElementById("aboutBtn");
    const shopBtn = document.getElementById("shopBtn");
    const aboutModal = document.getElementById("aboutModal");
    const shopModal = document.getElementById("shopModal");
    const aboutCloseBtn = document.getElementById("aboutCloseBtn");
    const shopCloseBtn = document.getElementById("shopCloseBtn");

    const buyTripleBtn = document.getElementById("buyTripleBtn");
const buyShieldBtn = document.getElementById("buyShieldBtn");
const buyRocketBtn = document.getElementById("buyRocketBtn");
const buyLifeBtn   = document.getElementById("buyLifeBtn");
const buySlowBtn   = document.getElementById("buySlowBtn");
const shopCoinsEl  = document.getElementById("shopCoins");

    const soundToggleBtn = document.getElementById("soundToggle");
const pauseBtn = document.getElementById("pauseBtn");
    
    // Ø¢ÛŒÚ©Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ
    const shieldUseBtn = document.getElementById("shieldUseBtn");
const rocketUseBtn = document.getElementById("rocketUseBtn");
const tripleUseBtn = document.getElementById("tripleUseBtn");
const slowUseBtn   = document.getElementById("slowUseBtn");

const shieldCountEl = document.getElementById("shieldCount");
const rocketCountEl = document.getElementById("rocketCount");
const tripleCountEl = document.getElementById("tripleCount");
const slowCountEl   = document.getElementById("slowCount");

    const motivationTextEl = document.getElementById("motivationText");
    const MOTIVATIONS = [
      "ÛŒØ§Ø¯ Ø®Ø¯Ø§ Ø¨Ù‡ Ù‚Ù„Ø¨ Ø¢Ø±Ø§Ù…Ø´ Ù…ÛŒâ€ŒØ¨Ø®Ø´Ù‡.",
      "Ø¯Ø± Ù‡ÛŒÚ† Ø­Ø§Ù„ØªÛŒ Ø§Ø² ÛŒØ§Ø¯ Ø®Ø¯Ø§ ØºØ§ÙÙ„ Ù†Ø´Ùˆ.",
      "Ø¹Ø´Ù‚ Ø¨Ù‡ Ù¾Ø¯Ø± Ùˆ Ù…Ø§Ø¯Ø± Ø¹Ø´Ù‚ Ø¨Ù‡ Ø®Ø¯Ø§Ø³Øª.",
      "Ù…Ø­Ø¨ØªØŒ Ø§Ø®Ù„Ø§Ù‚ØŒ Ø§Ø¯Ø¨ Ú¯Ù†Ø¬â€ŒÙ‡Ø§ÛŒ ØªÙˆØ³Øª."
    ];
    let motivationIndex = 0;
    function updateMotivation(){
      if(!motivationTextEl) return;
      motivationTextEl.textContent = MOTIVATIONS[motivationIndex];
      motivationIndex = (motivationIndex + 1) % MOTIVATIONS.length;
    }

    // ======== Ø³ÛŒØ³ØªÙ… ØµØ¯Ø§ (Ø³Ø§Ø¯Ù‡) ========
    let soundEnabled = true;
    let audioCtx = null;

    function playTone(freq, duration=0.15, type="square", volume=0.18){
      if(!soundEnabled) return;
      try{
        if(!audioCtx){
          const AC = window.AudioContext || window.webkitAudioContext;
          if(!AC) return;
          audioCtx = new AC();
        }
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, now);
        gain.gain.setValueAtTime(0.001, now);
        gain.gain.exponentialRampToValueAtTime(volume, now+0.01);
        gain.gain.exponentialRampToValueAtTime(0.001, now+duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(now);
        osc.stop(now+duration);
      }catch(e){}
    }

    const sfxShoot   = () => playTone(520, 0.09, "square", 0.2);
    const sfxHit     = () => playTone(200, 0.15, "sawtooth", 0.25);
    const sfxPower   = () => playTone(800, 0.2, "triangle", 0.22);
    const sfxBoss    = () => playTone(140, 0.4, "sawtooth", 0.28);
    const sfxGameOver= () => { playTone(260,0.25,"square",0.22); setTimeout(()=>playTone(180,0.3,"square",0.2),180); };
const sfxShieldBreak = () => {
  // ÛŒÙ‡ Ø§ÙÚ©Øª Ø±ÛŒØ² Ù…Ø«Ù„ ØªØ±Ú© Ø´ÛŒØ´Ù‡: ÛŒÙ‡ ØªÛŒØ²ØŒ Ø¨Ø¹Ø¯Ø´ ÛŒÙ‡ Ø¨Ù…â€ŒØªØ±
  playTone(950, 0.08, "triangle", 0.24);
  setTimeout(() => playTone(420, 0.14, "sawtooth", 0.26), 70);
};

// ØµØ¯Ø§ÛŒ Ù…Ø±Ú¯ ØºÙˆÙ„
const sfxBossDie = () => {
    // Ø§Ù†ÙØ¬Ø§Ø± Ø§ÙˆÙ„ (ØªÛŒØ²)
    playTone(620, 0.18, "sawtooth", 0.35);

    // Ø§Ù†ÙØ¬Ø§Ø± Ø¯ÙˆÙ… (Ø¨Ù…â€ŒØªØ±)
    setTimeout(() => {
        playTone(280, 0.28, "square", 0.32);
    }, 150);

    // Ø§Ù†ÙØ¬Ø§Ø± Ø³ÙˆÙ… (Ø³Ù‚ÙˆØ· Ø¨Ù… Ùˆ Ø´Ø¯ÛŒØ¯)
    setTimeout(() => {
        playTone(90, 0.45, "square", 0.4);
    }, 300);
};
    
    soundToggleBtn.addEventListener("click", ()=>{
      soundEnabled = !soundEnabled;
      soundToggleBtn.textContent = soundEnabled ? "ğŸ”Š" : "ğŸ”‡";
    });

    // ======== ØªØµØ§ÙˆÛŒØ± ØªØ§Ù†Ú© Ùˆ ØºÙˆÙ„ ========
    const tankImg = new Image();
    tankImg.src = "https://cdnfa.com/irangiah/a9be/uploads/tank/tank.webp";

    const bossImages = [
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-1.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-2.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-3.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-4.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-5.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-6.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-7.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-8.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-9.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-10.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-11.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-12.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-13.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-14.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-15.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-16.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-17.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-18.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-19.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-20.webp"
];

// Ù…ÛŒÙ†ÛŒâ€ŒØ¨Ø§Ø³â€ŒÙ‡Ø§ (Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Û± ØªØ§ Û²Û°)
const miniBossImages = [
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss1.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss2.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss3.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss4.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss5.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss6.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss7.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss8.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss9.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss10.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss11.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss12.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss13.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss14.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss15.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss16.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss17.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss18.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss19.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss20.webp"
];
    
const bossImg = new Image();

    // ======== ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ ========
    let tank = { x:0,y:0,w:60,h:36,speed:4 };
let bullets = [];
let enemies = [];
let powerUps = [];
let particles = [];

let score = 0;
let coins = 0;
let lives = 3;

const MAX_LIVES = 9;
const MAX_SLOW_ITEMS = 7;
const SHOP_PRICES = {
    triple: 300,  // Ø´Ù„ÛŒÚ© Ø³Ù‡â€ŒØªØ§ÛŒÛŒ
    rocket: 200,  // Ù…ÙˆØ´Ú©
    shield: 150,  // Ø³Ù¾Ø±
    life:   750,  // Ø¬Ø§Ù†
    slow:   550   // Ø²Ù…Ø§Ù†/Ú©Ù†Ø¯ Ú©Ø±Ø¯Ù†
};

// Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø®Ø±ÛŒØ¯ Ø¯Ø§Ø®Ù„ Ù‡Ø± Ø§Ø¬Ø±Ø§
let lifeBuys = 0;
let slowBuys = 0;
const MAX_LIFE_BUYS = 7;
const MAX_SLOW_BUYS = 7;
    

// Ø§Ù†Ø¨Ø§Ø± Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
let inventory = { shield:0, triple:0, rocket:0, slow:0 };
    let rocketArmed = false;   // Ø´Ù„ÛŒÚ© Ø¨Ø¹Ø¯ÛŒ Ù…ÙˆØ´Ú©ÛŒ Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ù†Ù‡

    let gameRunning = false;
    let lastEnemyTime = 0;
    let lastPowerUpTime = 0;

    let hitFlash = 0;
    let shakeTime = 0;
    let bgOffset = 0;

    let moveLeft = false;
    let moveRight = false;
let isPaused = false;   // ÙˆØ¶Ø¹ÛŒØª ØªÙˆÙ‚Ù Ø¨Ø§Ø²ÛŒ
    
    const badLabels = [
      "Ø¯Ø±ÙˆØº","ØªÙ‡Ù…Øª","ØºÛŒØ¨Øª","Ù…Ø±Ø¯Ù…â€ŒØ¢Ø²Ø§Ø±ÛŒ","Ú¯Ø±Ø§Ù†ÙØ±ÙˆØ´ÛŒ","Ø¨ÛŒâ€ŒØ§Ø¯Ø¨ÛŒ","Ø¯Ø´Ù†Ø§Ù…","ØªÙ†Ø¨Ù„ÛŒ",
      "Ø­Ø³Ø§Ø¯Øª","Ø¨ÛŒâ€ŒØ­ÛŒØ§ÛŒÛŒ","Ø¨ÛŒâ€ŒØ­Ø¬Ø§Ø¨ÛŒ","ØªØ±Ú© Ù†Ù…Ø§Ø²","Ù‚Ø¶Ø§ÙˆØª","Ø®ÙˆØ¯Ú©Ù…â€ŒØ¨ÛŒÙ†ÛŒ","Ø®ÙˆØ¯Ø®ÙˆØ§Ù‡ÛŒ",
      "Ù„Ø¬Ø§Ø¬Øª","Ø®Ø³Ø§Ø³Øª","Ø­Ù‚â€ŒØ§Ù„Ù†Ø§Ø³","Ø­ÛŒÙˆØ§Ù†â€ŒØ¢Ø²Ø§Ø±ÛŒ","Ù‚Ù‡Ø±",
      "Ø±ÛŒØ§","Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ","ØªØ±Ø³","Ú©ÛŒÙ†Ù‡","Ù¾Ø±Ø®Ø§Ø´Ú¯Ø±ÛŒ","ØªØ¹Ù„Ù„","Ø¨Ø¯Ø¨ÛŒÙ†ÛŒ"
    ];

    // Û²Û° Ù…Ø±Ø­Ù„Ù‡
    const LEVELS = [];
    for(let i=1;i<=20;i++){
      LEVELS.push({
        id: i,
        label: `Ù…Ø±Ø­Ù„Ù‡ ${i}`,
        goal: 120 + (i-1)*35,
        enemySpeed: 1.6 + (i-1)*0.12,
        spawnInterval: 1100 - (i-1)*35,
        bossName: `ØºÙˆÙ„ Ù…Ø±Ø­Ù„Ù‡ ${i}`,
        bossHP: 120 + (i-1)*20,
        bossImgIndex: i-1
      });
    }

    let currentLevelIndex = 0;
    let levelGoal = LEVELS[0].goal;
    let spawnInterval = LEVELS[0].spawnInterval;
    let enemyBaseSpeed = LEVELS[0].enemySpeed;

    let bossSpawned = false;
    let bossAlive = false;
let miniBossSpawned = false;
  let inBossFight = false;
    
    const POWER_TYPES = ["shield","triple","slow","rocket"];

    let activePowerUps = { shield:false, triple:false, slow:false };
    let powerTimers = {};

// Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¨Ø§Ø² Ø´Ø¯Ù‡
function getMaxUnlockedLevelId(){
  const saved = loadState();
  if(!saved) return 1;
  return saved.lastLevel || 1;
}

// Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø§Ø­Ù„ (Ø¨Ø§ ØªØµÙˆÛŒØ± ØºÙˆÙ„ Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡)
function buildLevelGrid(){
  if(!levelGrid) return;
  levelGrid.innerHTML = "";

  const maxId = getMaxUnlockedLevelId();

  LEVELS.forEach((lvl, index)=>{
    const btn = document.createElement("button");
    btn.className = "level-btn";

    // ØªØµÙˆÛŒØ± ØºÙˆÙ„ Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡
    const img = document.createElement("img");
    img.className = "level-boss-thumb";
    const bossUrl = bossImages[lvl.bossImgIndex] || bossImages[0];
    img.src = bossUrl;
    img.alt = lvl.bossName || lvl.label;

    // Ø¹Ù†ÙˆØ§Ù† Ù…Ø±Ø­Ù„Ù‡
    const label = document.createElement("span");
    label.className = "level-label";
    label.textContent = lvl.label;

    // Ú†Ø³Ø¨Ø§Ù†Ø¯Ù† Ø¨Ù‡ Ø¯Ú©Ù…Ù‡
    btn.appendChild(img);
    btn.appendChild(label);

    // ÙˆØ¶Ø¹ÛŒØª Ù‚ÙÙ„ / ÙØ¹Ù„ÛŒ
    if(lvl.id > maxId){
      btn.classList.add("locked");
      btn.disabled = true;
    }else{
      if(index === currentLevelIndex){
        btn.classList.add("current");
      }
      btn.addEventListener("click", ()=>{
        levelModal.classList.add("hidden");
        startGame(index);
      });
    }

    levelGrid.appendChild(btn);
  });
}


    // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ Ù…Ø±Ø§Ø­Ù„
function openLevelModal(){
  buildLevelGrid();
  levelModal.classList.remove("hidden");
}
    
    const STORAGE_KEY = "tavita_tank_state_v4";

    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return null;
      try{ return JSON.parse(raw); }catch{ return null; }
    }
    function saveState(){
      const prev = loadState() || {};
      const bestScore = Math.max(score, prev.bestScore || 0);
      const data = {
        bestScore,
        lastLevel: LEVELS[currentLevelIndex].id,
        coins,
        inventory
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    function applyLoadedState(){
      const saved = loadState();
      if(!saved){
        continueBtn.style.display = "none";
        return;
      }
      continueBtn.style.display = "inline-block";
      coins = saved.coins || 0;
      inventory = saved.inventory || {shield:0,triple:0,rocket:0};
      coinsEl.textContent = coins;
      updateInventoryUI();
    }

    tankImg.onload = ()=>{
      const ratio = tankImg.naturalHeight / tankImg.naturalWidth || 0.6;
      tank.w = canvas.width * 0.18;
      tank.h = tank.w * ratio;
      tank.x = canvas.width/2 - tank.w/2;
      tank.y = canvas.height - tank.h - 18;
    };

    function updateInventoryUI(){
  shieldCountEl.textContent = inventory.shield || 0;
  rocketCountEl.textContent = inventory.rocket || 0;
  tripleCountEl.textContent = inventory.triple || 0;
  slowCountEl.textContent   = inventory.slow   || 0;

  shieldUseBtn.classList.toggle("disabled", !inventory.shield);
  rocketUseBtn.classList.toggle("disabled", !inventory.rocket);
  tripleUseBtn.classList.toggle("disabled", !inventory.triple);
  slowUseBtn.classList.toggle("disabled",   !inventory.slow);
}

    function createBlobPoints(w,h){
      const pts=[];
      const jitter = 6 + Math.random()*6;
      pts.push({x:0+Math.random()*jitter, y:0+Math.random()*jitter});
      pts.push({x:w*0.5 + (Math.random()*jitter-jitter/2), y:0});
      pts.push({x:w - Math.random()*jitter, y:0+Math.random()*jitter});
      pts.push({x:w, y:h*0.5 + (Math.random()*jitter-jitter/2)});
      pts.push({x:w - Math.random()*jitter, y:h - Math.random()*jitter});
      pts.push({x:w*0.5 + (Math.random()*jitter-jitter/2), y:h});
      pts.push({x:0+Math.random()*jitter, y:h - Math.random()*jitter});
      pts.push({x:0, y:h*0.5 + (Math.random()*jitter-jitter/2)});
      return pts;
    }

    function drawPolygon(x,y,points){
      ctx.beginPath();
      ctx.moveTo(x+points[0].x, y+points[0].y);
      for(let i=1;i<points.length;i++){
        ctx.lineTo(x+points[i].x, y+points[i].y);
      }
      ctx.closePath();
    }

    function rectCircleCollide(cx,cy,cr, rx,ry,rw,rh){
      const testX = Math.max(rx, Math.min(cx, rx+rw));
      const testY = Math.max(ry, Math.min(cy, ry+rh));
      const distX = cx - testX;
      const distY = cy - testY;
      return (distX*distX + distY*distY) <= cr*cr;
    }

    // Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
    function drawBackground(){
      const grad = ctx.createRadialGradient(
        canvas.width/2, canvas.height*0.1, 20,
        canvas.width/2, canvas.height, canvas.height
      );
      grad.addColorStop(0,"#0b1120");
      grad.addColorStop(0.5,"#020617");
      grad.addColorStop(1,"#000");
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.save();
      ctx.strokeStyle = "rgba(56,189,248,0.28)";
      ctx.lineWidth = 1.3;
      ctx.shadowColor = "rgba(56,189,248,0.5)";
      ctx.shadowBlur = 6;
      for(let i=0;i<9;i++){
        const y = (canvas.height - 16) - (i*26) + bgOffset;
        ctx.beginPath();
        ctx.moveTo(0,y);
        ctx.lineTo(canvas.width,y);
        ctx.stroke();
      }
      ctx.restore();
    }

    function drawTank(){
  const {x,y,w,h} = tank;

  // Ø®ÙˆØ¯ ØªØ§Ù†Ú©
  if (tankImg.complete && tankImg.naturalWidth > 0) {
    ctx.drawImage(tankImg, x, y, w, h);
  } else {
    const grad = ctx.createLinearGradient(x, y, x + w, y + h);
    grad.addColorStop(0, "#38bdf8");
    grad.addColorStop(1, "#0f172a");
    ctx.fillStyle = grad;
    ctx.fillRect(x, y, w, h);
  }

  // Ø§ÙÚ©Øª Ø³Ù¾Ø± Ù¾Ù„Ø§Ø³Ù…Ø§ / Ù…ÙˆØ¬â€ŒØ¯Ø§Ø±
  if (activePowerUps.shield) {
    const cx = x + w / 2;
    const cy = y + h / 2;
    const baseR = w * 0.95;

    const t = performance.now() / 600; // Ø²Ù…Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
    const pulse = 0.85 + 0.12 * Math.sin(t * 2);
    const rOuter = baseR * pulse;

    ctx.save();
    ctx.translate(cx, cy);

    // Ù‡Ø§Ù„Ù‡â€ŒÛŒ Ø¨ÛŒØ±ÙˆÙ†ÛŒ Ù†Ø±Ù…
    const grad = ctx.createRadialGradient(
      0, 0, rOuter * 0.15,
      0, 0, rOuter
    );
    grad.addColorStop(0, "rgba(248,250,252,0.95)");
    grad.addColorStop(0.4, "rgba(56,189,248,0.9)");
    grad.addColorStop(1, "rgba(15,23,42,0)");
    ctx.fillStyle = grad;
    ctx.globalAlpha = 0.9;
    ctx.beginPath();
    ctx.arc(0, 0, rOuter, 0, Math.PI * 2);
    ctx.fill();

    // Ú©Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù†Ø¦ÙˆÙ†ÛŒ Ú†Ø±Ø®Ø§Ù† Ø¯ÙˆØ± ØªØ§Ù†Ú©
    ctx.globalAlpha = 1;
    ctx.strokeStyle = "rgba(56,189,248,0.96)";
    ctx.lineWidth = 2.2;
    ctx.shadowColor = "rgba(56,189,248,1)";
    ctx.shadowBlur = 18;

    for (let i = 0; i < 3; i++) {
      const angle = t * 1.4 + i * (Math.PI * 2 / 3);
      const start = angle - 0.6;
      const end   = angle + 0.6;

      ctx.beginPath();
      ctx.arc(0, 0, rOuter * 0.78, start, end);
      ctx.stroke();
    }

    ctx.restore();
  }
}

    function drawBullets(){
      bullets.forEach(b=>{
        const grad = ctx.createRadialGradient(b.x,b.y,1,b.x,b.y,b.r);
        grad.addColorStop(0,"#fff");
        grad.addColorStop(1, b.isRocket ? "#22c55e" : "#f97316");
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
        ctx.fill();
      });
    }

    function drawEnemies(){
      enemies.forEach(e=>{
        if (e.isBoss) {
      const { x, y, w, h } = e;

      // ØªØµÙˆÛŒØ± ØºÙˆÙ„
      if (bossImg.complete && bossImg.naturalWidth > 0) {
        const scale = 0.75;
        const iw = w * scale;
        const ih = h * scale;
        const ix = x + (w - iw) / 2;
        const iy = y + (h - ih) / 2;
        ctx.drawImage(bossImg, ix, iy, iw, ih);
      }

      // ğŸ¯ Ù†ÙˆØ§Ø± Ø¬ÙˆÙ† + Ø¹Ø¯Ø¯ØŒ Ø¯Ù‚ÛŒÙ‚Ø§ Ø²ÛŒØ± Ø®ÙˆØ¯ Ø¨Ø§Ø³
      const bossHpBar  = document.getElementById("bossHpBar");
      const bossHpFill = document.getElementById("bossHpFill");
      const bossHpText = document.getElementById("bossHpText");

      // Ù†Ø³Ø¨Øª Ø¬ÙˆÙ† ÙØ¹Ù„ÛŒ Ø¨Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø±
      const ratio = Math.max(0, e.hp) / e.maxHp;
      bossHpFill.style.width = (ratio * 100) + "%";

      // Ù…ØªÙ† ÙˆØ³Ø· Ù†ÙˆØ§Ø± (Ù…Ø«Ù„Ø§ 75 / 120)
      const currentHp = Math.max(0, Math.round(e.hp));
      bossHpText.textContent = `${currentHp} / ${e.maxHp}`;

      // Ø¬Ø§ÛŒ Ù†ÙˆØ§Ø±: Ú©Ù…ÛŒ Ø²ÛŒØ± ØºÙˆÙ„
      const barTop = y + h - 70;
      bossHpBar.style.top = barTop + "px";
      bossHpBar.classList.remove("hidden");

      // ÙÙ‚Ø· Ø§Ø³Ù… ØºÙˆÙ„ Ø±Ø§ Ù¾Ø§ÛŒÛŒÙ†Ø´ Ø¨Ù†ÙˆÛŒØ³ÛŒÙ…
      ctx.fillStyle = "#ffffff";
      ctx.font = "bold 13px Vazir, Vazirmatn, system-ui";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      ctx.fillText(e.bossName, x + w / 2, y + h - 4);

      return;
    }


        else if(e.isMiniBoss){
      const {x,y,w,h} = e;
      if(e.img && e.img.complete && e.img.naturalWidth>0){
        const scale = 0.5;
        const iw = w * scale;
        const ih = h * scale;
        const ix = x + (w - iw)/2;
        const iy = y + (h - ih)/2;
        ctx.drawImage(e.img, ix, iy, iw, ih);
      }else{
        ctx.fillStyle = "#a855f7";
        ctx.fillRect(x,y,w,h);
      }

      ctx.fillStyle = "#ffffff";
      ctx.font = "bold 12px Vazir, Vazirmatn, system-ui";
      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      ctx.fillText("Ù…ÛŒÙ†ÛŒâ€ŒØºÙˆÙ„", x + w/2, y + 4);

      return;
    }
    
        const grad = ctx.createLinearGradient(e.x,e.y,e.x+e.w,e.y+e.h);
        grad.addColorStop(0,e.colorStart);
        grad.addColorStop(1,e.colorEnd);
        ctx.fillStyle = grad;
        ctx.strokeStyle = "rgba(15,23,42,0.9)";
        ctx.lineWidth=2;

        if(e.points){
          drawPolygon(e.x,e.y,e.points);
          ctx.fill(); ctx.stroke();
        }else{
          ctx.fillRect(e.x,e.y,e.w,e.h);
          ctx.strokeRect(e.x,e.y,e.w,e.h);
        }

        ctx.fillStyle="#0f172a";
        ctx.font="bold 12px Vazir, Vazirmatn, system-ui";
        ctx.textAlign="center"; ctx.textBaseline="middle";
        ctx.fillText(e.label, e.x+e.w/2, e.y+e.h/2);
      });
    }

    function drawParticles(){
      ctx.save();
      particles.forEach(p=>{
        ctx.globalAlpha = p.life/p.maxLife;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x,p.y,3,0,Math.PI*2);
        ctx.fill();
      });
      ctx.restore();
    }
    function createExplosion(cx,cy,color){
      for(let i=0;i<12;i++){
        const angle = Math.random()*Math.PI*2;
        const speed = 1 + Math.random()*2.2;
        particles.push({
          x:cx,y:cy,
          vx:Math.cos(angle)*speed,
          vy:Math.sin(angle)*speed,
          life:26,maxLife:26,
          color
        });
      }
    }

    function drawPowerUps(){
      powerUps.forEach(p=>{
        const {x,y,r,type} = p;
        let c1="#a855f7";
        if(type==="shield") c1="#22c55e";
        if(type==="triple") c1="#eab308";
        if(type==="slow")   c1="#38bdf8";
        if(type==="rocket") c1="#f97316";
        const grad = ctx.createRadialGradient(x,y,1,x,y,r);
        grad.addColorStop(0,"#fff");
        grad.addColorStop(1,c1);
        ctx.fillStyle = grad;
        ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();

        ctx.font="bold 11px Vazir, Vazirmatn, system-ui";
        ctx.fillStyle="#020617";
        ctx.textAlign="center"; ctx.textBaseline="middle";
        let icon = "â¬†";
        if(type==="shield") icon="ğŸ›¡";
        else if(type==="triple") icon="Ã—3";
        else if(type==="slow") icon="â³";
        else if(type==="rocket") icon="ğŸš€";
        ctx.fillText(icon, x,y);
      });
    }

function spawnMiniBoss(){
  const lvl = LEVELS[currentLevelIndex];
  const w = canvas.width * 0.30;
const h = canvas.height * 0.22;
  const x = (canvas.width - w) / 2;
  const y = -h - 20;

  const img = new Image();
  const src = miniBossImages[lvl.bossImgIndex] || miniBossImages[0];
  img.src = src;

  // Ø¬Ø§Ù† Ù…ÛŒÙ†ÛŒâ€ŒØ¨Ø§Ø³: Ù†Ù‡ Ø®ÛŒÙ„ÛŒ Ø¢Ø³ÙˆÙ†ØŒ Ù†Ù‡ Ø®ÛŒÙ„ÛŒ Ø³Ø®Øª (Ûµâ€“Û· ØªÛŒØ±)
  const miniHp = 15 + currentLevelIndex * 1; 

  enemies.push({
    x, y, w, h,
    speed: enemyBaseSpeed * 0.95,
    isBoss: false,
    isMiniBoss: true,
    hp: miniHp,                 // ğŸ‘ˆ Ù…Ù‡Ù…
    colorStart: "#a855f7",      // Ø¨Ø±Ø§ÛŒ Ø§Ù†ÙØ¬Ø§Ø± Ù‚Ø´Ù†Ú¯
    colorEnd: "#6366f1",
    img
  });
}

    
    function spawnEnemy(isBoss=false){
  if (isBoss) {
    const lvl = LEVELS[currentLevelIndex];
    const w = canvas.width * 0.65;
    const h = canvas.height * 0.52;
    const x = (canvas.width - w) / 2;
    const y = -h - 20;

    enemies.push({
      x, y, w, h,
      speed: enemyBaseSpeed * 0.7,
      isBoss: true,
      bossName: lvl.bossName,
      hp: lvl.bossHP,
      maxHp: lvl.bossHP,          // ğŸ‘ˆ Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ§Ø±
      colorStart: "#f97316"       // ÙˆØ§Ø³Ù‡ Ø±Ù†Ú¯ Ø§Ù†ÙØ¬Ø§Ø± Ø¨Ø§Ø³
    });

    bossAlive   = true;
    inBossFight = true;

    // ğŸ”¥ Ø±ÙˆØ´Ù† Ú©Ø±Ø¯Ù† Ù†ÙˆØ§Ø± Ø¬ÙˆÙ† Ø¨Ø§Ø³
    const bossHpBar  = document.getElementById("bossHpBar");
    const bossHpFill = document.getElementById("bossHpFill");
    bossHpBar.classList.remove("hidden");
    bossHpFill.style.width = "100%";

    const bossImgSrc = bossImages[lvl.bossImgIndex] || bossImages[0];
    bossImg.src = bossImgSrc;

    sfxBoss();
    return;
  }

  // ğŸ‘‡ Ø§Ø² Ø§ÛŒÙ†â€ŒØ¬Ø§ Ø¨Ù‡ Ø¨Ø¹Ø¯ Ù‡Ù…ÙˆÙ† Ø¯Ø´Ù…Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ù…ÙˆÙ„ÛŒâ€ŒØ§Øª Ø¨Ù…ÙˆÙ†Ù†ØŒ Ø¯Ø³Øª Ù†Ø²Ù†
  const laneCount=5, laneWidth=canvas.width/laneCount;
  const laneIndex=Math.floor(Math.random()*laneCount);
  const w=laneWidth*0.72, h=34;
  const x=laneIndex*laneWidth+(laneWidth-w)/2;
  const y=-h-8;

  const colors=[
    ["#f97316","#fb923c"],
    ["#22c55e","#4ade80"],
    ["#3b82f6","#6366f1"],
    ["#e11d48","#f97316"],
    ["#a855f7","#6366f1"]
  ];
  const pair=colors[Math.floor(Math.random()*colors.length)];
  const label=badLabels[Math.floor(Math.random()*badLabels.length)];

  enemies.push({
    x,y,w,h,
    speed: enemyBaseSpeed + Math.random()*0.8,
    colorStart:pair[0], colorEnd:pair[1],
    label, isBoss:false,
    points:createBlobPoints(w,h)
  });
}

    function spawnPowerUp(){
      const laneCount=5, laneWidth=canvas.width/laneCount;
      const laneIndex=Math.floor(Math.random()*laneCount);
      const x=laneIndex*laneWidth+laneWidth/2;
      powerUps.push({
        x, y:-15, r:13, speed:1.1,
        type: POWER_TYPES[Math.floor(Math.random()*POWER_TYPES.length)]
      });
    }

    function activatePowerUp(type) {
  if (type === "rocket") return; // Ù…ÙˆØ´Ú© Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø± Ù†ÛŒØ³Øª

  activePowerUps[type] = true;
  sfxPower();

  if (powerTimers[type]) clearTimeout(powerTimers[type]);

  let duration;
  if (type === "shield") {
    // â± Ø²Ù…Ø§Ù† Ø³Ù¾Ø± Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù† (Ø§Ù„Ø§Ù† 22000ms â‰ˆ 22 Ø«Ø§Ù†ÛŒÙ‡)
    duration = 18000;
  } else if (type === "triple") {
    duration = 10000;
  } else {
    duration = 8000;
  }

  powerTimers[type] = setTimeout(() => {
    activePowerUps[type] = false;

    if (type === "shield") {
      // â›” ÙˆÙ‚ØªÛŒ Ø³Ù¾Ø± ØªÙ…ÙˆÙ… Ù…ÛŒâ€ŒØ´Ù‡: Ø´ÙˆÚ© ØªØµÙˆÛŒØ±ÛŒ + ØµØ¯Ø§ÛŒ ØªØ±Ú© Ø´ÛŒØ´Ù‡
      hitFlash = 0.9;
      shakeTime = 16;
      sfxShieldBreak();
    }
  }, duration);
}

    function fireBullet(){
      if(!gameRunning) return;

      const base = () => ({
        x: tank.x+tank.w/2,
        y: tank.y-6,
        r: 7,
        speed: 6,
        isRocket:false,
        damage:3
      });

      // Ø§Ú¯Ø± Ù…ÙˆØ´Ú© Ù…Ø³Ù„Ø­ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ø´Ù„ÛŒÚ© Ø¨Ø¹Ø¯ÛŒ Ù…ÙˆØ´Ú©ÛŒ Ø§Ø³Øª (Ø§Ù†ØªØ®Ø§Ø¨ÛŒ)
      if(rocketArmed && inventory.rocket > 0){
        const b = base();
        b.isRocket = true;
        b.r = 11;
        b.speed = 7;
        b.damage = 12;
        bullets.push(b);
        inventory.rocket--;
        rocketArmed = false;
        updateInventoryUI();
        saveState();
      }else if(activePowerUps.triple){
        bullets.push(
          {...base(), x:tank.x+tank.w*0.3},
          {...base(), x:tank.x+tank.w*0.5},
          {...base(), x:tank.x+tank.w*0.7}
        );
      }else{
        bullets.push(base());
      }

      if(navigator.vibrate) navigator.vibrate(15);
      sfxShoot();
    }

    function flashLifeDanger(){
  if(!lifeDisplay) return;
  lifeDisplay.classList.add("danger");
  setTimeout(()=>lifeDisplay.classList.remove("danger"),700);
}

    let frameId = null;
let levelClearTimer = null;   // ğŸ‘ˆ ØªØ§ÛŒÙ…Ø± ØªØ§Ø®ÛŒØ± Ù¾ÛŒØ§Ù… Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯

    function update(){
      // Ø­Ø±Ú©Øª Ø¢Ø²Ø§Ø¯ ØªØ§Ù†Ú© (Ù‡Ù…ÛŒØ´Ù‡ØŒ Ø­ØªÛŒ Ø²Ù…Ø§Ù† Ø¨Ø§Ø³â€ŒÙØ§ÛŒØª)
if (moveLeft)  tank.x -= tank.speed;
if (moveRight) tank.x += tank.speed;
tank.x = Math.max(4, Math.min(canvas.width - tank.w - 4, tank.x));

      const enemySpeedFactor = activePowerUps.slow?0.5:1;
      const enemySpawnFactor = activePowerUps.slow?1.5:1;

      bgOffset += 1.4*enemySpeedFactor;
      if(bgOffset>26) bgOffset-=26;

      bullets.forEach(b=> b.y -= b.speed);
      bullets = bullets.filter(b=> b.y+b.r>0);

      enemies.forEach(e=>{
        if(e.isBoss && inBossFight){
          const targetY = canvas.height * 0.16; // Ø¬Ø§ÛŒ Ø§ÛŒØ³ØªØ§Ø¯Ù† ØºÙˆÙ„

          if(e.y < targetY){
            e.y += e.speed * enemySpeedFactor;
            if(e.y > targetY) e.y = targetY;
          } else {
            e.y = targetY;
          }

        } else {
          e.y += e.speed * enemySpeedFactor;
        }
      });

      powerUps.forEach(p=> p.y += p.speed);
      powerUps = powerUps.filter(p=> p.y-p.r < canvas.height+10);

      particles.forEach(p=>{
        p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.life--;
      });
      particles = particles.filter(p=>p.life>0);

      const now = performance.now();
      const lvl = LEVELS[currentLevelIndex];

if(!miniBossSpawned && score >= lvl.goal * 0.35){
        spawnMiniBoss();
        miniBossSpawned = true;
      }
      
      if(!bossSpawned && score >= lvl.goal*0.65){
        spawnEnemy(true);
        bossSpawned = true;
        inBossFight = true;

        // ØªØ§Ù†Ú© Ø±Ùˆ ÙˆØ³Ø· ØµÙØ­Ù‡ Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡
        tank.x = (canvas.width - tank.w)/2;
      }

      if(now-lastEnemyTime > spawnInterval*enemySpawnFactor){
        spawnEnemy(false);
        lastEnemyTime = now;
      }

      if(now-lastPowerUpTime>8000){
  spawnPowerUp();
  lastPowerUpTime=now;
}

bullets.forEach((b, bi) => {
  enemies.forEach((e, ei) => {
    if (rectCircleCollide(b.x, b.y, b.r, e.x, e.y, e.w, e.h)) {

      // ğŸ”¸ Ú¯Ù„ÙˆÙ„Ù‡ Ù…ØµØ±Ù Ø´ÙˆØ¯
      bullets.splice(bi, 1);

      // âœ¨ Ø§Ù†ÙØ¬Ø§Ø± Ù…Ø¹Ù…ÙˆÙ„ÛŒ Ø±ÙˆÛŒ Ø¯Ø´Ù…Ù†
      const cx = e.x + e.w / 2;
      const cy = e.y + e.h / 2;
      createExplosion(cx, cy, e.colorStart || "#f97316");
      sfxHit();

      // ğŸ§Ÿâ€â™‚ï¸ Ø§Ú¯Ø± Ø¨Ø§Ø³ Ø¨Ø²Ø±Ú¯ Ø§Ø³Øª
      if (e.isBoss) {
        // Ú©Ù… Ú©Ø±Ø¯Ù† HP Ø¨Ø§Ø³
        e.hp -= b.damage;

        const bossHpBar  = document.getElementById("bossHpBar");
        const bossHpFill = document.getElementById("bossHpFill");

        // Ø§Ú¯Ø± Ø¨Ù‡ Ù‡Ø± Ø¯Ù„ÛŒÙ„ maxHp Ù†Ø¨ÙˆØ¯ØŒ Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† ØªÙ†Ø¸ÛŒÙ…Ø´ Ú©Ù†
        if (e.maxHp === undefined) e.maxHp = e.hp;

        // Ø¢Ù¾Ø¯ÛŒØª Ø¹Ø±Ø¶ Ù†ÙˆØ§Ø±
        if (bossHpFill) {
          bossHpFill.style.width = Math.max(0, (e.hp / e.maxHp) * 100) + "%";
        }

        // Ù…Ø±Ú¯ Ø¨Ø§Ø³
        if (e.hp <= 0) {

          // Ø§ÙÚ©Øª ØµÙˆØªÛŒ Ù…Ø±Ú¯
          sfxBossDie();

          // Ø§Ù†ÙØ¬Ø§Ø± / Ø¯ÙˆØ¯ Ø¨Ù†ÙØ´ - Ø¯Ù‚ÛŒÙ‚Ø§ Ø§Ø² Ø¬Ø§ÛŒ Ø®ÙˆØ¯ ØºÙˆÙ„
  const boom = document.createElement("div");
  boom.classList.add("boss-death-flash");

  // Ù…Ø±Ú©Ø² ØºÙˆÙ„ Ø±Ùˆ Ø­Ø³Ø§Ø¨ Ú©Ù†
  const centerX = e.x + e.w / 2;
  const centerY = e.y + e.h / 2;

  boom.style.left = centerX + "px";
  boom.style.top  = centerY + "px";

  document.body.appendChild(boom);
  setTimeout(() => boom.remove(), 900);

          // Ù„Ø±Ø²Ø´ ØµÙØ­Ù‡
          document.body.classList.add("screen-shake");
          setTimeout(() => document.body.classList.remove("screen-shake"), 500);

          // ğŸŸ¢ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù†ÙˆØ§Ø± Ø¬ÙˆÙ† Ø¨Ø§Ø³
          if (bossHpBar) bossHpBar.classList.add("hidden");

          // Ù…ÙˆØ¬ Ø¶Ø±Ø¨Ù‡ Ø±ÙˆÛŒ Ú©Ù„ ØµÙØ­Ù‡
          hitFlash = 1;
          shakeTime = 45;

          // Ø­Ø°Ù Ø¨Ø§Ø³ Ùˆ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø³â€ŒÙØ§ÛŒØª
          enemies.splice(ei, 1);
          bossAlive   = false;
          inBossFight = false;

          // Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ø³Ú©Ù‡
          score += 80;
          coins += 40;
          scoreEl.textContent  = score;
          coinsEl.textContent  = coins;
          saveState();
        }

      // ğŸ§¿ Ù…ÛŒÙ†ÛŒâ€ŒØ¨Ø§Ø³
      } else if (e.isMiniBoss) {
        e.hp -= b.damage;
        if (e.hp <= 0) {
          enemies.splice(ei, 1);
          score += 30;
          coins += 15;
          scoreEl.textContent = score;
          coinsEl.textContent = coins;
        }

      // ğŸ§± Ø¯Ø´Ù…Ù† Ù…Ø¹Ù…ÙˆÙ„ÛŒ
      } else {
        enemies.splice(ei, 1);
        score += 7;
        coins += 3;
        scoreEl.textContent = score;
        coinsEl.textContent = coins;
      }
    }
  });
});

      // Ù¾Ø§ÙˆØ±Ø¢Ù¾â€ŒÙ‡Ø§: Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆÙ†Ø¯ (Ø§Ù†ØªØ®Ø§Ø¨ÛŒ)
      powerUps.forEach((p,pi)=>{
  if (rectCircleCollide(p.x,p.y,p.r, tank.x,tank.y,tank.w,tank.h)) {

    // Ø§Ú¯Ø± slow Ø¨ÙˆØ¯ â‡’ Ø¨Ø§ Ø³Ù‚Ù Û· ØªØ§ Ø§Ù†Ø¨Ø§Ø±ÛŒ Ø¨Ø´Ù‡
    if (p.type === "slow") {
      inventory.slow = Math.min(
        MAX_SLOW_ITEMS,
        (inventory.slow || 0) + 1
      );
    } else {
      // shield / triple / rocket
      inventory[p.type] = (inventory[p.type] || 0) + 1;
    }

    updateInventoryUI();
    sfxPower();
    saveState();
    powerUps.splice(pi,1);
  }
});

      enemies.forEach((e, ei) => {
        const collideWithTank =
          e.x < tank.x + tank.w &&
          e.x + e.w > tank.x &&
          e.y < tank.y + tank.h &&
          e.y + e.h > tank.y;

        const outBottom = e.y + e.h >= canvas.height - 5;

        // Û±) Ø¨Ø±Ø®ÙˆØ±Ø¯ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø§ ØªØ§Ù†Ú©
        if (collideWithTank) {

          // Ø§Ú¯Ø± Ø³Ù¾Ø± ÙØ¹Ø§Ù„Ù‡ â‡’ ÙÙ‚Ø· Ù…Ø­Ø§ÙØ¸ØªØŒ Ù†Ù‡ Ù†Ø§Ø¨ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¯Ø´Ù…Ù†
          if (activePowerUps.shield) {
            const cx = e.x + e.w / 2;
            const cy = e.y + e.h / 2;

            // Ø§ÙÚ©Øª Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø³Ù¾Ø±
            createExplosion(cx, cy, "#38bdf8");

            // Ú©Ù…ÛŒ Ø¯Ø´Ù…Ù† Ø±Ø§ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†ØŒ Ø§Ù†Ú¯Ø§Ø± Ø§Ø² Ø³Ù¾Ø± Ø¨Ø±Ú¯Ø´ØªÙ‡ Ø¹Ù‚Ø¨
            e.y -= 18;

            // â— Ù†Ù‡ Ø¬Ø§Ù† Ú©Ù… Ù…ÛŒØ´Ù‡ØŒ Ù†Ù‡ ØºÙˆÙ„/Ø¯Ø´Ù…Ù† Ù¾Ø§Ú© Ù…ÛŒØ´Ù‡
            return;
          }

          // Ø¨Ø¯ÙˆÙ† Ø³Ù¾Ø± â‡’ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§Ø¹Ø« Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯Ù† Ø¬Ø§Ù† Ù…ÛŒâ€ŒØ´ÙˆØ¯
          enemies.splice(ei, 1);

          lives--;
          livesEl.textContent = lives;
          hitFlash = 1;
          shakeTime = e.isBoss ? 12 : 10;
          flashLifeDanger();
          sfxHit();
          if (navigator.vibrate) navigator.vibrate(e.isBoss ? 100 : 80);

          if (lives <= 0) {
            endGame();
            return;
          } else if (e.isBoss) {
    bossAlive = false;
    bossSpawned = false;
    inBossFight = false;   // ğŸ‘ˆ Ø§ÛŒÙ† Ø®Ø· Ø¬Ø¯ÛŒØ¯Ù‡
}

        // Û²) Ø±Ø³ÛŒØ¯Ù† Ø¯Ø´Ù…Ù† Ø¨Ù‡ Ú©Ù ØµÙØ­Ù‡ (Ø®Ø· Ù¾Ø§ÛŒÛŒÙ†)
        } else if (outBottom) {

    // Ø§Ú¯Ø± Ø³Ù¾Ø± Ø±ÙˆØ´Ù†Ù‡: Ø¯Ø´Ù…Ù† Ù‡ÛŒÙ€Ù€Ú† Ø§Ø«Ø±ÛŒ Ù†Ø¯Ø§Ø±Ù‡
    if (activePowerUps.shield) {
      // ÙÙ‚Ø· Ø§Ø² ØµÙØ­Ù‡ Ø­Ø°ÙØ´ Ú©Ù†ØŒ Ø¨Ø¯ÙˆÙ† Ú©Ù… Ø´Ø¯Ù† Ø¬ÙˆÙ†
      enemies.splice(ei, 1);
      return;
    }

    // Ø¨Ø¯ÙˆÙ† Ø³Ù¾Ø± â†’ Ù…Ø«Ù„ Ù‚Ø¨Ù„ØŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø®Ø· Ù¾Ø§ÛŒÛŒÙ† Ø¨Ø§Ø¹Ø« Ú©Ù… Ø´Ø¯Ù† Ø¬Ø§Ù† Ù…ÛŒØ´Ù‡
    enemies.splice(ei, 1);

    lives--;
    livesEl.textContent = lives;
    hitFlash = 1;
    shakeTime = e.isBoss ? 12 : 10;
    flashLifeDanger();
    sfxHit();
    if (navigator.vibrate) navigator.vibrate(e.isBoss ? 100 : 80);

    if (lives <= 0) {
      endGame();
      return;
    } else if (e.isBoss) {
    bossAlive = false;
    bossSpawned = false;
    inBossFight = false;   // ğŸ‘ˆ Ø§ÛŒÙ† Ø®Ø· Ø¬Ø¯ÛŒØ¯Ù‡
}
  }
});

      const levelCleared = score >= lvl.goal && bossSpawned && !bossAlive;

// ğŸ‘‡ ÙˆÙ‚ØªÛŒ Ø¨Ø§Ø³ Ù…Ø±Ø¯ØŒ ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø± ØªØ§ÛŒÙ…Ø± Û².Û³ Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ Ø¨Ø²Ø§Ø±
if (levelCleared && !levelClearTimer) {
  levelClearTimer = setTimeout(() => {
    lives = Math.min(MAX_LIVES, lives + 2);
    livesEl.textContent = lives;

    gameRunning = false;           // Ø­Ø§Ù„Ø§ Ø¨Ø§Ø²ÛŒ Ø±Ùˆ Ù…ØªÙˆÙ‚Ù Ú©Ù†
    saveState();
    levelOverlay.classList.remove("hidden"); // Ù¾ÛŒØ§Ù… Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯

    levelClearTimer = null;        // Ø±ÛŒØ³Øª Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯
  }, 2300); // â‰ˆ Û².Û³ Ø«Ø§Ù†ÛŒÙ‡
}
    }

    function gameLoop(){
  if(!gameRunning) return;

  // âœ… Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ Ø±ÙˆÛŒ ØªÙˆÙ‚Ù Ø§Ø³ØªØŒ ÙÙ‚Ø· Ø­Ù„Ù‚Ù‡ Ø±Ùˆ Ø²Ù†Ø¯Ù‡ Ù†Ú¯Ù‡ Ø¯Ø§Ø± Ùˆ Ù‡ÛŒÚ†ÛŒ Ù†Ú©Ø´
  if (isPaused) {
    frameId = requestAnimationFrame(gameLoop);
    return;
  }

  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.save();
  if(shakeTime>0){
    const intensity=4;
    ctx.translate((Math.random()*2-1)*intensity,(Math.random()*2-1)*intensity);
    shakeTime--;
  }

  drawBackground();
  update();
  drawEnemies();
  drawPowerUps();
  drawParticles();
  drawBullets();
  drawTank();

  ctx.restore();

  if(hitFlash>0){
    const alpha = hitFlash*0.45;
    const cx=tank.x+tank.w/2, cy=tank.y+tank.h/2;
    const grad=ctx.createRadialGradient(cx,cy,0,cx,cy,canvas.width);
    grad.addColorStop(0,`rgba(248,113,113,${alpha})`);
    grad.addColorStop(1,"rgba(248,113,113,0)");
    ctx.fillStyle=grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);
    hitFlash-=0.05;
  }

  frameId = requestAnimationFrame(gameLoop);
}

    function resetGameState(startFromLevelIndex = 0){
      bullets=[]; enemies=[]; powerUps=[]; particles=[];
      score=0; lives=3;
      bossSpawned=false; bossAlive=false;
  miniBossSpawned=false;
  inBossFight = false;   // â­ Ù‡Ø± Ø¨Ø§Ø± Ø¨Ø§Ø²ÛŒ Ø§Ø² Ù†ÙˆØŒ Ø¨Ø§Ø³â€ŒÙØ§ÛŒØª Ø®Ø§Ù…ÙˆØ´ Ø´ÙˆØ¯
      hitFlash=0; shakeTime=0; bgOffset=0;
      rocketArmed=false;

      currentLevelIndex = startFromLevelIndex;
      const lvl = LEVELS[currentLevelIndex];
      levelGoal = lvl.goal;
      spawnInterval = Math.max(550, lvl.spawnInterval);
      enemyBaseSpeed = lvl.enemySpeed;

      levelLabel.textContent = lvl.label;
      scoreEl.textContent = score;
      livesEl.textContent = lives;
      coinsEl.textContent = coins;

      const ratio = tankImg.naturalHeight / tankImg.naturalWidth || 0.6;
      tank.w = canvas.width * 0.18;
      tank.h = tank.w * ratio;
      tank.x = canvas.width/2 - tank.w/2;
      tank.y = canvas.height - tank.h - 18;
    }

    function startGame(fromLevelIndex = 0) {
  if (frameId) cancelAnimationFrame(frameId);

  // â›” Ø¯Ø± Ø´Ø±ÙˆØ¹ Ù‡Ø± Ø¨Ø§Ø²ÛŒØŒ Ù†ÙˆØ§Ø± Ø¬ÙˆÙ† Ø¨Ø§Ø³ Ø±Ùˆ Ú©Ø§Ù…Ù„ Ù…Ø®ÙÛŒ Ú©Ù†
  const bossHpBar = document.getElementById("bossHpBar");
  if (bossHpBar) bossHpBar.classList.add("hidden");

  resetGameState(fromLevelIndex);
  startOverlay.classList.add("hidden");
  levelOverlay.classList.add("hidden");
  gameOverOverlay.classList.add("hidden");

  gameRunning = true;
  lastEnemyTime = performance.now();
  lastPowerUpTime = performance.now();
  gameLoop();
}

function endGame() {
  // Û±) Ù†ÙˆØ§Ø± Ø¬ÙˆÙ† Ø¨Ø§Ø³ Ø±Ø§ Ú©Ø§Ù…Ù„ Ù¾Ù†Ù‡Ø§Ù† Ú©Ù†
  const bossHpBar  = document.getElementById("bossHpBar");
  const bossHpFill = document.getElementById("bossHpFill");
  const bossHpText = document.getElementById("bossHpText");

  if (bossHpBar) {
    bossHpBar.classList.add("hidden");
    
  }
  if (bossHpFill) bossHpFill.style.width = "100%";
  if (bossHpText) bossHpText.textContent = "";

  // Û²) ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø³ Ø±Ø§ Ø®Ø§Ù…ÙˆØ´ Ú©Ù†
  bossAlive   = false;
  inBossFight = false;

  // Û³) ØªÙˆÙ‚Ù Ø¨Ø§Ø²ÛŒ
  gameRunning = false;
  if (frameId) cancelAnimationFrame(frameId);

  // Û´) Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ Ùˆ Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²
  finalScoreEl.textContent = score;
  const saved = loadState();
  const best = Math.max(score, (saved && saved.bestScore) || 0);
  bestScoreEl.textContent = best;
  saveState();

  // Ûµ) ØµØ¯Ø§ÛŒ Ú¯ÛŒÙ…â€ŒØ§ÙˆØ± Ùˆ Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡
  sfxGameOver();
  gameOverOverlay.classList.remove("hidden");
}

    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
    startBtn.addEventListener("click", ()=> startGame(0));

    continueBtn.addEventListener("click", ()=>{
      const saved=loadState();
      if(!saved){ startGame(0); return; }
      const idx=LEVELS.findIndex(l=>l.id===saved.lastLevel);
      startGame(idx>=0?idx:0);
    });

    nextLevelBtn.addEventListener("click", ()=>{
      currentLevelIndex++;
      if(currentLevelIndex>=LEVELS.length) currentLevelIndex=0;
      startGame(currentLevelIndex);
    });



pauseBtn.addEventListener("click", ()=>{
  isPaused = !isPaused;
  pauseBtn.textContent = isPaused ? "â–¶ï¸" : "â¸ï¸";
});
          
    restartBtn.addEventListener("click", ()=>{
  if(currentLevelIndex > 2){
    currentLevelIndex--;  // Ø§Ø² Ù…Ø±Ø­Ù„Ù‡ Û³ Ø¨Ù‡ Ø¨Ø¹Ø¯ ÛŒÚ©ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ù‡ Ø¹Ù‚Ø¨
  }
  startGame(currentLevelIndex);
});
    
    document.addEventListener("keydown",(e)=>{
      if(e.code==="ArrowLeft") moveLeft=true;
      else if(e.code==="ArrowRight") moveRight=true;
      else if(e.code==="Space"){
        e.preventDefault();
        fireBullet();
      }
    });
    document.addEventListener("keyup",(e)=>{
      if(e.code==="ArrowLeft") moveLeft=false;
      else if(e.code==="ArrowRight") moveRight=false;
    });

    function bindHold(btn, cb){
      const start=(e)=>{e.preventDefault();cb(true);};
      const end=(e)=>{e.preventDefault();cb(false);};
      btn.addEventListener("mousedown",start);
      btn.addEventListener("mouseup",end);
      btn.addEventListener("mouseleave",end);
      btn.addEventListener("touchstart",start,{passive:false});
      btn.addEventListener("touchend",end);
      btn.addEventListener("touchcancel",end);
    }
    bindHold(leftBtn,(v)=> moveLeft=v);
    bindHold(rightBtn,(v)=> moveRight=v);

    fireBtn.addEventListener("click",(e)=>{e.preventDefault();fireBullet();});
    fireBtn.addEventListener("touchstart",(e)=>{e.preventDefault();fireBullet();},{passive:false});

    aboutBtn.addEventListener("click", ()=> aboutModal.classList.remove("hidden"));
    aboutCloseBtn.addEventListener("click", ()=> aboutModal.classList.add("hidden"));

    shopBtn.addEventListener("click", ()=>{
      shopModal.classList.remove("hidden");
      refreshShopUI();
    });
    shopCloseBtn.addEventListener("click", ()=> shopModal.classList.add("hidden"));


// Ø¯Ú©Ù…Ù‡ Â«Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§Ø²ÛŒÂ» Ø¯Ø± ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹
if(levelsBtn){
  levelsBtn.addEventListener("click", openLevelModal);
}

// Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ú©Ø§Ø¯Ø± Â«Ù…Ø±Ø­Ù„Ù‡: ...Â» Ø¯Ø± HUD
if(levelBadge){
  levelBadge.addEventListener("click", openLevelModal);
}

// Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ù…Ø±Ø§Ø­Ù„
if(levelCloseBtn){
  levelCloseBtn.addEventListener("click", ()=>{
    levelModal.classList.add("hidden");
  });
}
    
    function refreshShopUI(){
  shopCoinsEl.textContent = coins;

  // Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ SHOP_PRICES
  buyTripleBtn.disabled = coins < SHOP_PRICES.triple;
  buyRocketBtn.disabled = coins < SHOP_PRICES.rocket;
  buyShieldBtn.disabled = coins < SHOP_PRICES.shield;

  // Ø¬Ø§Ù†: ØªØ§ ÙˆÙ‚ØªÛŒ Ù‡Ù… Ø³Ú©Ù‡ Ú©Ø§ÙÛŒ Ø¯Ø§Ø±ÛŒØŒ Ù‡Ù… Ø¬Ø§Ù† Ø¨Ù‡ Ø³Ù‚Ù Ù†Ø±Ø³ÛŒØ¯Ù‡ Ùˆ Ù‡Ù… Ú©Ù…ØªØ± Ø§Ø² Û· Ø¨Ø§Ø± Ø®Ø±ÛŒØ¯ Ú©Ø±Ø¯ÛŒ
  buyLifeBtn.disabled =
    coins < SHOP_PRICES.life ||
    lifeBuys >= MAX_LIFE_BUYS ||
    lives >= MAX_LIVES;

  // Ø²Ù…Ø§Ù†: Ù‡Ù… Ø³Ú©Ù‡ØŒ Ù‡Ù… Ø³Ù‚Ù Ø¢ÛŒØªÙ… Ø§Ù†Ø¨Ø§Ø±ÛŒØŒ Ù‡Ù… Ø³Ù‚Ù Ø®Ø±ÛŒØ¯
  buySlowBtn.disabled =
    coins < SHOP_PRICES.slow ||
    slowBuys >= MAX_SLOW_BUYS ||
    inventory.slow >= MAX_SLOW_ITEMS;
}

    // Ø®Ø±ÛŒØ¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ -> ÙÙ‚Ø· Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
    // Ø®Ø±ÛŒØ¯ Ø´Ù„ÛŒÚ© Ø³Ù‡â€ŒØªØ§ÛŒÛŒ
buyTripleBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.triple) return;
  coins -= SHOP_PRICES.triple;
  coinsEl.textContent = coins;
  inventory.triple = (inventory.triple || 0) + 1;
  updateInventoryUI();
  saveState();
  refreshShopUI();
});

// Ø®Ø±ÛŒØ¯ Ù…ÙˆØ´Ú©
buyRocketBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.rocket) return;
  coins -= SHOP_PRICES.rocket;
  coinsEl.textContent = coins;
  inventory.rocket = (inventory.rocket || 0) + 1;
  updateInventoryUI();
  saveState();
  refreshShopUI();
});

// Ø®Ø±ÛŒØ¯ Ø³Ù¾Ø±
buyShieldBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.shield) return;
  coins -= SHOP_PRICES.shield;
  coinsEl.textContent = coins;
  inventory.shield = (inventory.shield || 0) + 1;
  updateInventoryUI();
  saveState();
  refreshShopUI();
});

// Ø®Ø±ÛŒØ¯ Ø¬Ø§Ù†
buyLifeBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.life) return;
  if(lifeBuys >= MAX_LIFE_BUYS) return;
  if(lives >= MAX_LIVES) return;

  coins -= SHOP_PRICES.life;
  coinsEl.textContent = coins;

  lives = Math.min(MAX_LIVES, lives + 1);
  livesEl.textContent = lives;

  lifeBuys++;
  saveState();
  refreshShopUI();
});

// Ø®Ø±ÛŒØ¯ Ù¾Ø§ÙˆØ±Ø¢Ù¾ Ø²Ù…Ø§Ù† (slow)
buySlowBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.slow) return;
  if(slowBuys >= MAX_SLOW_BUYS) return;
  if(inventory.slow >= MAX_SLOW_ITEMS) return;

  coins -= SHOP_PRICES.slow;
  coinsEl.textContent = coins;

  inventory.slow = Math.min(
    MAX_SLOW_ITEMS,
    (inventory.slow || 0) + 1
  );

  slowBuys++;
  updateInventoryUI();
  saveState();
  refreshShopUI();
});

    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø§Ø² Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
    shieldUseBtn.addEventListener("click", ()=>{
      if(!gameRunning) return;
      if(inventory.shield>0 && !activePowerUps.shield){
        inventory.shield--;
        updateInventoryUI();
        activatePowerUp("shield");
        saveState();
      }
    });

    tripleUseBtn.addEventListener("click", ()=>{
      if(!gameRunning) return;
      if(inventory.triple>0 && !activePowerUps.triple){
        inventory.triple--;
        updateInventoryUI();
        activatePowerUp("triple");
        saveState();
      }
    });

    rocketUseBtn.addEventListener("click", ()=>{
      if(!gameRunning) return;
      if(inventory.rocket>0){
        rocketArmed = true; // Ø´Ù„ÛŒÚ© Ø¨Ø¹Ø¯ÛŒ Ù…ÙˆØ´Ú©ÛŒ Ø§Ø³Øª
        if(navigator.vibrate) navigator.vibrate(30);
      }
    });

slowUseBtn.addEventListener("click", ()=>{
    if(!gameRunning) return;
    if(inventory.slow > 0 && !activePowerUps.slow){
        inventory.slow--;
        updateInventoryUI();
        activatePowerUp("slow");
        saveState();
    }
});
    
    // Ø´Ø±ÙˆØ¹ Ø§ÙˆÙ„ÛŒÙ‡
    resetGameState(0);
    drawBackground(); drawTank();
    applyLoadedState();
    updateInventoryUI();
    updateMotivation();
    setInterval(updateMotivation, 10000);

    
  </script>

</body>
</html>
