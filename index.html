<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>ÙÙˆØªØ¨Ø§Ù„ÛŒØªØ§ âš½ï¸ | Ù‡Ù…Ù‡â€ŒÚ†ÛŒâ€ŒØªÙ…ÙˆÙ…</title>

  <!-- âœ… Eitaa JS SDK -->
  <script src="https://developer.eitaa.com/eitaa-web-app.js"></script>

  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    html,body{height:100%;background:#070b14;color:#fff;overflow:hidden}

    /* âœ… compact layout (bigger play area) */
    .app{height:100%;display:flex;flex-direction:column;max-width:620px;margin:0 auto;padding:6px;gap:5px}

    .topbar,.hud,.panel{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:6px 8px;
      backdrop-filter:blur(10px);
      box-shadow:0 10px 34px rgba(0,0,0,.22);
      flex-wrap:nowrap; /* âœ… one line */
    }

    .topbar{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .brand{display:flex;align-items:center;gap:8px;min-width:0}
    .logo{
      width:34px;height:34px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(34,197,94,.22);border:1px solid rgba(34,197,94,.35);
      box-shadow:0 0 16px rgba(34,197,94,.12);
      font-size:16px;flex:0 0 auto;
    }
    .titles{display:flex;flex-direction:column;gap:1px;min-width:0}
    .name{font-weight:1000;font-size:12px;line-height:1.05}
    .tag{opacity:.86;font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:260px}

    .btn{
      border:none;border-radius:11px;
      padding:6px 8px;
      font-weight:1000;cursor:pointer;
      background:rgba(255,255,255,.12);color:#fff;
      border:1px solid rgba(255,255,255,.14);
      font-size:11px; line-height:1;
      user-select:none;
    }
    .btn.primary{
      background:linear-gradient(135deg,#22c55e,#a3e635);
      color:#071022;border:none;padding:6px 9px;
    }
    .btn.icon{padding:6px 7px;min-width:34px;text-align:center}
    .btn.small{padding:6px 7px;font-size:11px}

    .panel{display:flex;gap:6px;align-items:center;justify-content:space-between}
    .modes{display:flex;gap:6px;flex-wrap:nowrap}
    .modeBtn{border-radius:999px}
    .modeBtn.active{background:rgba(34,197,94,.22);border-color:rgba(34,197,94,.35)}

    .hud{display:flex;align-items:center;justify-content:space-between;gap:6px}
    .left{display:flex;gap:6px;align-items:center;flex-wrap:nowrap;overflow:auto;scrollbar-width:none}
    .left::-webkit-scrollbar{display:none}
    .pill{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      padding:4px 7px;
      border-radius:999px;
      font-weight:1000;
      font-size:10.5px;
      display:flex;gap:5px;align-items:center;white-space:nowrap
    }

    .stage{
      flex:1;min-height:0;
      border-radius:18px;overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(1200px 600px at 50% 90%, rgba(34,197,94,.18), transparent 60%),
        radial-gradient(900px 400px at 50% 15%, rgba(59,130,246,.10), transparent 60%),
        linear-gradient(180deg,#0f1830,#071022);
      position:relative;
      box-shadow:0 18px 70px rgba(0,0,0,.55)
    }
    canvas{width:100%;height:100%;display:block;touch-action:none}

    .hint{
      opacity:.9;font-size:10.5px;text-align:center;line-height:1.5;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;padding:6px 8px;
    }

    /* overlays */
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:14px;background:rgba(0,0,0,.60);z-index:9999}
    .card{
      width:min(480px,100%);
      background:linear-gradient(180deg,#0f1a33,#0a1124);
      border:1px solid rgba(255,255,255,.12);border-radius:16px;
      box-shadow:0 25px 80px rgba(0,0,0,.6);padding:12px
    }
    .card h3{margin:0 0 6px;font-size:14px}
    .card p{margin:0 0 10px;font-size:11px;opacity:.92;line-height:1.9}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .row .btn{flex:1}
    .muted{opacity:.8;font-size:10px}

    /* toast */
    .toast{
      position:fixed;left:50%;top:11%;
      transform:translateX(-50%);
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.12);
      padding:9px 10px;border-radius:12px;z-index:99999;
      font-weight:1000;font-size:11px;opacity:0;pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
      max-width:min(92vw,560px);text-align:center;direction:rtl
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}

    /* âœ… bottom ad */
    .bottom-ad{
      position:fixed;left:50%;bottom:6px;transform:translateX(-50%);
      width:min(96%,560px);height:44px;
      display:none;align-items:center;justify-content:center;
      z-index:99999;border-radius:14px;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter:blur(8px);
      box-shadow:0 12px 50px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .bottom-ad img{height:100%;width:100%;object-fit:cover;cursor:pointer}
    .closeAd{
      position:absolute;right:6px;top:6px;width:20px;height:20px;
      border:none;border-radius:999px;background:rgba(0,0,0,.55);
      color:#fff;font-size:14px;line-height:20px;cursor:pointer;
    }
    .adTag{
      position:absolute;left:8px;top:6px;
      background:rgba(249,115,22,.92);color:#071022;font-weight:1000;
      border-radius:999px;padding:2px 7px;font-size:10px;
    }

    /* âœ… goal hype */
    @keyframes scorePop{0%{transform:scale(1)}40%{transform:scale(1.18)}100%{transform:scale(1)}}
    @keyframes shake{0%{transform:translate(0,0)}25%{transform:translate(2px,-2px)}50%{transform:translate(-2px,2px)}75%{transform:translate(2px,2px)}100%{transform:translate(0,0)}}
    .goal-shake{animation:shake .28s linear}
    .score-pop{animation:scorePop .35s ease}
  </style>
</head>

<body>
<div class="app">
  <div class="topbar">
    <div class="brand">
      <div class="logo">âš½ï¸</div>
      <div class="titles">
        <div class="name">ÙÙˆØªØ¨Ø§Ù„ÛŒØªØ§</div>
        <div class="tag">ØªÚ©â€ŒÙ†ÙØ±Ù‡ / Ø¯ÙˆÙ†ÙØ±Ù‡ Ø¢ÙÙ„Ø§ÛŒÙ† / Ø±Ø¨Ø§Øª ğŸ˜ˆ</div>
      </div>
    </div>
    <button class="btn small" id="tavitaBtn">Ø·Ø§ÙˆÛŒØªØ§</button>
  </div>

  <div class="panel">
    <div class="modes">
      <button class="btn small modeBtn active" data-mode="solo">ğŸ¯</button>
      <button class="btn small modeBtn" data-mode="pvp">ğŸ‘¥</button>
      <button class="btn small modeBtn" data-mode="bot">ğŸ¤–</button>
    </div>
    <div style="display:flex;gap:6px;align-items:center;flex-wrap:nowrap">
      <button class="btn icon" id="soundBtn">ğŸ”Š</button>
      <button class="btn icon" id="pauseBtn">â¸</button>
      <button class="btn primary" id="restartBtn">Ø±ÛŒØ³Øª</button>
    </div>
  </div>

  <div class="hud">
    <div class="left">
      <div class="pill">ğŸ† <span id="scoreA">0</span></div>
      <div class="pill" id="pillB" style="display:none;">ğŸ¥Š <span id="scoreB">0</span></div>
      <div class="pill">ğŸ¯ <span id="goals">0</span></div>
      <div class="pill" id="streakPill">ğŸ”¥ <span id="streak">0</span>x</div>
      <div class="pill">â± <span id="time">60</span>s</div>
    </div>
    <div class="right">
      <div class="pill" id="modeLabel">ØªÚ©â€ŒÙ†ÙØ±Ù‡</div>
    </div>
  </div>

  <div class="stage"><canvas id="c"></canvas></div>

  <div class="hint" id="hint">
    ØªÚ©â€ŒÙ†ÙØ±Ù‡: ØªÙˆÙ¾ Ø±Ùˆ <b>Ø¨Ù‡ Ø³Ù…Øª Ù¾Ø§ÛŒÛŒÙ† Ø¨Ú©Ø´ Ùˆ Ø±Ù‡Ø§ Ú©Ù†</b> | Ø¯ÙˆÙ†ÙØ±Ù‡/Ø±Ø¨Ø§Øª: Ù…Ù‡Ø±Ù‡ Ø±Ùˆ Drag Ú©Ù†.
  </div>
</div>

<div class="toast" id="toast"></div>

<div class="overlay" id="pauseOverlay">
  <div class="card">
    <h3>Ù…Ú©Ø« â¸</h3>
    <p class="muted">ØªØ¨Ù„ÛŒØº ÙÙ‚Ø· Ø¯Ø± Ù…Ú©Ø«/Ú¯Ù„/Ù¾Ø§ÛŒØ§Ù† ØªØ§ÛŒÙ… Ù…ÛŒØ§Ø¯ âœ…</p>
    <div class="row">
      <button class="btn primary" id="resumeBtn">Ø§Ø¯Ø§Ù…Ù‡</button>
      <button class="btn" id="closePauseBtn">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>
</div>

<!-- âœ… Goal FX -->
<div id="goalFx" style="
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,.35); z-index:99998; backdrop-filter:blur(2px);
">
  <div id="goalFxText" style="
    padding:14px 18px; border-radius:18px;
    background:linear-gradient(135deg, rgba(34,197,94,.95), rgba(163,230,53,.95));
    color:#071022; font-weight:1000; font-size:28px;
    box-shadow:0 18px 80px rgba(0,0,0,.45);
  ">GOOOAL! âš½ï¸</div>
</div>

<!-- âœ… Bottom Ad -->
<div id="bottomAd" class="bottom-ad" aria-hidden="true">
  <span class="adTag">Ø§Ø³Ù¾Ø§Ù†Ø³Ø±</span>
  <img id="bottomAdImg" alt="ad">
  <button class="closeAd" id="closeAdBtn" title="Ø¨Ø³ØªÙ†">Ã—</button>
</div>

<script>
(() => {
  // ===================== Eitaa SDK init =====================
  const EWA = (window.Eitaa && window.Eitaa.WebApp) ? window.Eitaa.WebApp : null;

  function initEitaa(){
    try{
      if(!EWA) return;
      if(typeof EWA.ready === "function") EWA.ready();
      if(typeof EWA.expand === "function") EWA.expand();
      if(typeof EWA.disableVerticalSwipes === "function") EWA.disableVerticalSwipes();
    }catch(e){}
  }
  initEitaa();

  function openEitaaLinkSafe(url){
    try{
      if(EWA){
        if(typeof EWA.openLink === "function"){ EWA.openLink(url); return; }
        if(typeof EWA.openEitaaLink === "function"){ EWA.openEitaaLink(url); return; }
      }
    }catch(e){}
    try{ window.location.assign(url); }catch(e){ window.location.href=url; }
  }

  // ===================== Ad config (ACTIVE âœ…) =====================
  const ADS = {
    enabled: true,
    image: "https://cdnfa.com/irangiah/a9be/uploads/ads/tankads.webp",
    link:  "https://eitaa.com/tavita_ads",
    autoHideMs: 4500,
    minGapSec: 28,
    showOnPause: true,
    showOnGoal: true,
    showOnTimeEnd: true
  };

  // ===================== UI =====================
  const ui = {
    tavitaBtn: document.getElementById("tavitaBtn"),
    soundBtn: document.getElementById("soundBtn"),
    pauseBtn: document.getElementById("pauseBtn"),
    restartBtn: document.getElementById("restartBtn"),
    resumeBtn: document.getElementById("resumeBtn"),
    closePauseBtn: document.getElementById("closePauseBtn"),
    pauseOverlay: document.getElementById("pauseOverlay"),
    modeBtns: [...document.querySelectorAll(".modeBtn")],
    modeLabel: document.getElementById("modeLabel"),
    hint: document.getElementById("hint"),

    scoreA: document.getElementById("scoreA"),
    scoreB: document.getElementById("scoreB"),
    pillB: document.getElementById("pillB"),
    goals: document.getElementById("goals"),
    streak: document.getElementById("streak"),
    streakPill: document.getElementById("streakPill"),
    time: document.getElementById("time"),
  };

  // toast
  const toastEl = document.getElementById("toast");
  let toastTimer=null;
  function toast(t){
    toastEl.textContent=t;
    toastEl.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer=setTimeout(()=>toastEl.classList.remove("show"),950);
  }

  // ===================== Bottom Ad =====================
  const bottomAd = document.getElementById("bottomAd");
  const bottomAdImg = document.getElementById("bottomAdImg");
  const closeAdBtn = document.getElementById("closeAdBtn");
  bottomAdImg.src = ADS.image;

  let adTimer=null;
  function adKey(k){ return "footballita_ad_" + k; }
  function canShowAd(){
    try{
      const last = parseInt(localStorage.getItem(adKey("last")) || "0", 10);
      return (Date.now() - last) >= (ADS.minGapSec*1000);
    }catch(e){ return true; }
  }
  function markShown(){ try{ localStorage.setItem(adKey("last"), String(Date.now())); }catch(e){} }

  function showBottomAd(){
    if(!ADS.enabled) return;
    if(!canShowAd()) return;
    markShown();
    bottomAd.style.display="flex";
    bottomAd.setAttribute("aria-hidden","false");
    clearTimeout(adTimer);
    adTimer=setTimeout(hideBottomAd, ADS.autoHideMs);
  }
  function hideBottomAd(){
    bottomAd.style.display="none";
    bottomAd.setAttribute("aria-hidden","true");
    clearTimeout(adTimer);
  }
  bottomAdImg.addEventListener("click", ()=>openEitaaLinkSafe(ADS.link));
  closeAdBtn.addEventListener("click", (e)=>{ e.stopPropagation(); hideBottomAd(); });

  // ===================== Goal Hype =====================
  const goalFx = document.getElementById("goalFx");
  const goalFxText = document.getElementById("goalFxText");
  const stageEl = document.querySelector(".stage");
  let slowmo = 1; // 1=normal, <1=slow motion
  function goalHype(text){
    goalFxText.textContent = text || "GOOOAL! âš½ï¸";
    goalFx.style.display = "flex";

    stageEl.classList.add("goal-shake");
    setTimeout(()=>stageEl.classList.remove("goal-shake"), 300);

    // pop score pill
    ui.scoreA.parentElement.classList.add("score-pop");
    setTimeout(()=>ui.scoreA.parentElement.classList.remove("score-pop"), 380);

    // slow motion moment
    slowmo = 0.55;
    setTimeout(()=>slowmo = 1, 520);

    vibr(40);
    beep(980,0.08,0.03);
    setTimeout(()=>beep(1240,0.08,0.025), 90);

    setTimeout(()=>{ goalFx.style.display="none"; }, 650);
  }

  // ===================== Sound =====================
  let soundOn=true;
  function beep(freq=740, dur=0.06, vol=0.03){
    if(!soundOn) return;
    try{
      const ac = new (window.AudioContext||window.webkitAudioContext)();
      const o = ac.createOscillator();
      const g = ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.frequency.value=freq; o.type="sine";
      g.gain.setValueAtTime(vol, ac.currentTime);
      o.start(); o.stop(ac.currentTime+dur);
    }catch(e){}
  }
  function vibr(ms=16){ try{ navigator.vibrate && navigator.vibrate(ms); }catch(e){} }

  // ===================== Canvas =====================
  const canvas=document.getElementById("c");
  const ctx=canvas.getContext("2d");
  let W=0,H=0,DPR=1;
  function resize(){
    const r=canvas.getBoundingClientRect();
    DPR = Math.max(1, Math.floor(window.devicePixelRatio||1));
    W=r.width; H=r.height;
    canvas.width=Math.floor(W*DPR);
    canvas.height=Math.floor(H*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  addEventListener("resize", resize);

  // helpers
  function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }
  function dist(ax,ay,bx,by){ return Math.hypot(ax-bx, ay-by); }
  function circleRectHit(cx,cy,cr, rx,ry,rw,rh){
    const nx=clamp(cx,rx,rx+rw);
    const ny=clamp(cy,ry,ry+rh);
    return dist(cx,cy,nx,ny) <= cr;
  }
  function toLocal(e){
    const r=canvas.getBoundingClientRect();
    return {x:e.clientX-r.left, y:e.clientY-r.top};
  }

  // ===================== Soccer ball (beautiful panels) =====================
  function drawSoccerBall(x,y,r, spin=0){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(spin*0.35);

    // shadow/glow
    const g = ctx.createRadialGradient(-r*0.25,-r*0.3, r*0.2, 0,0, r*1.55);
    g.addColorStop(0,"rgba(255,255,255,.95)");
    g.addColorStop(0.28,"rgba(255,255,255,.35)");
    g.addColorStop(1,"rgba(0,0,0,0)");
    ctx.fillStyle=g;
    ctx.beginPath(); ctx.arc(0,0,r*1.55,0,Math.PI*2); ctx.fill();

    // base sphere
    const base = ctx.createRadialGradient(-r*0.35,-r*0.45, r*0.1, 0,0, r);
    base.addColorStop(0,"#ffffff");
    base.addColorStop(0.55,"#e5e7eb");
    base.addColorStop(1,"#cbd5e1");
    ctx.fillStyle=base;
    ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill();

    // panel ring (white seams)
    ctx.lineWidth = Math.max(1.1, r*0.06);
    ctx.strokeStyle = "rgba(20, 24, 35, .45)";
    ctx.globalAlpha = 0.85;

    // center pentagon (black)
    ctx.globalAlpha = 1;
    ctx.fillStyle = "#0b0f18";
    ctx.beginPath();
    for(let i=0;i<5;i++){
      const a = -Math.PI/2 + i*(Math.PI*2/5);
      const px = Math.cos(a)*r*0.26;
      const py = Math.sin(a)*r*0.26;
      if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
    }
    ctx.closePath(); ctx.fill();
    ctx.stroke();

    // 5 black surrounding patches (pent/hex vibe)
    for(let k=0;k<5;k++){
      const ang = -Math.PI/2 + k*(Math.PI*2/5);
      const cx = Math.cos(ang)*r*0.53;
      const cy = Math.sin(ang)*r*0.53;

      ctx.fillStyle = "#0b0f18";
      ctx.beginPath();
      for(let i=0;i<5;i++){
        const a = ang + (i*(Math.PI*2/5)) + Math.PI/5;
        const px = cx + Math.cos(a)*r*0.18;
        const py = cy + Math.sin(a)*r*0.18;
        if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
      }
      ctx.closePath(); ctx.fill();
      ctx.stroke();
    }

    // subtle seams arcs
    ctx.globalAlpha = 0.25;
    ctx.strokeStyle = "rgba(15, 23, 42, .9)";
    ctx.lineWidth = Math.max(1, r*0.045);
    for(let i=0;i<6;i++){
      ctx.beginPath();
      ctx.arc(0,0,r*0.78, i*0.9, i*0.9+0.5);
      ctx.stroke();
    }

    // highlight
    ctx.globalAlpha=0.22;
    ctx.fillStyle="#fff";
    ctx.beginPath(); ctx.arc(-r*0.35,-r*0.42,r*0.22,0,Math.PI*2); ctx.fill();

    ctx.restore();
    ctx.globalAlpha=1;
  }

  // ===================== Modes =====================
  const MODES = { solo:"solo", pvp:"pvp", bot:"bot" };
  let mode = MODES.solo;

  // ===================== State =====================
  let running=true, paused=false;
  let timeLeft=60;
  let lastT=performance.now();

  // SOLO scoring
  let score=0, goals=0, streak=0;

  // PVP/BOT scoring
  let scoreP1=0, scoreP2=0;

  // ===================== SOLO (trick shot) =====================
  const soloPitch = { m:18, goalW:220, goalH:30 };
  const player = { x:0,y:0,r:18 };
  const ballSolo = { x:0,y:0,r:12,vx:0,vy:0,spin:0,smart:0,stuck:true,trail:[],special:false };
  const goalie = { x:0,y:0,w:74,h:10,react:0.23,targetX:0,mood:0 };
  const particles=[];
  const targets = [
    {name:"Ú¯ÙˆØ´Ù‡ Ø±Ø§Ø³Øª", biasX:+0.42},
    {name:"Ú¯ÙˆØ´Ù‡ Ú†Ù¾",  biasX:-0.42},
    {name:"Ø²ÛŒØ± ØªÛŒØ±",  biasX:+0.00},
    {name:"Ú©Ø§Øª Ø±Ø§Ø³Øª", biasX:+0.30},
    {name:"Ú©Ø§Øª Ú†Ù¾",   biasX:-0.30},
  ];
  let currentTarget = targets[0];
  function pickTarget(){ currentTarget = targets[Math.floor(Math.random()*targets.length)]; }

  function spawnGoalBurst(x,y){
    for(let i=0;i<32;i++){
      particles.push({x,y,vx:(Math.random()*2-1)*4,vy:(Math.random()*-1)*6-2,a:1,life:0.7+Math.random()*0.8});
    }
  }

  function soloResetPositions(){
    player.x=W/2; player.y=H*0.80;
    ballSolo.stuck=true; ballSolo.vx=ballSolo.vy=0; ballSolo.spin=0; ballSolo.smart=0; ballSolo.special=false;
    ballSolo.trail.length=0;
    ballSolo.x=player.x; ballSolo.y=player.y-(player.r+ballSolo.r+6);
    goalie.y = soloPitch.m + 34;
    goalie.x = W/2;
    goalie.targetX = W/2;
  }

  function soloShoot(dx,dy,mag){
    hideBottomAd();
    ballSolo.stuck=false;

    const power = clamp(mag, 70, 450);
    const base  = power * 0.0245;
    const nx = dx/(power||1);
    const ny = dy/(power||1);

    ballSolo.vx = nx * base;
    ballSolo.vy = ny * base;

    ballSolo.spin  = clamp(nx * 2.7, -2.8, 2.8);
    ballSolo.smart = clamp(1.6 + power/260, 1.6, 3.1);
    ballSolo.special = (power>340 && Math.abs(ballSolo.spin)>1.4);

    score += 1;
    beep(760,0.05,0.03); vibr(10);
  }

  function soloFinishShot(isGoal){
    if(isGoal){
      if(ADS.showOnGoal) showBottomAd();
    }
    pickTarget();
    setTimeout(()=>{ soloResetPositions(); }, 260);
  }

  // ===================== PVP/BOT (air-hockey football) =====================
  const arena = { m:18, goalW:180, goalDepth:12 };
  const puck = { x:0,y:0,r:12,vx:0,vy:0,trail:[],spin:0 };
  const p1 = { x:0,y:0,r:20 }; // bottom (green)
  const p2 = { x:0,y:0,r:20 }; // top (orange/AI)

  function arenaReset(){
    puck.x=W/2; puck.y=H/2; puck.vx=0; puck.vy=0; puck.trail.length=0; puck.spin=0;
    p1.x=W/2; p1.y=H*0.78;
    p2.x=W/2; p2.y=H*0.22;
  }

  function kickFromStriker(striker){
    const d = dist(puck.x,puck.y,striker.x,striker.y);
    const minD = puck.r + striker.r;
    if(d < minD){
      const nx=(puck.x-striker.x)/(d||1);
      const ny=(puck.y-striker.y)/(d||1);
      const overlap = (minD - d) + 0.5;
      puck.x += nx*overlap;
      puck.y += ny*overlap;

      // impulse
      puck.vx += nx*6.0;
      puck.vy += ny*6.0;

      // spin feel
      puck.spin += nx*0.35;

      beep(520,0.03,0.02);
      vibr(8);
      hideBottomAd();
    }
  }

  function checkGoalPVP(){
    const gx1 = (W - arena.goalW)/2;
    const gx2 = (W + arena.goalW)/2;

    if(puck.y - puck.r <= arena.m + arena.goalDepth && puck.x>=gx1 && puck.x<=gx2){
      scoreP1 += 1;
      goalHype("Ú¯Ù„Ù„Ù„Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù† Û±! âš½ï¸ğŸ”¥");
      if(ADS.showOnGoal) showBottomAd();
      arenaReset();
      return true;
    }
    if(puck.y + puck.r >= H - arena.m - arena.goalDepth && puck.x>=gx1 && puck.x<=gx2){
      scoreP2 += 1;
      goalHype(mode===MODES.bot ? "Ú¯Ù„ Ø¨Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª! ğŸ¤–âš½ï¸" : "Ú¯Ù„Ù„Ù„Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù† Û²! âš½ï¸ğŸ”¥");
      if(ADS.showOnGoal) showBottomAd();
      arenaReset();
      return true;
    }
    return false;
  }

  // âœ… Bot AI (smooth, no freeze / no jump)
  function botAI(dt){
    const lookAhead = 0.35;
    const px = puck.x + puck.vx * 60 * lookAhead;
    const py = puck.y + puck.vy * 60 * lookAhead;

    const targetX = clamp(px, arena.m+p2.r, W-arena.m-p2.r);
    const targetY = clamp(py - 45, arena.m+p2.r, H/2 - p2.r);

    const maxSpeed = 520; // px/sec
    const dx = (targetX - p2.x);
    const dy = (targetY - p2.y);
    const d = Math.hypot(dx,dy) || 1;

    const vx = (dx/d) * maxSpeed;
    const vy = (dy/d) * maxSpeed;

    p2.x = clamp(p2.x + vx*dt, arena.m+p2.r, W-arena.m-p2.r);
    p2.y = clamp(p2.y + vy*dt, arena.m+p2.r, H/2 - p2.r);
  }

  // ===================== Input =====================
  let downSolo=false, dragStart=null, dragNow=null;
  const pointers = new Map(); // pointerId -> {who:"p1"|"p2"}

  canvas.addEventListener("pointerdown",(e)=>{
    if(!running || paused) return;
    canvas.setPointerCapture(e.pointerId);
    const p=toLocal(e);

    if(mode===MODES.solo){
      if(dist(p.x,p.y,ballSolo.x,ballSolo.y) <= ballSolo.r+30){
        downSolo=true;
        dragStart={...p};
        dragNow={...p};
      }
      return;
    }

    if(dist(p.x,p.y,p1.x,p1.y) <= p1.r+26 && p.y > H/2){
      pointers.set(e.pointerId,{who:"p1"});
      return;
    }
    if(mode===MODES.pvp && dist(p.x,p.y,p2.x,p2.y) <= p2.r+26 && p.y < H/2){
      pointers.set(e.pointerId,{who:"p2"});
      return;
    }
  });

  canvas.addEventListener("pointermove",(e)=>{
    if(!running || paused) return;
    const p=toLocal(e);

    if(mode===MODES.solo){
      if(!downSolo) return;
      dragNow={...p};
      return;
    }

    const info=pointers.get(e.pointerId);
    if(!info) return;

    if(info.who==="p1"){
      p1.x = clamp(p.x, arena.m+p1.r, W-arena.m-p1.r);
      p1.y = clamp(p.y, H/2 + p1.r, H-arena.m-p1.r);
    } else if(info.who==="p2"){
      p2.x = clamp(p.x, arena.m+p2.r, W-arena.m-p2.r);
      p2.y = clamp(p.y, arena.m+p2.r, H/2 - p2.r);
    }
  });

  canvas.addEventListener("pointerup",(e)=>{
    if(mode===MODES.solo){
      if(!downSolo) return;
      downSolo=false;
      const end=toLocal(e);
      dragNow=end;

      const dx=(dragStart.x - end.x);
      const dy=(dragStart.y - end.y);
      const mag=Math.hypot(dx,dy);
      dragStart=null;

      if(mag<18){ toast("ğŸ‘† Ø¨ÛŒØ´ØªØ± Ø¨Ú©Ø´"); return; }
      soloShoot(dx,dy,mag);
      return;
    }
    pointers.delete(e.pointerId);
  });

  // ===================== Draw =====================
  function drawFieldCommon(){
    ctx.fillStyle="#0a3a2b";
    ctx.fillRect(0,0,W,H);

    ctx.globalAlpha=0.08;
    for(let i=0;i<10;i++){
      ctx.fillStyle=(i%2===0)?"#fff":"#000";
      ctx.fillRect(0,(H/10)*i,W,H/10);
    }
    ctx.globalAlpha=1;

    const g = ctx.createRadialGradient(W/2,H*0.95,40,W/2,H*0.95,Math.max(W,H));
    g.addColorStop(0,"rgba(34,197,94,.18)");
    g.addColorStop(1,"rgba(0,0,0,.28)");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,W,H);

    ctx.strokeStyle="rgba(255,255,255,.78)";
    ctx.lineWidth=2;
    ctx.strokeRect(18,18,W-36,H-36);
  }

  function drawSolo(){
    drawFieldCommon();

    const gx1=(W-soloPitch.goalW)/2;
    ctx.strokeStyle="rgba(255,255,255,.78)";
    ctx.lineWidth=2;
    ctx.strokeRect(gx1, soloPitch.m, soloPitch.goalW, soloPitch.goalH);
    ctx.strokeRect(W/2 - 130, soloPitch.m, 260, 110);

    // target indicator
    const tx = W/2 + currentTarget.biasX*(soloPitch.goalW*0.92);
    const ty = soloPitch.m + soloPitch.goalH*0.55;
    ctx.globalAlpha=0.55;
    ctx.beginPath(); ctx.arc(tx,ty,10,0,Math.PI*2);
    ctx.strokeStyle="rgba(255,255,255,.9)"; ctx.lineWidth=2; ctx.stroke();
    ctx.globalAlpha=1;

    // goalie
    ctx.fillStyle="rgba(255,255,255,.92)";
    ctx.fillRect(goalie.x-goalie.w/2, goalie.y-goalie.h/2, goalie.w, goalie.h);

    // particles
    for(const p of particles){
      ctx.globalAlpha=Math.max(0,p.a)*0.9;
      ctx.fillStyle="rgba(255,255,255,.95)";
      ctx.fillRect(p.x,p.y,3,3);
    }
    ctx.globalAlpha=1;

    // trail
    for(const t of ballSolo.trail){
      ctx.globalAlpha=(t.a||0.4)*0.55;
      ctx.beginPath(); ctx.arc(t.x,t.y, ballSolo.r+8, 0, Math.PI*2);
      ctx.fillStyle="rgba(34,197,94,.16)"; ctx.fill();
    }
    ctx.globalAlpha=1;

    // ball (soccer panels)
    drawSoccerBall(ballSolo.x, ballSolo.y, ballSolo.r, ballSolo.spin);

    // aim line
    if(downSolo && dragNow){
      ctx.strokeStyle="rgba(255,255,255,.85)";
      ctx.lineWidth=2;
      ctx.beginPath();
      ctx.moveTo(ballSolo.x,ballSolo.y);
      ctx.lineTo(dragNow.x,dragNow.y);
      ctx.stroke();
    }
  }

  function drawArena(){
    drawFieldCommon();

    // mid line
    ctx.globalAlpha=0.5;
    ctx.beginPath(); ctx.moveTo(18, H/2); ctx.lineTo(W-18, H/2);
    ctx.strokeStyle="rgba(255,255,255,.7)"; ctx.lineWidth=2; ctx.stroke();
    ctx.globalAlpha=1;

    // goals
    const gx1=(W-arena.goalW)/2;
    ctx.strokeStyle="rgba(255,255,255,.78)";
    ctx.lineWidth=2;
    ctx.strokeRect(gx1, arena.m, arena.goalW, arena.goalDepth);
    ctx.strokeRect(gx1, H-arena.m-arena.goalDepth, arena.goalW, arena.goalDepth);

    // puck trail
    for(const t of puck.trail){
      ctx.globalAlpha=(t.a||0.4)*0.55;
      ctx.beginPath(); ctx.arc(t.x,t.y, puck.r+8, 0, Math.PI*2);
      ctx.fillStyle="rgba(59,130,246,.16)"; ctx.fill();
    }
    ctx.globalAlpha=1;

    // puck as soccer ball too
    drawSoccerBall(puck.x, puck.y, puck.r, puck.spin);

    // striker p1 green
    ctx.fillStyle="rgba(34,197,94,.92)";
    ctx.beginPath(); ctx.arc(p1.x,p1.y, p1.r, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha=0.18; ctx.fillStyle="#fff";
    ctx.beginPath(); ctx.arc(p1.x-7,p1.y-7, p1.r*0.55, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;

    // striker p2 orange
    ctx.fillStyle="rgba(249,115,22,.92)";
    ctx.beginPath(); ctx.arc(p2.x,p2.y, p2.r, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha=0.18; ctx.fillStyle="#fff";
    ctx.beginPath(); ctx.arc(p2.x-7,p2.y-7, p2.r*0.55, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;
  }

  // ===================== Update =====================
  function updateSolo(dt){
    timeLeft -= dt;
    if(timeLeft<=0){
      timeLeft=0; running=false; paused=true;
      toast("â± ØªØ§ÛŒÙ… ØªÙ…ÙˆÙ… Ø´Ø¯!");
      if(ADS.showOnTimeEnd) showBottomAd();
      return;
    }

    // goalie AI
    const goalLineY = soloPitch.m + soloPitch.goalH + 3;
    if(!ballSolo.stuck && ballSolo.vy < 0){
      const t = (goalLineY - ballSolo.y) / (ballSolo.vy*60 || -9999);
      if(t>0 && t<2.2){
        const predictedX = clamp(ballSolo.x + ballSolo.vx*60*t, soloPitch.m+goalie.w/2, W-soloPitch.m-goalie.w/2);
        goalie.targetX = predictedX;
      }
    } else {
      goalie.mood += dt*0.8;
      goalie.targetX = W/2 + Math.sin(goalie.mood)*(W*0.12);
    }
    goalie.x += (goalie.targetX - goalie.x) * goalie.react;

    // particles
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i];
      p.life -= dt;
      p.x += p.vx*(dt*60);
      p.y += p.vy*(dt*60);
      p.vy += 0.18*(dt*60);
      p.a *= 0.96;
      if(p.life<=0) particles.splice(i,1);
    }

    if(ballSolo.stuck) return;

    // smart curve
    if(ballSolo.vy < 0){
      const upperZone = clamp(1 - ((ballSolo.y - soloPitch.m) / (H*0.58)), 0, 1);
      const nearGoal = clamp(1 - (ballSolo.y / (H*0.55)), 0, 1);
      const targetX = W/2 + currentTarget.biasX * (soloPitch.goalW*0.92);
      const toward = clamp((targetX - ballSolo.x)/(W*0.42), -1, 1);
      const assist = ballSolo.smart * upperZone * (0.065 + nearGoal*0.06);
      ballSolo.vx += toward * assist * (dt*60);
      ballSolo.vx += ballSolo.spin * 0.055 * (dt*60);
    } else {
      ballSolo.vx += ballSolo.spin * 0.012 * (dt*60);
    }

    // integrate
    ballSolo.x += ballSolo.vx*(dt*60);
    ballSolo.y += ballSolo.vy*(dt*60);

    // friction
    ballSolo.vx *= 0.993;
    ballSolo.vy *= 0.985;

    // spin evolve
    ballSolo.spin *= 0.992;

    // trail
    ballSolo.trail.push({x:ballSolo.x,y:ballSolo.y,a:1});
    if(ballSolo.trail.length>24) ballSolo.trail.shift();
    for(const t of ballSolo.trail) t.a *= 0.92;

    // âœ… GOAL CHECK FIRST
    const gx1=(W-soloPitch.goalW)/2;
    const gx2=(W+soloPitch.goalW)/2;
    const goalBottom = soloPitch.m + soloPitch.goalH + 18;
    if(ballSolo.x>=gx1 && ballSolo.x<=gx2 && ballSolo.y - ballSolo.r <= goalBottom){
      goals += 1; streak += 1;
      const styleBonus = Math.round(Math.abs(ballSolo.spin)*3 + (ballSolo.special?3:0));
      const streakBonus = Math.min(14, streak*2);
      score += 8 + styleBonus + streakBonus;

      spawnGoalBurst(ballSolo.x, soloPitch.m + soloPitch.goalH + 6);
      goalHype(ballSolo.special ? "Ø³ÙˆÙ¾Ø± Ú¯Ù„Ù„Ù„Ù„! âš½ï¸ğŸ‘‘" : "Ú¯Ù„Ù„Ù„Ù„! âš½ï¸ğŸ”¥");
      soloFinishShot(true);
      return;
    }

    // walls
    const minX = soloPitch.m + ballSolo.r;
    const maxX = W - soloPitch.m - ballSolo.r;
    const minY = soloPitch.m + ballSolo.r;
    const maxY = H - soloPitch.m - ballSolo.r;

    if(ballSolo.x<minX){ ballSolo.x=minX; ballSolo.vx*=-0.82; ballSolo.spin*=-0.7; }
    if(ballSolo.x>maxX){ ballSolo.x=maxX; ballSolo.vx*=-0.82; ballSolo.spin*=-0.7; }
    if(ballSolo.y<minY){ ballSolo.y=minY; ballSolo.vy*=-0.82; }
    if(ballSolo.y>maxY){
      streak=0; score=Math.max(0,score-1);
      beep(260,0.08,0.03); vibr(16);
      toast("ğŸ˜… Ù†Ø²Ø¯ÛŒÚ© Ø¨ÙˆØ¯");
      soloFinishShot(false);
      return;
    }

    // goalie collision
    const rx=goalie.x-goalie.w/2, ry=goalie.y-goalie.h/2;
    if(circleRectHit(ballSolo.x,ballSolo.y,ballSolo.r, rx,ry, goalie.w,goalie.h)){
      streak=0; score=Math.max(0,score-1);
      beep(240,0.08,0.03); vibr(16);
      toast("ğŸ§¤ Ø³ÛŒÙˆ Ø´Ø¯!");
      soloFinishShot(false);
      return;
    }
  }

  function updateArena(dt){
    timeLeft -= dt;
    if(timeLeft<=0){
      timeLeft=0; running=false; paused=true;
      toast("â± ØªØ§ÛŒÙ… ØªÙ…ÙˆÙ… Ø´Ø¯!");
      if(ADS.showOnTimeEnd) showBottomAd();
      return;
    }

    if(mode===MODES.bot) botAI(dt);

    kickFromStriker(p1);
    kickFromStriker(p2);

    puck.x += puck.vx*(dt*60);
    puck.y += puck.vy*(dt*60);

    puck.vx *= 0.988;
    puck.vy *= 0.988;
    puck.spin = (puck.spin + (puck.vx*0.0009)) * 0.992;

    puck.trail.push({x:puck.x,y:puck.y,a:1});
    if(puck.trail.length>22) puck.trail.shift();
    for(const t of puck.trail) t.a *= 0.92;

    if(checkGoalPVP()) return;

    const minX = arena.m + puck.r;
    const maxX = W - arena.m - puck.r;
    const minY = arena.m + puck.r;
    const maxY = H - arena.m - puck.r;

    if(puck.x<minX){ puck.x=minX; puck.vx*=-0.88; puck.spin*=-0.7; }
    if(puck.x>maxX){ puck.x=maxX; puck.vx*=-0.88; puck.spin*=-0.7; }

    const gx1=(W-arena.goalW)/2;
    const gx2=(W+arena.goalW)/2;
    const inGoalX = (puck.x>=gx1 && puck.x<=gx2);

    if(puck.y<minY){ if(!inGoalX){ puck.y=minY; puck.vy*=-0.88; } }
    if(puck.y>maxY){ if(!inGoalX){ puck.y=maxY; puck.vy*=-0.88; } }
  }

  // ===================== Mode set/reset =====================
  function setMode(m){
    mode=m;
    ui.modeBtns.forEach(b=>b.classList.toggle("active", b.dataset.mode===m));

    paused=false; running=true;
    timeLeft=60;
    particles.length=0; puck.trail.length=0;
    hideBottomAd();

    if(mode===MODES.solo){
      ui.modeLabel.textContent="ØªÚ©â€ŒÙ†ÙØ±Ù‡";
      ui.pillB.style.display="none";
      ui.streakPill.style.display="";
      score=0; goals=0; streak=0;
      pickTarget(); soloResetPositions();
      ui.hint.innerHTML = `ØªÚ©â€ŒÙ†ÙØ±Ù‡: ØªÙˆÙ¾ Ø±Ùˆ <b>Ø¨Ù‡ Ø³Ù…Øª Ù¾Ø§ÛŒÛŒÙ† Ø¨Ú©Ø´ Ùˆ Ø±Ù‡Ø§ Ú©Ù†</b>.`;
      toast("ğŸ¯ ØªÚ©â€ŒÙ†ÙØ±Ù‡");
    } else if(mode===MODES.pvp){
      ui.modeLabel.textContent="Ø¯ÙˆÙ†ÙØ±Ù‡";
      ui.pillB.style.display="";
      ui.streakPill.style.display="none";
      scoreP1=0; scoreP2=0;
      arenaReset();
      ui.hint.innerHTML = `ğŸ‘¥ Ø¯ÙˆÙ†ÙØ±Ù‡: Ø³Ø¨Ø² Ù¾Ø§ÛŒÛŒÙ† / Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø¨Ø§Ù„Ø§. Drag Ú©Ù† Ùˆ Ú¯Ù„ Ø¨Ø²Ù†.`;
      toast("ğŸ‘¥ Ø¯ÙˆÙ†ÙØ±Ù‡");
    } else {
      ui.modeLabel.textContent="Ø±Ø¨Ø§Øª";
      ui.pillB.style.display="";
      ui.streakPill.style.display="none";
      scoreP1=0; scoreP2=0;
      arenaReset();
      ui.hint.innerHTML = `ğŸ¤– Ø±Ø¨Ø§Øª: ØªÙˆ Ø³Ø¨Ø² Ù¾Ø§ÛŒÛŒÙ† Ù‡Ø³ØªÛŒ.`;
      toast("ğŸ¤– Ø±Ø¨Ø§Øª");
    }
    syncUI();
  }

  function syncUI(){
    if(mode===MODES.solo){
      ui.scoreA.textContent=score;
      ui.goals.textContent=goals;
      ui.streak.textContent=streak;
    } else {
      ui.scoreA.textContent=scoreP1;
      ui.scoreB.textContent=scoreP2;
      ui.goals.textContent=(scoreP1+scoreP2);
    }
    ui.time.textContent=Math.max(0, Math.ceil(timeLeft));
    ui.pauseBtn.textContent = paused ? "â–¶ï¸" : "â¸";
    ui.soundBtn.textContent = soundOn ? "ğŸ”Š" : "ğŸ”‡";
  }

  // ===================== Controls =====================
  ui.tavitaBtn.addEventListener("click", ()=>openEitaaLinkSafe("https://eitaa.com/tavita_ads"));
  ui.soundBtn.addEventListener("click", ()=>{
    soundOn=!soundOn;
    syncUI();
    toast(soundOn ? "ğŸ”Š" : "ğŸ”‡");
  });

  function openPause(){
    paused=true;
    ui.pauseOverlay.style.display="flex";
    syncUI();
    if(ADS.showOnPause) showBottomAd();
  }
  function closePause(){ ui.pauseOverlay.style.display="none"; }
  function resume(){
    closePause();
    paused=false;
    syncUI();
    hideBottomAd();
  }

  ui.pauseBtn.addEventListener("click", ()=> paused ? resume() : openPause());
  ui.restartBtn.addEventListener("click", ()=>{ resize(); setMode(mode); });
  ui.resumeBtn.addEventListener("click", resume);
  ui.closePauseBtn.addEventListener("click", ()=>{ closePause(); hideBottomAd(); });
  ui.pauseOverlay.addEventListener("click",(e)=>{ if(e.target===ui.pauseOverlay){ closePause(); hideBottomAd(); } });

  ui.modeBtns.forEach(b=> b.addEventListener("click", ()=> setMode(b.dataset.mode)));

  // ===================== Main loop =====================
  function loop(now){
    let dt = Math.min(0.033, (now-lastT)/1000);
    lastT=now;

    // apply slowmo
    dt *= slowmo;

    if(running && !paused){
      if(mode===MODES.solo) updateSolo(dt);
      else updateArena(dt);
      syncUI();
    }

    ctx.clearRect(0,0,W,H);
    if(mode===MODES.solo) drawSolo();
    else drawArena();

    requestAnimationFrame(loop);
  }

  // ===================== Init =====================
  resize();
  soloResetPositions();
  pickTarget();
  setMode(MODES.solo);
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
