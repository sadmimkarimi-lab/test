<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ุชุงูฺฉุชุง | Tankita</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  
  <!-- ูููุชโูุง ูุงุฑุณ -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css" rel="stylesheet" />

 
<style>
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

    body{
      font-family: Vazir, Vazirmatn, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top,#111827,#020617);
      color:#f9fafb;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      padding:16px;
    }

    .game-wrapper{
      width:100%;
      max-width:420px;
    }

    /* ูุฏุฑ ฺฉุงุฑุชโุดุฏู */
.header{
  display:flex;
  flex-direction: row;          /* ุฑุฏู ูุนููู */
  justify-content:space-between;
  align-items:center;
  gap:10px;
  background:rgba(15,23,42,0.95);
  border-radius:20px;
  padding:8px 12px;
  border:1px solid rgba(148,163,184,.5);
  margin-bottom:12px;
  box-shadow:0 10px 30px rgba(15,23,42,.9);
}

    
/* ุฑุงุณุช ูุฏุฑ: ููฺฏู ุงูู + ุนููุงู ุฑุงุณุชโฺู */
.header-right {
  display: flex;
  flex-direction: row; 
  align-items: center;
  gap: 6px;
  text-align: right;
  flex: 1;
  justify-content: flex-start;
}
    .logo-badge{
      width:64px;
      height:64px;
      border-radius:16px;
      background:radial-gradient(circle at top,#38bdf8,#0f172a);
      box-shadow:0 0 18px rgba(56,189,248,.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      font-size:20px;
      letter-spacing:1px;
      color:#e0faff;
      flex-shrink:0;
    }
  .title-block{
  display:flex;
  flex-direction:column;
  gap:2px;
  text-align:right;   
}
  .title-row{
  display:flex;
  align-items:center;
  gap:6px;
  justify-content:flex-start;
}
    h1{
      font-size:18px;
      font-weight:800;
      white-space:nowrap;
    }
    .subtitle{
      font-size:12px;
      opacity:.9;
      white-space:nowrap;
    }

    /* ฺูพ ูุฏุฑ: ููุท ุฏุฑุจุงุฑู ูุง */
    .header-left{
      display:flex;
      flex-direction:row;
      align-items:center;
      gap:6px;
    }
    .header-link{
      background:linear-gradient(135deg,#3b82f6,#0ea5e9);
      border:1px solid rgba(191,219,254,.9);
      color:#e5e7eb;
      cursor:pointer;
      padding:6px 11px;
      border-radius:999px;
      font-size:11px;
      font-weight:600;
      white-space:nowrap;
      box-shadow:0 6px 18px rgba(37,99,235,.8);
      transition:all .15s;
    }
    .header-link:hover{
      background:linear-gradient(135deg,#0ea5e9,#22c55e);
      border-color:rgba(190,242,100,1);
      color:#f9fafb;
      transform:translateY(-1px) scale(1.03);
      box-shadow:0 10px 24px rgba(34,197,94,.85);
    }
    .header-link:active{
      transform:translateY(1px) scale(.97);
      box-shadow:0 3px 10px rgba(15,23,42,.9);
    }

  .game-panel{
      position:relative; /* ุงุถุงูู ุดุฏ ฺฉู HUD ุฑู ุฑู ุจุงุฒ ุฌุง ุจุฏู */
      background:radial-gradient(circle at top,#020617,#020617 60%,#000);
      border-radius:22px;
      padding:12px 12px 16px;
      box-shadow:0 16px 40px rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.3);
    }

    .canvas-wrap{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(148,163,184,.35);
      margin-bottom:10px;
    }
    canvas{ display:block; width:100%; height:auto; }

    /* ุงุณุชุงู ฺฉู ูพฺฉุณูโูุง ูุถุนุช */
    .stat-pill{
      display:inline-flex;
      align-items:center;
      gap:5px;
      padding:3px 9px;
      border-radius:999px;
      background:rgba(15,23,42,.85);
      border:1px solid rgba(148,163,184,.5);
      white-space:nowrap;
      transition:all .2s;
      font-size:11px;
    }
    .dot{
      width:6px;height:6px;border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 8px rgba(34,197,94,.9);
    }
    .badge-level{
      background:rgba(59,130,246,.2);
      border-color:rgba(59,130,246,.7);
    }
    .badge-coins{
      background:rgba(234,179,8,.12);
      border-color:rgba(234,179,8,.6);
    }
  .danger{
  background:rgba(248,113,113,0.2) !important;
  border-color:#ef4444 !important;
  animation:dangerPulse 0.6s ease-in-out 0s 2;
}
    @keyframes dangerPulse{
      0%{transform:scale(1);}
      50%{transform:scale(1.08);}
      100%{transform:scale(1);}
    }

    /* ุฏฺฉููโูุง ุจุงูุง HUD (ุตุฏุง / ุฑโุงุณุชุงุฑุช) */
    .top-actions{
      display:flex;
      align-items:center;
      gap:4px;
    }
    .top-icon-btn{
      width:30px;
      height:30px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      background:linear-gradient(135deg,#6366f1,#0ea5e9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:16px;
      padding:0;
      user-select:none;
      -webkit-user-select:none;
      box-shadow:0 6px 16px rgba(37,99,235,.8);
      transition:all .15s;
    }
    .top-icon-btn:hover{
      transform:translateY(-1px) scale(1.03);
      box-shadow:0 9px 22px rgba(59,130,246,.9);
    }
    .top-icon-btn:active{
      transform:translateY(1px) scale(.96);
      box-shadow:0 3px 10px rgba(15,23,42,.9);
    }

    /* HUD ฺฉูุงุฑ ุตูุญู: ุณุชูู ฺูพ (ุงูุชุงุฒ/ูุฑุญูู/ูพุงู) ู ุณุชูู ุฑุงุณุช (ุงุณุชูพ/ุตุฏุง/ุดุงูพ/ุณฺฉู) */
    .hud{
      position:absolute;
      inset:0;
      pointer-events:none;
      font-size:11px;
    }

    .hud-left,
    .hud-right{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      flex-direction:column;
      gap:8px;
      pointer-events:auto;
    }

    /* ุณุชูู ฺูพ: ููุงุฑ ุงูุชุงุฒ ฺฉู ุงูู ูโูุงูุฏ ูู ฺฉู ฺฉุงุฏุฑ ูโฺุฑุฎุฏ */
    .hud-left{
      left:-16px;
      align-items:flex-start;
    }

    .hud-left .hud-glass{
      transform:rotate(-90deg);
      transform-origin:left center;
    }

    /* ุณุชูู ุฑุงุณุช: ุฏฺฉููโูุง ู ุดุงูพุ ุจุง ุนุฑุถ ุซุงุจุช */
    .hud-right{
      right:8px;
      align-items:flex-end;
      width:64px;
    }

    .hud-right > *{
      width:100%;
    }

    /* ุจููฺฉ ุดุดูโุง ุนููู */
    .hud-glass{
      background:rgba(15,23,42,0.55);
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.55);
      backdrop-filter:blur(9px);
      -webkit-backdrop-filter:blur(9px);
      box-shadow:0 6px 18px rgba(15,23,42,.75);
      padding:6px;
    }

    /* ุงุณุชูพ + ุตุฏุง: ฺฉูฺฺฉ ู ุฎูุดฺฏู */
    .hud-side-buttons{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:stretch;
    }

    .hud-side-buttons .top-icon-btn{
      width:100%;
      height:32px;
      font-size:14px;
      border-radius:999px;
      box-shadow:0 8px 20px rgba(59,130,246,.9);
    }

    /* ูุฑูุดฺฏุงู ุนููุฏุ ููโุนุฑุถ ุฏฺฉููโูุง */
    .hud-shop-wrap{
      padding:6px 4px;
      border-radius:20px;
    }

    .hud-shop-wrap .shop-bar{
      display:flex;
      flex-direction:column;
      align-items:stretch;
      gap:6px;
      background:transparent;
      border:none;
      box-shadow:none;
      padding:0;
    }

    .hud-shop-wrap .shop-items{
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .shop-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:3px 6px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
    }

    .shop-item.passive{
      opacity:.9;
    }

    .shop-icon{
      font-size:14px;  /* ุขฺฉูโูุง ฺฉู ุจุฒุฑฺฏโุชุฑ ู ุฌุฐุงุจโุชุฑ */
    }

    .shop-count{
      font-size:11px;
      font-weight:600;
    }

    /* ุฏฺฉูู ุดุงูพ ุฌุฐุงุจ */
    .shop-cart{
      width:100%;
      padding:4px 0;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      background:linear-gradient(135deg,#f97316,#e11d48);
      color:#fff;
      box-shadow:0 8px 22px rgba(248,113,113,.9);
      transition:transform .12s, box-shadow .15s;
    }

    .shop-cart:active{
      transform:scale(.94) translateY(1px);
      box-shadow:0 4px 14px rgba(127,29,29,.95);
    }

    /* ุณฺฉูโูุง: ุนุฏุฏ ุจุงูุงุ ุขฺฉู ูพุงูุ ููโุนุฑุถ ุจูู */
    .hud-coins{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      background:rgba(15,23,42,0.95);
    }

    .hud-coins #coins{
      font-size:13px;
      font-weight:700;
    }

    .hud-coins .coin-icon{
      font-size:16px;
    }

    /* ููุงุฑ ุงูุชุงุฒ ุฏุงุฎู ฺฉุงุฏุฑ (ูุจู ุงุฒ ฺุฑุฎุด) ุงูู ูโูุงูุฏ */
    .hud-sub{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:nowrap;
    }

    /* ุชูุถุญุงุช ุฒุฑ ฺฉูุชุฑูโูุง (ูุซู ูุจู) */
    .controls-hint{
      margin-top:6px;
      font-size:11px;
      opacity:.85;
      line-height:1.7;
      text-align:right;
    }

    /* ูพุงู ุงููุงูโุจุฎุด */
    .hud-hint{
      font-size:13px;
      opacity:.95;
      font-weight:500;
    }

    .overlay{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      justify-content:center; align-items:center;
      background:radial-gradient(circle at center,rgba(15,23,42,.35),rgba(15,23,42,.96));
      text-align:center; padding:14px; z-index:3;
    }
    .overlay.hidden{display:none;}
    .overlay h2{ font-size:19px; margin-bottom:6px; }
    .overlay p{
      font-size:12px; opacity:.9; margin-bottom:10px; line-height:1.9;
    }
    .overlay button{
      border:none; border-radius:999px;
      padding:7px 18px; font-size:13px; font-weight:600;
      cursor:pointer;
      background:linear-gradient(135deg,#ec4899,#6366f1);
      color:#fff; box-shadow:0 10px 26px rgba(129,140,248,.9);
      margin:2px;
    }
    .overlay .secondary{
      background:transparent;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:none;
    }

/* ูุฎุตูุต ุตูุญู ุดุฑูุน ุจุงุฒ */
#startOverlay button{
  width:100%;
  max-width:260px;
}

/* ุงุณุชุงู ุฌุฏุง ุจุฑุง ุฏฺฉูู ูุฑุงุญู ุจุงุฒ */
#startOverlay #levelsBtn{
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:#ecfdf5;
  border:none;
  box-shadow:0 10px 26px rgba(34,197,94,0.85);
  margin-top:4px;
}

/* ุฏฺฉูู ุงุฏุงูู ูุซู ูุจู ุณุงุฏู ุจูุงูุฏ */
#startOverlay #continueBtn{
  background:transparent;
  border:1px solid rgba(148,163,184,.6);
  box-shadow:none;
}

  
/* Controls: ุฏฺฉููโูุง ุญุฑฺฉุช ุฏุฑ ฺูพุ ุขุชุด ฺฏุฑุฏ ุฏุฑ ุฑุงุณุช */
    .controls{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      direction:ltr;
      animation:controlsPulse 3s ease-in-out 0s 2;
    }

    @keyframes controlsPulse{
      0%,100%{transform:translateY(0);}
      50%{transform:translateY(-3px);}
    }

    /* ุงุณุชุงู ูพุงู ุฏฺฉููโูุง */
    .ctrl-btn{
      border:none;
      cursor:pointer;
      font-weight:700;
      user-select:none;
      -webkit-user-select:none;
      text-shadow:0 0 8px rgba(15,23,42,.9);
      transition:transform .12s, box-shadow .15s, filter .15s;
    }

    .ctrl-btn:active{
      transform:scale(.94) translateY(1px);
      box-shadow:0 4px 14px rgba(15,23,42,.9);
    }

    .controls-left{
      flex:1;
    }

    .controls-arrows{
      display:flex;
      gap:10px;
    }

    .ctrl-btn.arrow{
      flex:1;
      border-radius:20px;
      padding:12px 0;
      font-size:18px;
      background:radial-gradient(circle at top,#1d4ed8,#0ea5e9);
      color:#e0faff;
      box-shadow:0 10px 30px rgba(59,130,246,.7);
      border:1px solid rgba(15,23,42,0.9);
    }

    /* ุฏฺฉูู ุขุชุด ฺฏุฑุฏ ุฏุฑ ุณูุช ุฑุงุณุช */
    .big-fire{
      flex:0 0 72px;
      width:72px;
      height:72px;
      border-radius:999px;
      padding:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:28px;
      background:radial-gradient(circle at top,#f97316,#e11d48);
      box-shadow:0 14px 40px rgba(239,68,68,.8);
      color:#fff;
    }
  

    /* Modal base */
    .modal{
      position:fixed; inset:0;
      display:flex; justify-content:center; align-items:center;
      background:rgba(15,23,42,0.9);
      z-index:50;
    }
    .modal.hidden{ display:none; }
    .modal-box{
      background:radial-gradient(circle at top,#020617,#020617 60%,#000);
      border-radius:20px;
      padding:18px;
      max-width:380px;
      width:92%;
      border:1px solid rgba(148,163,184,0.45);
      box-shadow:0 18px 40px rgba(15,23,42,0.95);
      text-align:right;
      max-height:82vh;
  overflow-y:auto;
    }

  /* ููุท ุจุฑุง ููุฏุงู ูุฑุงุญู: ุงุฑุชูุงุน ูุญุฏูุฏ + ุงุณฺฉุฑูู ุฏุงุฎู */
#levelModal .modal-box{
  max-height:82vh;
  overflow-y:auto;
}
    .modal-box h2{ font-size:16px; margin-bottom:6px; }
    .modal-box p{
      font-size:12px; line-height:1.9; opacity:0.9; margin-bottom:10px;
    }
    .modal-actions{
      display:flex; justify-content:flex-end; gap:8px; margin-top:10px;
    }
    .modal-actions button{
      border:none; border-radius:999px;
      padding:6px 14px; font-size:12px; cursor:pointer;
      background:linear-gradient(135deg,#6366f1,#0ea5e9);
      color:#f9fafb;
    }
    .modal-actions .secondary{
      background:transparent;
      border:1px solid rgba(148,163,184,.6);
    }

    /* Shop modal */
    .shop-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:8px;
    }
    .shop-card{
      background:rgba(2,6,23,.9);
      border:1px solid rgba(148,163,184,.35);
      border-radius:14px;
      padding:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .shop-info{
      display:flex; flex-direction:column; gap:4px;
    }
    .shop-title{
      font-size:13px; font-weight:800;
    }
    .shop-desc{
      font-size:11px; opacity:.85; line-height:1.7;
    }
    .shop-buy{
      border:none; border-radius:999px;
      padding:6px 12px; font-size:12px; font-weight:700;
      cursor:pointer;
      background:linear-gradient(135deg,#f59e0b,#ef4444);
      color:#fff;
      white-space:nowrap;
      box-shadow:0 8px 20px rgba(239,68,68,.7);
    }
    .shop-buy:disabled{
      opacity:.5; cursor:not-allowed;
      box-shadow:none;
    }
    .shop-coins{
      margin-top:4px;
      font-size:12px;
      opacity:.9;
    }

    @media(max-width:480px){
      h1{font-size:17px;}
      .subtitle{font-size:11px;}
      .logo-badge{width:56px;height:56px;}
    }



/* ุฏฺฉููโ ูุฑุญูู ุชู HUD ฺฉูฺฉโุฎูุฑ ุจุงุดุฏ */
.badge-level{
  cursor:pointer;
}

/* ฺฏุฑุฏ ูุฑุงุญู โ ด ุณุชููุ ฺฉุงุฑุชโูุง ฺฉูฺฺฉ */
.level-grid{
  margin-top:12px;
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:8px;
}

/* ูุฑ ฺฉุงุฑุช ูุฑุญูู */
.level-btn{
  border:none;
  border-radius:16px;
  padding:6px 4px;
  font-size:11px;
  cursor:pointer;
  background:linear-gradient(135deg,#020617,#020617);
  color:#e5e7eb;
  box-shadow:0 8px 18px rgba(15,23,42,0.9);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  gap:4px;
}

/* ุชุตูุฑ ุบูู */
.level-boss-thumb{
  width:52px;
  height:52px;
  border-radius:14px;
  object-fit:cover;
  box-shadow:0 0 0 2px rgba(15,23,42,0.9),
             0 8px 18px rgba(15,23,42,0.95);
}

/* ูุชู ุฒุฑ ุชุตูุฑ */
.level-btn .level-label{
  text-align:center;
  font-weight:600;
}

/* ุชุตูุฑ ุบูู ูุฑ ูุฑุญูู (ุฏุงุฎู ุฏฺฉูู) */
.level-boss-thumb{
  width:50px;
  height:50px;
  border-radius:14px;
  object-fit:cover;
  box-shadow:0 0 0 2px rgba(15,23,42,0.9),
             0 10px 22px rgba(15,23,42,0.9);
}

/* ูุฑุญูู ูุนู */
.level-btn.current{
  background:linear-gradient(135deg,#16a34a,#22c55e);
}

/* ูุฑุงุญู ููู ุดุฏู */
.level-btn.locked{
  background:#020617;
  color:#9ca3af;
  border:1px dashed rgba(148,163,184,.7);
  box-shadow:none;
  cursor:not-allowed;
}

/* ุบููู ูุฑุญูู ูููโุดุฏูุ ฺฉูโุฑูฺฏ ู ุณุงูโูุณูุฏ */
.level-btn.locked .level-boss-thumb{
  opacity:0.4;
  filter:grayscale(1);
}


  

/* ===== ุงูุชุฑู ูุฏุฆู ===== */
.intro-screen{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:100;
}

.intro-video{
  width:100%;
  max-width:420px;
  border-radius:18px;
  background:#000;
  box-shadow:0 20px 40px rgba(0,0,0,.9);
}


.intro-loader{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:150;
}

.intro-loader-bar{
  width:60%;
  max-width:260px;
  height:6px;
  border-radius:999px;
  background:#111827;
  overflow:hidden;
  box-shadow:0 0 18px rgba(59,130,246,0.9);
  margin-bottom:10px;
}

.intro-loader-fill{
  width:40%;
  height:100%;
  border-radius:999px;
  background:linear-gradient(90deg,#3b82f6,#a855f7,#f97316);
  animation:introLoading 1.1s linear infinite;
}

.intro-loader-text{
  font-size:13px;
  color:#e5e7eb;
  opacity:0.9;
}

@keyframes introLoading{
  0%{ transform:translateX(-120%); }
  100%{ transform:translateX(220%); }
}
    
/* ฺฉูุชุฑูโูุง ูุฏุฆู ุงูุชุฑู โ ููุงุฑ ูููุงู ุฒุฑ ูุฏุฆู */
.intro-controls{
  margin-top:10px;
  display:flex;
  gap:8px;
  padding:4px 10px;
  border-radius:999px;
  background:rgba(15,23,42,0.65);
  border:1px solid rgba(30,64,175,0.7);
  box-shadow:0 10px 24px rgba(15,23,42,0.9);
  backdrop-filter:blur(10px);
}

/* ุฏฺฉููโูุง ุงูุชุฑู (ฺฉูฺฺฉ ู ูููุงู) */
.intro-btn{
  border-radius:999px;
  border:1px solid transparent;
  padding:4px 10px;
  font-size:11px;
  font-weight:500;
  cursor:pointer;
  white-space:nowrap;
  display:flex;
  align-items:center;
  gap:4px;
}

/* ุฏฺฉูู ุตุฏุง โ ุชุฑู ู ุณุงุฏู */
.intro-btn.mute{
  background:transparent;
  color:#e5e7eb;
  border-color:rgba(148,163,184,0.7);
}

/* ุฏฺฉูู ุฑุฏ ฺฉุฑุฏู โ ฺฏุฑุงุฏุงู ฺฉูฺฺฉ ู ุฌุฐุงุจ */
.intro-btn.skip{
  background:linear-gradient(135deg,#f97316,#ec4899);
  color:#fff;
  box-shadow:0 8px 18px rgba(248,113,113,0.8);
}
.hidden-game{
  display:none;
}

/* ููุงุฑ ุฌูู ุจุงุณ */
#bossHpBar {
  position: absolute;
  top: 5%;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  height: 16px;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.9);
  box-shadow: 0 0 18px rgba(248, 113, 113, 0.7);
  overflow: hidden;
  pointer-events: none;
  z-index: 5;
}

/* ููุช ููุงุฑ ุจุงุณ hidden ุจุดูุ ฺฉูุงู ุงุฒ ุตูุญู ุจุฑู */
#bossHpBar.hidden {
  display: none;
}
  
/* ูพุฑุดุฏฺฏ ููุงุฑ */
#bossHpFill {
  height: 100%;
  width: 100%;
  background: linear-gradient(90deg, #22c55e, #eab308, #f97316, #ef4444);
  box-shadow: 0 0 14px rgba(248, 113, 113, 0.9);
  transition: width 0.18s ease-out;
}

/* ุนุฏุฏ HP ูุณุท ููุงุฑ */
#bossHpText {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: "Vazir", Vazirmatn, system-ui;
  font-size: 11px;
  font-weight: 700;
  color: #e5f6ff;
  text-shadow: 0 0 6px #020617;
}

.hidden{
  opacity:0;
  pointer-events:none;
}

/* ูุฑุฒุด ุตูุญู ููฺฏุงู ูุฑฺฏ ุจุงุณ */
@keyframes bossDieShake {
  0%   { transform: translate(0,0); }
  15%  { transform: translate(-12px, 10px); }
  30%  { transform: translate(10px, -12px); }
  45%  { transform: translate(-14px, 8px); }
  60%  { transform: translate(12px, -10px); }
  75%  { transform: translate(-10px, 12px); }
  100% { transform: translate(0,0); }
}

.screen-shake {
  animation: bossDieShake 0.75s ease-out; /* ูุฏุช ุจุดุชุฑ */
}
/* ุงููุฌุงุฑ / ุฏูุฏ ุจููุด */
@keyframes bossExplosion {
  0%   { opacity: 1; transform: scale(0.4); filter: blur(0px); }
  50%  { opacity: 1; transform: scale(2.4); filter: blur(2px); }
  100% { opacity: 0; transform: scale(3.1); filter: blur(4px); }
}

.boss-death-flash {
  position: absolute;
  left: 50%;     /* ููุฏุงุฑ ูพุดโูุฑุถุ ุจุนุฏุงู ุจุง JS override ูโุดู */
  top: 50%;
  width: 220px;
  height: 220px;
  transform: translate(-50%, -50%);
  background: radial-gradient(
    circle,
    rgba(0,0,0,0.85) 0%,      /* ูุฑฺฉุฒ ุฎู ุชุฑู */
    rgba(76,29,149,0.90) 35%, /* ุจููุด ุฎู ุชุฑู */
    rgba(147,51,234,0.85) 70%,/* ุจููุด ุฑูุดูโุชุฑ ูุซู ุฏูุฏ */
    rgba(15,23,42,0) 100%     /* ูุญู ุดุฏู */
  );
  border-radius: 50%;
  pointer-events: none;
  z-index: 30;
  animation: bossExplosion 0.9s forwards;
}




/* --- About Tavita Modal --- */

.about-modal {
  max-width: 520px;
  padding: 24px 22px 18px;
  background: radial-gradient(circle at top, #18243a 0%, #050814 60%, #040712 100%);
  border-radius: 24px;
  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.85);
  border: 1px solid rgba(120, 180, 255, 0.25);
}

.about-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.about-icon {
  width: 40px;
  height: 40px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle at 30% 0, #ff7dd4, #803bff);
  box-shadow: 0 0 18px rgba(168, 120, 255, 0.7);
  font-size: 22px;
}

.about-title {
  margin: 0;
  font-size: 18px;
  font-weight: 800;
}

.about-tagline {
  margin: 2px 0 0;
  font-size: 12px;
  opacity: 0.8;
}

.about-body {
  margin-top: 10px;
  font-size: 13px;
  line-height: 2.1;
  text-align: right;
}

.about-body p {
  margin: 6px 0 8px;
}

.about-highlight {
  margin: 10px 0 8px;
  padding: 10px 12px;
  border-radius: 16px;
  background: rgba(74, 144, 226, 0.08);
  border: 1px solid rgba(74, 144, 226, 0.25);
}

.about-highlight strong {
  display: block;
  margin-bottom: 4px;
  font-size: 13px;
}

.about-highlight ul {
  margin: 0;
  padding-right: 18px;
  list-style: "โข  ";
}

.about-highlight li {
  margin: 2px 0;
}

.about-channel {
  margin-top: 10px;
  font-size: 12px;
}

.about-channel-box {
  margin-top: 6px;
  padding: 8px 10px;
  border-radius: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(13, 194, 138, 0.1);
  border: 1px solid rgba(13, 194, 138, 0.4);
}

.about-id {
  font-weight: 700;
  color: #0dc28a;
  direction: ltr;
}

/* ุงุทููุงู ุงุฒ ุฎูุงูุง ุฑู ููุจุงู */
@media (max-width: 480px) {
  .about-modal {
    margin: 0 12px;
    padding: 20px 18px 16px;
  }

  .about-title {
    font-size: 16px;
  }
}
  
/* ููฺฏู ูุงูุน ุทุงูุชุง ุฏุฑ ููุฏุงู */
.about-icon {
  width: 46px;
  height: 46px;
  border-radius: 14px;
  padding: 4px;
  background: rgba(255, 255, 255, 0.07);  /* ู ุจฺฉโฺฏุฑุงูุฏ ุฎู ูุทู */
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 14px rgba(0, 0, 0, 0.35);
}

.about-icon img {
  width: 100%;
  height: 100%;
  border-radius: 12px;
  object-fit: cover;
}


.help-modal h3{
  font-size:14px;
  margin:10px 0 4px;
}

.help-list{
  margin:0;
  padding-right:18px;
  font-size:12px;
  line-height:2;
}

.help-list li{
  margin-bottom:2px;
}


/* --- ุชูุธูุงุช ููุง ุชุงูฺฉุชุง --- */

/* ุณุชูู ุฑุงุณุช: ุงุณุชูพ / ุตุฏุง / ุดุงูพ / ุณฺฉู โ ุจุงุฑฺฉ ู ุจุงูุง ุชุฑ */
.hud-right{
  width:56px;         /* ุจุงุฑฺฉ ู ฺฉโุฏุณุช */
  right:8px;          /* ฺฉู ุฏุงุฎูโุชุฑ ุงุฒ ูุจู */
  top:38%;            /* ุจุงูุงุชุฑ ุชุง ุชุงูฺฉ ุฒุฑุด ูุฑู */
  transform:translateY(-50%);
}
.hud-right > *{
  width:100%;         /* ููู ฺฉุงุฏุฑูุง ุณุชูู ุฑุงุณุช ฺฉ ุนุฑุถ */
}

/* ุณุชูู ฺูพ: ููุงุฑ ุงูุชุงุฒ/ูุฑุญูู/ูพุงูุ ุฏุงุฎู ุจุงุฒ ู ุฑูุจูโุฑู ุดุงูพ */
.hud-left{
  left:8px;           /* ุงุฒ ุตูุญู ุจุฑูู ูุจุงุดูุ ฺฉุงูู ุฏุงุฎู ุจุงุฒ */
  top:38%;            /* ุฑูุจูโุฑู ุณุชูู ุฑุงุณุช ู ฺฉู ุจุงูุงุชุฑ */
  transform:translateY(-50%);
  align-items:flex-start;
}

/* ุฎูุฏ ฺฉุงุฏุฑ ุงูุชุงุฒ โ ููุงุฑ ุงูู ฺฉู ููุท ฺฉุงุฏุฑุด ฺุฑุฎุฏู ู ุจุงุฑฺฉ ุดุฏู */
.hud-left .hud-glass{
  max-width:150px;    /* ูุตู ฺุฒ ฺฉู ูุจูุงู ุจูุฏุ ุจุงุฑฺฉโุชุฑ ู ุธุฑูโุชุฑ */
  padding:4px 8px;
  transform:rotate(-90deg);
  transform-origin:left center;
}

/* ฺฉุงุฏุฑ ุณฺฉู โ ุนุฏุฏ ุจุงูุงุ ุขฺฉู ูพุงูุ ููโุนุฑุถ ุจูู */
.hud-coins{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:2px;
  background:rgba(15,23,42,0.95);
}
.hud-coins #coins{
  font-size:13px;
  font-weight:700;
}
.hud-coins .coin-icon{
  font-size:16px;
}

/* ุฏฺฉููโูุง ฺูพ ู ุฑุงุณุช ฺฉู ฺฉูฺฺฉโุชุฑ ู ุงุฒ ุขุชุด ุฏูุฑุชุฑ */
.controls{
  gap:18px;           /* ูุงุตูู ุจุดุชุฑ ุจู ุฌูุชโูุง ู ุขุชุด */
}
.ctrl-btn.arrow{
  padding:9px 0;
  font-size:15px;
}
.big-fire{
  flex:0 0 68px;
  width:68px;
  height:68px;
  border-radius:999px;
}

/* ุฌููฺฏุฑ ุงุฒ ุชฺฉุงู ุฎูุฑุฏู ุตูุญู ุฑู ููุจุงู ููุช ุฑู ุจุงุฒ ููุณ ูโฺฉู */
html, body{
  overscroll-behavior:none;
}
.game-wrapper,
canvas{
  touch-action:none;
}

  
  
  </style>
</head>
<body>

<div id="introLoader" class="intro-loader">
  <div class="intro-loader-bar">
    <div class="intro-loader-fill"></div>
  </div>
  <div class="intro-loader-text">ุฏุฑ ุญุงู ุขูุงุฏูโุณุงุฒ ูุจุฑุฏ...</div>
</div>
  
<!-- ุตูุญู ุงูุชุฑู ูุฏุฆู -->
  <div id="introScreen" class="intro-screen">
    <video
      id="introVideo"
      class="intro-video"
      src="https://cdnfa.com/irangiah/a9be/uploads/tank/tankk.mp4"
      autoplay
      playsinline
      muted
    ></video>

<audio id="startSfx" src="https://cdn.jsdelivr.net/gh/itsrahaa/sfx/tank-start.mp3" preload="auto"></audio>
    
    <div class="intro-controls">
      <button id="introMuteBtn" class="intro-btn mute">๐ ุตุฏุง</button>
      <button id="introSkipBtn" class="intro-btn skip">ุฑุฏ ฺฉุฑุฏู โญ๏ธ</button>
    </div>
  </div>

  <!-- ุดุฑูุน ูุญุท ุจุงุฒ (ูุนูุงู ูุฎู) -->
  <div class="game-wrapper hidden-game" id="gameWrapper">

    <!-- ูุฏุฑ -->
    <header class="header">
      <!-- ุฑุงุณุช: ููฺฏู ุจุนุฏ ุนููุงู -->
      <div class="header-right">
        <div class="logo-badge">
  <img src="https://cdnfa.com/irangiah/a9be/uploads/tank/tankitalo.webp" style="width:100%;height:100%;object-fit:contain;border-radius:14px;">
</div>
        <div class="title-block">
          <div class="title-row">
            <h1>ุชุงูฺฉุชุง</h1>
          </div>
          <div class="subtitle">ุจุง ุชุงูฺฉ ุงุฑุงุฏูุ ูููุฑู ุฐููุช ุฑู ูพุงฺฉ ฺฉู.</div>
        </div>
      </div>

      <!-- ฺูพ: ููุท ุฏุฑุจุงุฑู ูุง -->
    <div class="header-left">
  <button class="header-link" id="helpBtn">ุฑุงูููุง</button>
  <button class="header-link" id="aboutBtn">ุฏุฑุจุงุฑู ูุง</button>
</div>
    </header>

    <div class="game-panel">

      <div class="canvas-wrap">
      <canvas id="gameCanvas"></canvas>

<div id="bossHpBar" class="hidden">
  <div id="bossHpFill"></div>
  <span id="bossHpText"></span>
</div>
        
        <!-- ุดุฑูุน -->
        <div id="startOverlay" class="overlay">
  <h2>ุชุงูฺฉุชุง ุขูุงุฏูโุณุช ๐</h2>
  <p>
    ุจุง ุชุงูฺฉ ุงุฑุงุฏูโุงุชุ ุนุงุฏุชโูุง ุจุฏ ุฑู ูุงุจูุฏ ฺฉู ู ูุฑุญูู ุจู ูุฑุญูู<br/>
    ุบููโูุง ูููุฑู ุฐููุช ุฑู ุดฺฉุณุช ุจุฏู. <br>
    ุจุฑุง ุดุฑูุน ุฑู ุฏฺฉูู ยซุดุฑูุน ุงุฒ ูุฑุญูู ฑยป ุจุฒู.
  </p>

  <button id="startBtn">ุดุฑูุน ุงุฒ ูุฑุญูู ฑ</button>
  <button id="continueBtn" class="secondary">ุงุฏุงูู ุงุฒ ุขุฎุฑู ูุฑุญูู</button>
  <!-- ๐ ุฏฺฉูู ุฌุฏุฏ -->
  <button id="levelsBtn" class="secondary">ูุฑุงุญู ุจุงุฒ</button>
</div>

        <!-- ูพุงุงู ูุฑุญูู -->
        <div id="levelOverlay" class="overlay hidden">
          <h2>ูุฑุญูู ุชููู ุดุฏ! ๐</h2>
          <p>
            ุบูู ุงู ูุฑุญูู ูุงุจูุฏ ุดุฏ ู ูุณุฑ ุฐูู ุชูุฒ ุดุฏ.<br/>
            ฒ ุฌุงู ูุฏู ฺฏุฑูุชุ ุขูุงุฏูโุง ุจุฑ ุณุฑุงุบ ุบูู ุจุนุฏุ
          </p>
          <button id="nextLevelBtn">ุฑูุชู ุจู ูุฑุญูู ุจุนุฏ โถ๏ธ</button>
        </div>

        <!-- ฺฏูโุงูุฑ -->
        <div id="gameOverOverlay" class="overlay hidden">
          <h2>ูพุงุงู ุงู ุฏูุฑ ๐</h2>
          <p>
            ุงูุชุงุฒ ุงู ุฏูุฑ: <span id="finalScore">0</span><br>
            ุจูุชุฑู ุงูุชุงุฒ: <span id="bestScore">0</span>
          </p>
          <button id="restartBtn">ุดุฑูุน ูุฌุฏุฏ ุงุฒ ูุฑุญูู ูุจู</button>
        </div>
      </div>

      <!-- HUD ฺฉูุงุฑ: ุณุชูู ฺูพ = ุงูุชุงุฒ/ูุฑุญูู/ูพุงู ุ ุณุชูู ุฑุงุณุช = ุงุณุชูพ/ุตุฏุง/ุดุงูพ/ุณฺฉู -->
      <div class="hud">

        <!-- ุณุชูู ฺูพ: ููุงุฑ ุงูุชุงุฒ ฺฉู ฺุฑุฎุฏู -->
        <div class="hud-left">
          <div class="hud-glass">
            <div class="hud-sub">
              <span class="stat-pill">
                <span class="dot"></span>
                ุงูุชุงุฒ: <span id="score">0</span>
              </span>

              <span class="stat-pill badge-level">
                ูุฑุญูู: <span id="levelLabel">ฑ</span>
              </span>

              <span class="hud-hint" id="motivationText"></span>
            </div>
          </div>
        </div>

        <!-- ุณุชูู ุฑุงุณุช: ุงุณุชูพ / ุตุฏุง / ูุฑูุดฺฏุงู / ุณฺฉูโูุง -->
        <div class="hud-right">

          <!-- ุงุณุชูพ + ุตุฏุง -->
          <div class="hud-glass hud-side-buttons">
            <button class="top-icon-btn" id="pauseBtn" title="ุชููู/ุงุฏุงูู">โธ๏ธ</button>
            <button class="top-icon-btn" id="soundToggle" title="ูุทุน/ูุตู ุตุฏุง">๐</button>
          </div>

          <!-- ฺฉุงุฏุฑ ูุฑูุดฺฏุงู ุนููุฏุ ููโุนุฑุถ ุฏฺฉููโูุง -->
          <div class="hud-glass hud-shop-wrap">
            <div class="shop-bar">
              <div class="shop-items">
                <!-- ุฌุงู - ููุท ููุงุด -->
                <div class="shop-item passive" id="lifeDisplay">
                  <span class="shop-icon">โค๏ธ</span>
                  <span class="shop-count" id="lives">3</span>
                </div>

                <!-- ุฒูุงู ฺฉูุฏฺฉููุฏู -->
                <div class="shop-item" id="slowUseBtn">
                  <span class="shop-icon">โณ</span>
                  <span class="shop-count" id="slowCount">0</span>
                </div>

                <!-- ุณูพุฑ -->
                <div class="shop-item" id="shieldUseBtn">
                  <span class="shop-icon">๐ก</span>
                  <span class="shop-count" id="shieldCount">0</span>
                </div>

                <!-- ููุดฺฉ -->
                <div class="shop-item" id="rocketUseBtn">
                  <span class="shop-icon">๐</span>
                  <span class="shop-count" id="rocketCount">0</span>
                </div>

                <!-- ุดูฺฉ ุณูโุชุง -->
                <div class="shop-item" id="tripleUseBtn">
                  <span class="shop-icon">โ๏ธ3</span>
                  <span class="shop-count" id="tripleCount">0</span>
                </div>
              </div>

              <!-- ุฏฺฉูู ุดุงูพ: ุฏฺฏู ุณุจุฏ ุฎุฑุฏ ูุฏุงุฑูุ ููุท ยซุดุงูพยป -->
              <button class="shop-cart" id="shopBtn" title="ุดุงูพ">
                ุดุงูพ
              </button>
            </div>
          </div>

          <!-- ุณฺฉูโูุง: ุนุฏุฏ ุจุงูุงุ ุขฺฉู ูพุงูุ ููโุนุฑุถ ุดุงูพ -->
          <span class="stat-pill badge-coins hud-glass hud-coins">
            <span id="coins">0</span>
            <span class="coin-icon">๐ช</span>
          </span>

        </div>
      </div>

      <!-- ฺฉูุชุฑูโูุง: ุฌูุชโูุง ุฏุฑ ฺูพุ ุขุชุด ฺฏุฑุฏ ุฏุฑ ุฑุงุณุช -->
      <div class="controls">
        <div class="controls-left">
          <div class="controls-arrows">
            <button class="ctrl-btn arrow" id="leftBtn">โ๏ธ</button>
            <button class="ctrl-btn arrow" id="rightBtn">โถ๏ธ</button>
          </div>
        </div>

        <button class="ctrl-btn big-fire" id="fireBtn">๐ฅ</button>
      </div>

      
  <!-- ููุฏุงู ุฏุฑุจุงุฑู ุทุงูุชุง -->
<div class="modal hidden" id="aboutModal">
  <div class="modal-box about-modal">
    
    <div class="about-header">
    <div class="about-icon">
  <img src="https://cdnfa.com/irangiah/a9be/uploads/tank/tavitalo.webp" alt="Tavita Logo">
</div>
      <div>
        <h2 class="about-title">ุฏุฑุจุงุฑู ุทุงูุชุง</h2>
        <p class="about-tagline">ุงุฒ ุงุฏู ุชุง ุฑุดุฏ ุฐูู ู ฺฉุณุจโุฏุฑุขูุฏ</p>
      </div>
    </div>

    <div class="about-body">
      <p>
        ุทุงูุชุง ฺฉ ูุฌููุนูู ุฎูุงู ุฏุฑ ุญูุฒูโ ุฑุดุฏ ุฐููุ ุจุงุฒโุณุงุฒ ู ุขููุฒุด ููุงุฑุชโูุง ููู ุงุณุช.  
        ูุง ุจุงุฒโูุง ู ุงุจุฒุงุฑูุง ูโุณุงุฒู ฺฉู ูู ุณุฑฺฏุฑูโฺฉููุฏู ุจุงุดูุฏุ ูู ุฐูู ุฑุง ุชููุช ฺฉููุฏ ู
        ูู ุจู ุณุงุฎุชู ุนุงุฏุชโูุง ุฎูุจ ุฏุฑ ุฒูุฏฺฏ ฺฉูฺฉ ฺฉููุฏ.
      </p>

      <p>
        ุชูุฑฺฉุฒ ูุง ุฑู ุทุฑุงุญ ุชุฌุฑุจูโูุง ุงุณุช ฺฉู ฺฉุงุฑุจุฑ ุฑุง ุงุฒ ยซุชูุฑุญู ุตุฑูยป ุจู ุณูุช 
        ยซุฑุดุฏ ูุฑุฏยป ูุฒุฏฺฉ ฺฉูุฏุ  
        ุฌุง ฺฉู ูุฑ ูุฑุญููุ ฺฉ ูุฏู ูุงูุน ุจู ุณูุช ุจูุชุฑ ุดุฏู ุจุงุดุฏ.
      </p>

      <div class="about-highlight">
        <strong>ุฏุฑ ุทุงูุชุง ฺู ฺฉุงุฑ ูโฺฉููุ</strong>
        <ul>
          <li>ุทุฑุงุญ ุจุงุฒโูุง ุฐูู ู ุนุงุฏุชโุณุงุฒ ูุซู ุชุงูฺฉุชุง ๐ฎ</li>
          <li>ุขููุฒุด ุชููุฏ ูุญุชูุง ู ุงุณุชูุงุฏู ุงุฒ ููุด ูุตููุน ุจุฑุง ฺฉุณุจโุฏุฑุขูุฏ ๐ก</li>
          <li>ุณุงุฎุช ุงุจุฒุงุฑูุง ฺฉุงุฑุจุฑุฏ ุจุฑุง ุฑุดุฏ ูุฑุฏ ู ุดุบู ๐</li>
        </ul>
      </div>

      <div class="about-channel">
        <span>ุจุฑุง ุงุทูุงุน ุงุฒ ูพุฑูฺูโูุง ู ุขููุฒุดโูุง ุฌุฏุฏุ ูุง ุฑุง ุฏุฑ ฺฉุงูุงู ุฑุณู ุทุงูุชุง ุฏูุจุงู ฺฉูุฏ:</span>
        <div class="about-channel-box">
          <span>ฺฉุงูุงู ุทุงูุชุง ุฏุฑ ุงุชุง</span>
          <span class="about-id">@tavita</span>
        </div>
      </div>
    </div>

    <div class="modal-actions">
      <button class="secondary" id="aboutCloseBtn">ุจุณุชู</button>
    </div>
  </div>
</div>


<!-- ููุฏุงู ุฑุงูููุง ุจุงุฒ -->
  <div class="modal hidden" id="helpModal">
    <div class="modal-box help-modal">
      <h2>ุฑุงูููุง ุจุงุฒ ุชุงูฺฉุชุง</h2>

      <p>
        ุชู ยซุชุงูฺฉุชุงยป ุจุง ุชุงูฺฉ ุงุฑุงุฏูโุงุชุ ุนุงุฏุชโูุง ุจุฏ ุฑู ูุงุจูุฏ ูโฺฉูุ ุบููโูุง ุฐูู ุฑู ุดฺฉุณุช ูโุฏ
        ู ูุฑุญูู ุจู ูุฑุญูู ููโุชุฑ ูโุด. ุงู ุฑุงูููุง ฺฉูุชุงู ุจูุช ฺฉูฺฉ ูโฺฉูู ุฑุงุญุชโุชุฑ ุจุงุฒ ฺฉู.
      </p>

      <h3>๐ฎ ฺฉูุชุฑูโูุง</h3>
      <ul class="help-list">
        <li>ฺฉุดุฏู ุงูฺฏุดุช ุฒุฑ ุชุงูฺฉ โ ุญุฑฺฉุช ุจู ฺูพ ู ุฑุงุณุช</li>
        <li>ุฏฺฉูู ุดูฺฉ โ ุชุฑ ูุนููู</li>
        <li>ุฏูุจุงุฑ ูพุดุชโุณุฑูู ุฒุฏู ุฑู ุดูฺฉ โ ููุดฺฉ ๐</li>
      </ul>

      <h3>๐งฑ ุณูฺฏโูุง ู ูฺฉุนุจโูุง</h3>
      <ul class="help-list">
        <li>ุบููโูุง ุณูฺฏโูุง ู ูฺฉุนุจโูุง ยซุนุงุฏุชโูุง ุจุฏยป ุฑู ุจู ุณูุชุช ูพุฑุชุงุจ ูโฺฉูู.</li>
        <li>ูุจู ุงุฒ ุฑุณุฏู ุจู ุชุงูฺฉุ ุจุง ุดูฺฉ ูุงุจูุฏุดูู ฺฉู.</li>
      </ul>

      <h3>๐ฅ ุบููโูุง</h3>
      <ul class="help-list">
        <li>ุบููโูุง ฺฉูฺฺฉ ู ูุชูุณุท ุจุง ฺูุฏ ุถุฑุจู ุงุฒ ุจู ูโุฑู.</li>
        <li>ุบูู ุงุตู ูุฑุญูู (ุจุงุณ) ููุงุฑ ุฌุงู ุฏุงุฑุฏ ู ุจู ฺูุฏ ููุดฺฉ ู ุดูฺฉ ูพุดุชโุณุฑูู ูุงุฒ ุฏุงุฑุฏ.</li>
      </ul>

      <h3>๐ ูุฏุฑุชโูุง ูฺู</h3>
      <ul class="help-list">
        <li>๐ก ุณูพุฑ: ฺูุฏ ุซุงูู ุงุฒ ุจุฑุฎูุฑุฏูุง ูุญุงูุธุช ูโฺฉูุฏ.</li>
        <li>๐ ููุดฺฉ: ุถุฑุจูโ ุจุณุงุฑ ูู ุจู ุบููโูุง ู ุณูฺฏโูุง.</li>
        <li>โค๏ธ ุฌุงู ุงุถุงูู: ุงุฏุงูู ุฏุงุฏู ุจุงุฒ ููุช ูุฒุฏฺฉ ุจุงุฎุช.</li>
        <li>โณ ฺฉูุฏฺฉููุฏู: ุญุฑฺฉุช ุฏุดููโูุง ู ุณูฺฏโูุง ุฑุง ฺฉูุฏ ูโฺฉูุฏ.</li>
      </ul>

      <h3>๐ก ูฺฉุชูโูุง</h3>
      <ul class="help-list">
        <li>ุจุง ุณฺฉูโูุง ูโุชูู ุงุฒ ุดุงูพุ ูุฏุฑุชโูุง ูฺู ุจุฎุฑ.</li>
        <li>ูุฑฺู ูุฑุญูู ุจุงูุงุชุฑ ูโุฑูุ ุจุงุฒ ุณุฎุชโุชุฑ ู ูุฌุงูโุงูฺฏุฒุชุฑ ูโุดู.</li>
        <li>ุชูุฑฺฉุฒุ ุตุจุฑ ู ุชฺฉุฑุงุฑ = ฺฉูุฏ ูพุฑูุฒ ุฏุฑ ุชุงูฺฉุชุงุณุช! ๐</li>
      </ul>

      <div class="modal-actions">
        <button class="secondary" id="helpCloseBtn">ูุชูุฌู ุดุฏู</button>
      </div>
    </div>
  </div>
  
  <!-- ููุฏุงู ูุฑูุดฺฏุงู -->
  <div class="modal hidden" id="shopModal">
    <div class="modal-box">
      <h2>ุดุงูพ ุชุงูฺฉุชุง ๐</h2>
      <p>
        ุจุง ุณฺฉูโูุง ูโุชูู ูุฏุฑุชโูุง ูฺู ุจฺฏุฑ ู ุจุนุฏุงู ูุฑ ููุช ุฎูุงุณุช
        ุงุฒ ุฏุงุฎู ฺฉุงุฏุฑ ูพุงู ุตูุญู ุงูุชุฎุงุจ ุงุณุชูุงุฏูโุดูู ฺฉู.
      </p>

      <div class="shop-coins">
        ุณฺฉูโูุง ุดูุง: <span id="shopCoins">0</span> ๐ช
      </div>

      <div class="shop-grid">

  <!-- ุดูฺฉ ุณูโุชุง -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ุดูฺฉ ุณูโุชุง ร3</div>
      <div class="shop-desc">ูุฏุฑุช ุดูฺฉ ุณูโุชุง ุจุฑุง ฺูุฏ ุซุงูู.</div>
      <div class="shop-desc">ููุช: ณฐฐ ๐ช</div>
    </div>
    <button class="shop-buy" id="buyTripleBtn">ุฎุฑุฏ</button>
  </div>

  <!-- ุญูุงุธ ุงูุฑฺ -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ุญูุงุธ ุงูุฑฺ ๐ก</div>
      <div class="shop-desc">ุณูพุฑ ูุญุงูุธ ุฏุฑ ุจุฑุงุจุฑ ุถุฑุจูโูุง.</div>
      <div class="shop-desc">ููุช: ฑตฐ ๐ช</div>
    </div>
    <button class="shop-buy" id="buyShieldBtn">ุฎุฑุฏ</button>
  </div>

  <!-- ููุดฺฉ ูฺู -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ููุดฺฉ ูฺู ๐</div>
      <div class="shop-desc">ููุดฺฉ ุฎู ูู ุบูู ฺฉุด.</div>
      <div class="shop-desc">ููุช: ฒฐฐ ๐ช</div>
    </div>
    <button class="shop-buy" id="buyRocketBtn">ุฎุฑุฏ</button>
  </div>

  <!-- ุฌุงู ุงุถุงูู -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ุฌุงู ุงุถุงูู โค๏ธ</div>
      <div class="shop-desc">ฺฉ ุฌุงู ุงุถุงููุ ุญุฏุงฺฉุซุฑ ท ุจุงุฑ.</div>
      <div class="shop-desc">ููุช: ทตฐ ๐ช</div>
    </div>
    <button class="shop-buy" id="buyLifeBtn">ุฎุฑุฏ</button>
  </div>

  <!-- ฺฉูุฏ ฺฉุฑุฏู ุฒูุงู -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ฺฉูุฏ ฺฉุฑุฏู ุฒูุงู โณ</div>
      <div class="shop-desc">ุฏุดููโูุง ฺูุฏ ุซุงูู ุขูุณุชู ูโุดู.</div>
      <div class="shop-desc">ููุช: ตตฐ ๐ช</div>
    </div>
    <button class="shop-buy" id="buySlowBtn">ุฎุฑุฏ</button>
  </div>


<!-- ุงุณฺฉูโูุง ุชุงูฺฉ -->
  <hr class="shop-separator" />
  <div class="shop-section-title">ุงุณฺฉูโูุง ุชุงูฺฉ ๐จ</div>

  <!-- ุชุงูฺฉ ุฏูุงูุช (ุฑุงฺฏุงู / ุงูุชุฎุงุจ) -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ุชุงูฺฉุชุง</div>
      <div class="shop-desc">ุจุงุฒฺฏูุด ุงูุง ุจุง ุงุฏุจ.</div>
      <div class="shop-desc">ููุช: ฐ ๐ช</div>
    </div>
    <img
      src="https://cdnfa.com/irangiah/a9be/uploads/tank/tank-abi-nama.webp"
      alt="ุชุงูฺฉุชุง"
      style="width:64px;height:64px;object-fit:contain;border-radius:8px;margin-top:6px;"
    />
    <button class="shop-buy tank-skin-btn" data-skin-id="default">
      ุงูุชุฎุงุจ โ
    </button>
  </div>

  <!-- ุชุงูฺฉ ุฌูฺฏู -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ุชุงูฺฉุชุง ุฌูฺฏู ๐ณ</div>
      <div class="shop-desc">ููุธู ู ูุฏุฑุชููุฏ.</div>
      <div class="shop-desc">ููุช: ฒตฐฐ ๐ช</div>
    </div>
    <img
      src="https://cdnfa.com/irangiah/a9be/uploads/tank/tank-jangal-nama.webp"
      alt="ุชุงูฺฉุชุง ุฌูฺฏู"
      style="width:64px;height:64px;object-fit:contain;border-radius:8px;margin-top:6px;"
    />
    <button class="shop-buy tank-skin-btn" data-skin-id="jangal">
      ุฎุฑุฏ ฒตฐฐ ๐ช
    </button>
  </div>

  <!-- ุชุงูฺฉ ฺฉูุฑ -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ุชุงูฺฉุชุง ฺฉูุฑ ๐</div>
      <div class="shop-desc">ุตุจูุฑุ ููุงูู ู ฺุงูุงฺฉ.</div>
      <div class="shop-desc">ููุช: ฒตฐฐ ๐ช</div>
    </div>
    <img
      src="https://cdnfa.com/irangiah/a9be/uploads/tank/tank-kavir-nama.webp"
      alt="ุชุงูฺฉุชุง ฺฉูุฑ"
      style="width:64px;height:64px;object-fit:contain;border-radius:8px;margin-top:6px;"
    />
    <button class="shop-buy tank-skin-btn" data-skin-id="kavir">
      ุฎุฑุฏ ฒตฐฐ ๐ช
    </button>
  </div>

  <!-- ุชุงูฺฉ ูพุฑ -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ุชุงูฺฉุชุง ูพุฑ ๐งโโ๏ธ</div>
      <div class="shop-desc">ููุฑุจุงูุ ููุฏุจุ ูุฏุฑุชููุฏ.</div>
      <div class="shop-desc">ููุช: ฒตฐฐ ๐ช</div>
    </div>
    <img
      src="https://cdnfa.com/irangiah/a9be/uploads/tank/tank-pari-nama.webp"
      alt="ุชุงูฺฉุชุง ูพุฑ"
      style="width:64px;height:64px;object-fit:contain;border-radius:8px;margin-top:6px;"
    />
    <button class="shop-buy tank-skin-btn" data-skin-id="pari">
      ุฎุฑุฏ ฒตฐฐ ๐ช
    </button>
  </div>

  <!-- ุชุงูฺฉ ูพุงูพูู -->
  <div class="shop-card">
    <div class="shop-info">
      <div class="shop-title">ุชุงูฺฉุชุง ูพุงูพูู ๐</div>
      <div class="shop-desc">ุฎูุด ุชูพุ ุจุง ููุงุฑ ู ุณุฎุชฺฉูุด.</div>
      <div class="shop-desc">ููุช: ฒตฐฐ ๐ช</div>
    </div>
    <img
      src="https://cdnfa.com/irangiah/a9be/uploads/tank/tank-papi-nama.webp"
      alt="ุชุงูฺฉุชุง ูพุงูพูู"
      style="width:64px;height:64px;object-fit:contain;border-radius:8px;margin-top:6px;"
    />
    <button class="shop-buy tank-skin-btn" data-skin-id="papi">
      ุฎุฑุฏ ฒตฐฐ ๐ช
    </button>
  </div>

</div>

      <div class="modal-actions">
        <button class="secondary" id="shopCloseBtn">ุจุณุชู</button>
      </div>
    </div>
  </div>


<!-- ููุฏุงู ูุฑุงุญู -->
<div class="modal hidden" id="levelModal">
  <div class="modal-box">
    <h2>ูุฑุงุญู ุจุงุฒ</h2>
    <p style="font-size:11px;opacity:.85;margin-top:4px;">
      ูุฑุงุญู ุจุงุฒ ุดุฏู ุฑุง ูโุชูู ุงูุชุฎุงุจ ฺฉู. ุจูู ููู ูุณุชูุฏ.
    </p>

    <div class="level-grid" id="levelGrid"></div>

    <div class="modal-actions">
      <button class="secondary" id="levelCloseBtn">ุจุณุชู</button>
    </div>
  </div>
</div>


  
  <script>
    // ======== Canvas & ุงูุฏุงุฒู ========
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");


// ======== Intro Video ========
const introScreen = document.getElementById("introScreen");
const gameWrapper = document.getElementById("gameWrapper");
const introVideo   = document.getElementById("introVideo");
const introLoader  = document.getElementById("introLoader");
    const introMuteBtn = document.getElementById("introMuteBtn");
const introSkipBtn = document.getElementById("introSkipBtn");

introVideo.addEventListener("loadeddata", () => {
  introLoader.style.transition = "opacity 0.3s ease";
  introLoader.style.opacity = "0";
  setTimeout(() => {
    introLoader.style.display = "none";
  }, 300);
});

    
function finishIntro(){
  const startSfx = document.getElementById("startSfx");

  // ูุฏ ุงูุช ูุดูฺฏ
  introScreen.style.transition = "opacity 0.7s ease";
  introScreen.style.opacity = "0";

  setTimeout(() => {
    introScreen.style.display = "none";
    gameWrapper.classList.remove("hidden-game");


// ุจุนุฏ ุงุฒ ุธุงูุฑ ุดุฏู ุจุงุฒุ ุงุณฺฉุฑูู ุจู ุณูุช ุฏฺฉููโูุง
    setTimeout(()=>{
      try{
        fireBtn.scrollIntoView({ behavior:"smooth", block:"end" });
      }catch(e){}
    }, 100);

    
    // ูพุฎุด ุตุฏุง ุดุฑูุน (ุงฺฏุฑ ูุฑูุฑฺฏุฑ ุงุฌุงุฒู ุจุฏู)
    if (startSfx) {
      startSfx.currentTime = 0;
      startSfx.play().catch(()=>{});
    }
  }, 700);

  introVideo.pause();
  introVideo.currentTime = 0;
}

introVideo.addEventListener("ended", finishIntro);

introSkipBtn.addEventListener("click", finishIntro);

introMuteBtn.addEventListener("click", ()=>{
  introVideo.muted = !introVideo.muted;
  introMuteBtn.textContent = introVideo.muted ? "๐ ุตุฏุง" : "๐ ุตุฏุง";
});

    
    function resizeCanvas(){
      const maxWidth = 420, ratio = 9/16;
      const width = Math.min(maxWidth, window.innerWidth - 32);
      const height = width / ratio;
      canvas.width = width; canvas.height = height;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    // ======== ุนูุงุตุฑ UI ========
    const scoreEl = document.getElementById("score");
    const livesEl = document.getElementById("lives");
    const coinsEl = document.getElementById("coins");
    const levelLabel = document.getElementById("levelLabel");
    const resetRunBtn = document.getElementById("resetRunBtn");
    const lifeDisplay = document.getElementById("lifeDisplay");

    const startOverlay = document.getElementById("startOverlay");
    const levelOverlay = document.getElementById("levelOverlay");
    const gameOverOverlay = document.getElementById("gameOverOverlay");

    const startBtn = document.getElementById("startBtn");
    const continueBtn = document.getElementById("continueBtn");
    const nextLevelBtn = document.getElementById("nextLevelBtn");
    const restartBtn = document.getElementById("restartBtn");
    const levelsBtn     = document.getElementById("levelsBtn");
const levelModal    = document.getElementById("levelModal");
const levelGrid     = document.getElementById("levelGrid");
const levelCloseBtn = document.getElementById("levelCloseBtn");
const levelBadge    = document.querySelector(".badge-level");
    
    const finalScoreEl = document.getElementById("finalScore");
    const bestScoreEl = document.getElementById("bestScore");

    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");
    const fireBtn = document.getElementById("fireBtn");

    const aboutBtn = document.getElementById("aboutBtn");
const helpBtn  = document.getElementById("helpBtn");
const shopBtn  = document.getElementById("shopBtn");

const aboutModal = document.getElementById("aboutModal");
const helpModal  = document.getElementById("helpModal");
const shopModal  = document.getElementById("shopModal");

const aboutCloseBtn = document.getElementById("aboutCloseBtn");
const helpCloseBtn  = document.getElementById("helpCloseBtn");
const shopCloseBtn  = document.getElementById("shopCloseBtn");

    const buyTripleBtn = document.getElementById("buyTripleBtn");
const buyShieldBtn = document.getElementById("buyShieldBtn");
const buyRocketBtn = document.getElementById("buyRocketBtn");
const buyLifeBtn   = document.getElementById("buyLifeBtn");
const buySlowBtn   = document.getElementById("buySlowBtn");
const shopCoinsEl  = document.getElementById("shopCoins");
const tankSkinButtons = document.querySelectorAll(".tank-skin-btn");
    
    const soundToggleBtn = document.getElementById("soundToggle");
const pauseBtn = document.getElementById("pauseBtn");
    
    // ุขฺฉูโูุง ุงุณุชูุงุฏู ุงูุชุฎุงุจ
    const shieldUseBtn = document.getElementById("shieldUseBtn");
const rocketUseBtn = document.getElementById("rocketUseBtn");
const tripleUseBtn = document.getElementById("tripleUseBtn");
const slowUseBtn   = document.getElementById("slowUseBtn");

const shieldCountEl = document.getElementById("shieldCount");
const rocketCountEl = document.getElementById("rocketCount");
const tripleCountEl = document.getElementById("tripleCount");
const slowCountEl   = document.getElementById("slowCount");

// ุฏุงุจูโุชูพ ุฑู ุฏฺฉูู ุดูฺฉ -> ุงุณุชูุงุฏู ุงุฒ ููุดฺฉ
let lastTap = 0;
function handleDoubleTap(){
  const now = Date.now();

  // ุงฺฏุฑ ุฏู ุชุง ุถุฑุจู ูพุดุช ุณุฑ ูู (ฺฉูุชุฑ ุงุฒ ฒตฐ ููโุซุงูู)
  if(now - lastTap < 250){
    // ุฏููุง ูุซู ุงูู ฺฉู ุฑู ุฏฺฉูู ููุดฺฉ ุจุฒู
    if (rocketUseBtn) {
      rocketUseBtn.click();
    }
  }

  lastTap = now;
}
    
    const motivationTextEl = document.getElementById("motivationText");
    const MOTIVATIONS = [
      "ุงุฏ ุฎุฏุง ุขุฑุงูุด ุจุฎุดู",
      "ูฺ ุฌุง ุงุฒ ุงุฏ ุฎุฏุง ุบุงูู ูุดู",
      "ูพุฏุฑ ู ูุงุฏุฑ ุฌุงู ุฒูุฏฺฏ ุงูุฏ",
      "ุงุฏุจ ู ุงุฎูุงู ุฑูุฒ ุจุฑูุฏู ุดุฏูู"
    ];
    let motivationIndex = 0;
    function updateMotivation(){
      if(!motivationTextEl) return;
      motivationTextEl.textContent = MOTIVATIONS[motivationIndex];
      motivationIndex = (motivationIndex + 1) % MOTIVATIONS.length;
    }

    // ======== ุณุณุชู ุตุฏุง (ุณุงุฏู) ========
    let soundEnabled = true;
    let audioCtx = null;

    function playTone(freq, duration=0.15, type="square", volume=0.18){
      if(!soundEnabled) return;
      try{
        if(!audioCtx){
          const AC = window.AudioContext || window.webkitAudioContext;
          if(!AC) return;
          audioCtx = new AC();
        }
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, now);
        gain.gain.setValueAtTime(0.001, now);
        gain.gain.exponentialRampToValueAtTime(volume, now+0.01);
        gain.gain.exponentialRampToValueAtTime(0.001, now+duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(now);
        osc.stop(now+duration);
      }catch(e){}
    }

    const sfxShoot   = () => playTone(520, 0.09, "square", 0.2);
    const sfxHit     = () => playTone(200, 0.15, "sawtooth", 0.25);
    const sfxPower   = () => playTone(800, 0.2, "triangle", 0.22);
    const sfxBoss    = () => playTone(140, 0.4, "sawtooth", 0.28);
    const sfxGameOver= () => { playTone(260,0.25,"square",0.22); setTimeout(()=>playTone(180,0.3,"square",0.2),180); };
const sfxShieldBreak = () => {
  // ู ุงูฺฉุช ุฑุฒ ูุซู ุชุฑฺฉ ุดุดู: ู ุชุฒุ ุจุนุฏุด ู ุจูโุชุฑ
  playTone(950, 0.08, "triangle", 0.24);
  setTimeout(() => playTone(420, 0.14, "sawtooth", 0.26), 70);
};

// ุตุฏุง ูุฑฺฏ ุบูู
const sfxBossDie = () => {
    // ุงููุฌุงุฑ ุงูู (ุชุฒ)
    playTone(620, 0.18, "sawtooth", 0.35);

    // ุงููุฌุงุฑ ุฏูู (ุจูโุชุฑ)
    setTimeout(() => {
        playTone(280, 0.28, "square", 0.32);
    }, 150);

    // ุงููุฌุงุฑ ุณูู (ุณููุท ุจู ู ุดุฏุฏ)
    setTimeout(() => {
        playTone(90, 0.45, "square", 0.4);
    }, 300);
};
    
    soundToggleBtn.addEventListener("click", ()=>{
      soundEnabled = !soundEnabled;
      soundToggleBtn.textContent = soundEnabled ? "๐" : "๐";
    });

    // ======== ุชุตุงูุฑ ุชุงูฺฉ ู ุบูู ========
    // ======== ุงุณฺฉูโูุง ุชุงูฺฉ + ุชุตูุฑ ูุนู ========
const TANK_SKINS = {
  default: {
    id: "default",
    name: "ุชุงูฺฉ ุขุจ",
    price: 0,
    gameSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank.webp",
    thumbSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-abi-nama.webp"
  },
  jangal: {
    id: "jangal",
    name: "ุชุงูฺฉ ุฌูฺฏู",
    price: 2500,
    gameSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-jangal-game.webp",
    thumbSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-jangal-nama.webp"
  },
  kavir: {
    id: "kavir",
    name: "ุชุงูฺฉ ฺฉูุฑ",
    price: 2500,
    gameSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-kavir-game.webp",
    thumbSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-kavir-nama.webp"
  },
  pari: {
    id: "pari",
    name: "ุชุงูฺฉ ูพุฑ",
    price: 2500,
    gameSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-pari-game.webp",
    thumbSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-pari-nama.webp"
  },
  papi: {
    id: "papi",
    name: "ุชุงูฺฉ ูพุงูพูู",
    price: 2500,
    gameSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-papi-game.webp",
    thumbSrc: "https://cdnfa.com/irangiah/a9be/uploads/tank/tank-papi-nama.webp"
  }
};

let selectedTankSkinId = "default";
let unlockedTankSkins = ["default"];

const tankImg = new Image();

function applyTankSkin(skinId){
  const skin = TANK_SKINS[skinId] || TANK_SKINS.default;
  selectedTankSkinId = skin.id;
  tankImg.src = skin.gameSrc;
}

// ุงุณฺฉู ูพุดโูุฑุถ
applyTankSkin("default");



    const bossImages = [
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-1.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-2.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-3.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-4.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-5.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-6.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-7.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-8.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-9.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-10.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-11.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-12.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-13.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-14.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-15.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-16.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-17.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-18.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-19.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/boss-20.webp"
];

// ููโุจุงุณโูุง (ุจู ุชุฑุชุจ ฑ ุชุง ฒฐ)
const miniBossImages = [
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss1.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss2.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss3.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss4.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss5.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss6.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss7.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss8.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss9.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss10.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss11.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss12.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss13.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss14.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss15.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss16.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss17.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss18.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss19.webp",
  "https://cdnfa.com/irangiah/a9be/uploads/tank/mini-boss20.webp"
];
    
const bossImg = new Image();

    // ======== ูุถุนุช ุจุงุฒ ========
    let tank = { x:0,y:0,w:60,h:36,speed:4 };
let bullets = [];
let enemies = [];
let powerUps = [];
let particles = [];

let score = 0;
let coins = 0;
let lives = 3;

const MAX_LIVES = 9;
const MAX_SLOW_ITEMS = 7;
const SHOP_PRICES = {
    triple: 300,  // ุดูฺฉ ุณูโุชุง
    rocket: 200,  // ููุดฺฉ
    shield: 150,  // ุณูพุฑ
    life:   750,  // ุฌุงู
    slow:   550   // ุฒูุงู/ฺฉูุฏ ฺฉุฑุฏู
};

// ูุญุฏูุฏุช ุฎุฑุฏ ุฏุงุฎู ูุฑ ุงุฌุฑุง
let lifeBuys = 0;
let slowBuys = 0;
const MAX_LIFE_BUYS = 7;
const MAX_SLOW_BUYS = 7;
    

// ุงูุจุงุฑ ุขุชูโูุง
let inventory = { shield:0, triple:0, rocket:0, slow:0 };
    let rocketArmed = false;   // ุดูฺฉ ุจุนุฏ ููุดฺฉ ุจุงุดุฏ ุง ูู

    let gameRunning = false;
    let lastEnemyTime = 0;
    let lastPowerUpTime = 0;

    let hitFlash = 0;
    let shakeTime = 0;
    let bgOffset = 0;

    let moveLeft = false;
    let moveRight = false;
let isPaused = false;   // ูุถุนุช ุชููู ุจุงุฒ
    
    const badLabels = [
      "ุฏุฑูุบ","ุชููุช","ุบุจุช","ูุฑุฏูโุขุฒุงุฑ","ฺฏุฑุงููุฑูุด","ุจโุงุฏุจ","ุฏุดูุงู","ุชูุจู",
      "ุญุณุงุฏุช","ุจโุญุง","ุจโุญุฌุงุจ","ุชุฑฺฉ ููุงุฒ","ูุถุงูุช","ุฎูุฏฺฉูโุจู","ุฎูุฏุฎูุงู",
      "ูุฌุงุฌุช","ุฎุณุงุณุช","ุญูโุงููุงุณ","ุญูุงูโุขุฒุงุฑ","ููุฑ",
      "ุฑุง","ูุงุงูุฏ","ุชุฑุณ","ฺฉูู","ูพุฑุฎุงุดฺฏุฑ","ุชุนูู","ุจุฏุจู"
    ];

    // ฒฐ ูุฑุญูู
    const LEVELS = [];
    for(let i=1;i<=20;i++){
      LEVELS.push({
        id: i,
        label: `ูุฑุญูู ${i}`,
        goal: 120 + (i-1)*35,
        enemySpeed: 1.6 + (i-1)*0.12,
        spawnInterval: 1100 - (i-1)*35,
        bossName: `ุบูู ูุฑุญูู ${i}`,
        bossHP: 120 + (i-1)*20,
        bossImgIndex: i-1
      });
    }

    let currentLevelIndex = 0;
    let levelGoal = LEVELS[0].goal;
    let spawnInterval = LEVELS[0].spawnInterval;
    let enemyBaseSpeed = LEVELS[0].enemySpeed;

    let bossSpawned = false;
    let bossAlive = false;
let miniBossSpawned = false;
  let inBossFight = false;
    
    const POWER_TYPES = ["shield","triple","slow","rocket"];

    let activePowerUps = { shield:false, triple:false, slow:false };
    let powerTimers = {};

// ุญุฏุงฺฉุซุฑ ูุฑุญููโุง ฺฉู ุจุงุฒ ุดุฏู
function getMaxUnlockedLevelId(){
  const saved = loadState();
  if(!saved) return 1;
  return saved.lastLevel || 1;
}

// ุณุงุฎุช ุฏฺฉููโูุง ูุฑุงุญู (ุจุง ุชุตูุฑ ุบูู ูุฑ ูุฑุญูู)
function buildLevelGrid(){
  if(!levelGrid) return;
  levelGrid.innerHTML = "";

  const maxId = getMaxUnlockedLevelId();

  LEVELS.forEach((lvl, index)=>{
    const btn = document.createElement("button");
    btn.className = "level-btn";

    // ุชุตูุฑ ุบูู ูุฑ ูุฑุญูู
    const img = document.createElement("img");
    img.className = "level-boss-thumb";
    const bossUrl = bossImages[lvl.bossImgIndex] || bossImages[0];
    img.src = bossUrl;
    img.alt = lvl.bossName || lvl.label;

    // ุนููุงู ูุฑุญูู
    const label = document.createElement("span");
    label.className = "level-label";
    label.textContent = lvl.label;

    // ฺุณุจุงูุฏู ุจู ุฏฺฉูู
    btn.appendChild(img);
    btn.appendChild(label);

    // ูุถุนุช ููู / ูุนู
    if(lvl.id > maxId){
      btn.classList.add("locked");
      btn.disabled = true;
    }else{
      if(index === currentLevelIndex){
        btn.classList.add("current");
      }
      btn.addEventListener("click", ()=>{
        levelModal.classList.add("hidden");
        startGame(index);
      });
    }

    levelGrid.appendChild(btn);
  });
}


    // ุจุงุฒ ฺฉุฑุฏู ููุฏุงู ูุฑุงุญู
function openLevelModal(){
  buildLevelGrid();
  levelModal.classList.remove("hidden");
}
    
    const STORAGE_KEY = "tavita_tank_state_v4";

    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return null;
      try{ return JSON.parse(raw); }catch{ return null; }
    }
    function saveState(){
      const prev = loadState() || {};
      const bestScore = Math.max(score, prev.bestScore || 0);
      const data = {
    bestScore,
    lastLevel: LEVELS[currentLevelIndex].id,
    coins,
    inventory,
    selectedTankSkinId,
    unlockedTankSkins
  };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    function applyLoadedState(){
      const saved = loadState();
      if(!saved){
        continueBtn.style.display = "none";
        return;
      }
      continueBtn.style.display = "inline-block";
      coins = saved.coins || 0;
      inventory = saved.inventory || {shield:0,triple:0,rocket:0};
   
      selectedTankSkinId = saved.selectedTankSkinId || "default";
  unlockedTankSkins = saved.unlockedTankSkins || ["default"];
  applyTankSkin(selectedTankSkinId);

  // ุงฺฏุฑ ุฏฺฉููโูุง ุดุงูพ ููุฏ ุดุฏู ุจุงุดูุฏุ UI ุฑู ุขูพุฏุช ฺฉู
  if (typeof refreshShopUI === "function") {
    refreshShopUI();
  }
      coinsEl.textContent = coins;
      updateInventoryUI();
    }

    tankImg.onload = ()=>{
      const ratio = tankImg.naturalHeight / tankImg.naturalWidth || 0.6;
      tank.w = canvas.width * 0.18;
      tank.h = tank.w * ratio;
      tank.x = canvas.width/2 - tank.w/2;
      tank.y = canvas.height - tank.h - 18;
    };

    function updateInventoryUI(){
  shieldCountEl.textContent = inventory.shield || 0;
  rocketCountEl.textContent = inventory.rocket || 0;
  tripleCountEl.textContent = inventory.triple || 0;
  slowCountEl.textContent   = inventory.slow   || 0;

  shieldUseBtn.classList.toggle("disabled", !inventory.shield);
  rocketUseBtn.classList.toggle("disabled", !inventory.rocket);
  tripleUseBtn.classList.toggle("disabled", !inventory.triple);
  slowUseBtn.classList.toggle("disabled",   !inventory.slow);
}

    function createBlobPoints(w,h){
      const pts=[];
      const jitter = 6 + Math.random()*6;
      pts.push({x:0+Math.random()*jitter, y:0+Math.random()*jitter});
      pts.push({x:w*0.5 + (Math.random()*jitter-jitter/2), y:0});
      pts.push({x:w - Math.random()*jitter, y:0+Math.random()*jitter});
      pts.push({x:w, y:h*0.5 + (Math.random()*jitter-jitter/2)});
      pts.push({x:w - Math.random()*jitter, y:h - Math.random()*jitter});
      pts.push({x:w*0.5 + (Math.random()*jitter-jitter/2), y:h});
      pts.push({x:0+Math.random()*jitter, y:h - Math.random()*jitter});
      pts.push({x:0, y:h*0.5 + (Math.random()*jitter-jitter/2)});
      return pts;
    }

    function drawPolygon(x,y,points){
      ctx.beginPath();
      ctx.moveTo(x+points[0].x, y+points[0].y);
      for(let i=1;i<points.length;i++){
        ctx.lineTo(x+points[i].x, y+points[i].y);
      }
      ctx.closePath();
    }

    function rectCircleCollide(cx,cy,cr, rx,ry,rw,rh){
      const testX = Math.max(rx, Math.min(cx, rx+rw));
      const testY = Math.max(ry, Math.min(cy, ry+rh));
      const distX = cx - testX;
      const distY = cy - testY;
      return (distX*distX + distY*distY) <= cr*cr;
    }

    // ูพุณโุฒููู
    function drawBackground(){
      const grad = ctx.createRadialGradient(
        canvas.width/2, canvas.height*0.1, 20,
        canvas.width/2, canvas.height, canvas.height
      );
      grad.addColorStop(0,"#0b1120");
      grad.addColorStop(0.5,"#020617");
      grad.addColorStop(1,"#000");
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.save();
      ctx.strokeStyle = "rgba(56,189,248,0.28)";
      ctx.lineWidth = 1.3;
      ctx.shadowColor = "rgba(56,189,248,0.5)";
      ctx.shadowBlur = 6;
      for(let i=0;i<9;i++){
        const y = (canvas.height - 16) - (i*26) + bgOffset;
        ctx.beginPath();
        ctx.moveTo(0,y);
        ctx.lineTo(canvas.width,y);
        ctx.stroke();
      }
      ctx.restore();
    }

    function drawTank(){
  const {x,y,w,h} = tank;

  // ุฎูุฏ ุชุงูฺฉ
  if (tankImg.complete && tankImg.naturalWidth > 0) {
    ctx.drawImage(tankImg, x, y, w, h);
  } else {
    const grad = ctx.createLinearGradient(x, y, x + w, y + h);
    grad.addColorStop(0, "#38bdf8");
    grad.addColorStop(1, "#0f172a");
    ctx.fillStyle = grad;
    ctx.fillRect(x, y, w, h);
  }

  // ุงูฺฉุช ุณูพุฑ ูพูุงุณูุง / ููุฌโุฏุงุฑ
  if (activePowerUps.shield) {
    const cx = x + w / 2;
    const cy = y + h / 2;
    const baseR = w * 0.95;

    const t = performance.now() / 600; // ุฒูุงู ุจุฑุง ุงููุดู
    const pulse = 0.85 + 0.12 * Math.sin(t * 2);
    const rOuter = baseR * pulse;

    ctx.save();
    ctx.translate(cx, cy);

    // ูุงููโ ุจุฑูู ูุฑู
    const grad = ctx.createRadialGradient(
      0, 0, rOuter * 0.15,
      0, 0, rOuter
    );
    grad.addColorStop(0, "rgba(248,250,252,0.95)");
    grad.addColorStop(0.4, "rgba(56,189,248,0.9)");
    grad.addColorStop(1, "rgba(15,23,42,0)");
    ctx.fillStyle = grad;
    ctx.globalAlpha = 0.9;
    ctx.beginPath();
    ctx.arc(0, 0, rOuter, 0, Math.PI * 2);
    ctx.fill();

    // ฺฉูุงูโูุง ูุฆูู ฺุฑุฎุงู ุฏูุฑ ุชุงูฺฉ
    ctx.globalAlpha = 1;
    ctx.strokeStyle = "rgba(56,189,248,0.96)";
    ctx.lineWidth = 2.2;
    ctx.shadowColor = "rgba(56,189,248,1)";
    ctx.shadowBlur = 18;

    for (let i = 0; i < 3; i++) {
      const angle = t * 1.4 + i * (Math.PI * 2 / 3);
      const start = angle - 0.6;
      const end   = angle + 0.6;

      ctx.beginPath();
      ctx.arc(0, 0, rOuter * 0.78, start, end);
      ctx.stroke();
    }

    ctx.restore();
  }
}

    function drawBullets(){
      bullets.forEach(b=>{
        const grad = ctx.createRadialGradient(b.x,b.y,1,b.x,b.y,b.r);
        grad.addColorStop(0,"#fff");
        grad.addColorStop(1, b.isRocket ? "#22c55e" : "#f97316");
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
        ctx.fill();
      });
    }

    function drawEnemies(){
      enemies.forEach(e=>{
        if (e.isBoss) {
      const { x, y, w, h } = e;

      // ุชุตูุฑ ุบูู
      if (bossImg.complete && bossImg.naturalWidth > 0) {
        const scale = 0.75;
        const iw = w * scale;
        const ih = h * scale;
        const ix = x + (w - iw) / 2;
        const iy = y + (h - ih) / 2;
        ctx.drawImage(bossImg, ix, iy, iw, ih);
      }

      // ๐ฏ ููุงุฑ ุฌูู + ุนุฏุฏุ ุฏููุง ุฒุฑ ุฎูุฏ ุจุงุณ
      const bossHpBar  = document.getElementById("bossHpBar");
      const bossHpFill = document.getElementById("bossHpFill");
      const bossHpText = document.getElementById("bossHpText");

      // ูุณุจุช ุฌูู ูุนู ุจู ุญุฏุงฺฉุซุฑ
      const ratio = Math.max(0, e.hp) / e.maxHp;
      bossHpFill.style.width = (ratio * 100) + "%";

      // ูุชู ูุณุท ููุงุฑ (ูุซูุง 75 / 120)
      const currentHp = Math.max(0, Math.round(e.hp));
      bossHpText.textContent = `${currentHp} / ${e.maxHp}`;

      // ุฌุง ููุงุฑ: ฺฉู ุฒุฑ ุบูู
      const barTop = y + h - 70;
      bossHpBar.style.top = barTop + "px";
      bossHpBar.classList.remove("hidden");

      // ููุท ุงุณู ุบูู ุฑุง ูพุงูุด ุจููุณู
      ctx.fillStyle = "#ffffff";
      ctx.font = "bold 13px Vazir, Vazirmatn, system-ui";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      ctx.fillText(e.bossName, x + w / 2, y + h - 4);

      return;
    }


        else if(e.isMiniBoss){
      const {x,y,w,h} = e;
      if(e.img && e.img.complete && e.img.naturalWidth>0){
        const scale = 0.5;
        const iw = w * scale;
        const ih = h * scale;
        const ix = x + (w - iw)/2;
        const iy = y + (h - ih)/2;
        ctx.drawImage(e.img, ix, iy, iw, ih);
      }else{
        ctx.fillStyle = "#a855f7";
        ctx.fillRect(x,y,w,h);
      }

      ctx.fillStyle = "#ffffff";
      ctx.font = "bold 12px Vazir, Vazirmatn, system-ui";
      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      ctx.fillText("ููโุบูู", x + w/2, y + 4);

      return;
    }
    
        const grad = ctx.createLinearGradient(e.x,e.y,e.x+e.w,e.y+e.h);
        grad.addColorStop(0,e.colorStart);
        grad.addColorStop(1,e.colorEnd);
        ctx.fillStyle = grad;
        ctx.strokeStyle = "rgba(15,23,42,0.9)";
        ctx.lineWidth=2;

        if(e.points){
          drawPolygon(e.x,e.y,e.points);
          ctx.fill(); ctx.stroke();
        }else{
          ctx.fillRect(e.x,e.y,e.w,e.h);
          ctx.strokeRect(e.x,e.y,e.w,e.h);
        }

        ctx.fillStyle="#0f172a";
        ctx.font="bold 12px Vazir, Vazirmatn, system-ui";
        ctx.textAlign="center"; ctx.textBaseline="middle";
        ctx.fillText(e.label, e.x+e.w/2, e.y+e.h/2);
      });
    }

    function drawParticles(){
      ctx.save();
      particles.forEach(p=>{
        ctx.globalAlpha = p.life/p.maxLife;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x,p.y,3,0,Math.PI*2);
        ctx.fill();
      });
      ctx.restore();
    }
    function createExplosion(cx,cy,color){
      for(let i=0;i<12;i++){
        const angle = Math.random()*Math.PI*2;
        const speed = 1 + Math.random()*2.2;
        particles.push({
          x:cx,y:cy,
          vx:Math.cos(angle)*speed,
          vy:Math.sin(angle)*speed,
          life:26,maxLife:26,
          color
        });
      }
    }

    function drawPowerUps(){
      powerUps.forEach(p=>{
        const {x,y,r,type} = p;
        let c1="#a855f7";
        if(type==="shield") c1="#22c55e";
        if(type==="triple") c1="#eab308";
        if(type==="slow")   c1="#38bdf8";
        if(type==="rocket") c1="#f97316";
        const grad = ctx.createRadialGradient(x,y,1,x,y,r);
        grad.addColorStop(0,"#fff");
        grad.addColorStop(1,c1);
        ctx.fillStyle = grad;
        ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();

        ctx.font="bold 11px Vazir, Vazirmatn, system-ui";
        ctx.fillStyle="#020617";
        ctx.textAlign="center"; ctx.textBaseline="middle";
        let icon = "โฌ";
        if(type==="shield") icon="๐ก";
        else if(type==="triple") icon="ร3";
        else if(type==="slow") icon="โณ";
        else if(type==="rocket") icon="๐";
        ctx.fillText(icon, x,y);
      });
    }

function spawnMiniBoss(){
  const lvl = LEVELS[currentLevelIndex];
  const w = canvas.width * 0.30;
const h = canvas.height * 0.22;
  const x = (canvas.width - w) / 2;
  const y = -h - 20;

  const img = new Image();
  const src = miniBossImages[lvl.bossImgIndex] || miniBossImages[0];
  img.src = src;

  // ุฌุงู ููโุจุงุณ: ูู ุฎู ุขุณููุ ูู ุฎู ุณุฎุช (ตโท ุชุฑ)
  const miniHp = 15 + currentLevelIndex * 1; 

  enemies.push({
    x, y, w, h,
    speed: enemyBaseSpeed * 0.95,
    isBoss: false,
    isMiniBoss: true,
    hp: miniHp,                 // ๐ ููู
    colorStart: "#a855f7",      // ุจุฑุง ุงููุฌุงุฑ ูุดูฺฏ
    colorEnd: "#6366f1",
    img
  });
}

    
    function spawnEnemy(isBoss=false){
  if (isBoss) {
    const lvl = LEVELS[currentLevelIndex];
    const w = canvas.width * 0.65;
    const h = canvas.height * 0.52;
    const x = (canvas.width - w) / 2;
    const y = -h - 20;

    enemies.push({
      x, y, w, h,
      speed: enemyBaseSpeed * 0.7,
      isBoss: true,
      bossName: lvl.bossName,
      hp: lvl.bossHP,
      maxHp: lvl.bossHP,          // ๐ ุฎู ููู ุจุฑุง ููุงุฑ
      colorStart: "#f97316"       // ูุงุณู ุฑูฺฏ ุงููุฌุงุฑ ุจุงุณ
    });

    bossAlive   = true;
    inBossFight = true;

    // ๐ฅ ุฑูุดู ฺฉุฑุฏู ููุงุฑ ุฌูู ุจุงุณ
    const bossHpBar  = document.getElementById("bossHpBar");
    const bossHpFill = document.getElementById("bossHpFill");
    bossHpBar.classList.remove("hidden");
    bossHpFill.style.width = "100%";

    const bossImgSrc = bossImages[lvl.bossImgIndex] || bossImages[0];
    bossImg.src = bossImgSrc;

    sfxBoss();
    return;
  }

  // ๐ ุงุฒ ุงูโุฌุง ุจู ุจุนุฏ ูููู ุฏุดููโูุง ูุนูููโุงุช ุจููููุ ุฏุณุช ูุฒู
  const laneCount=5, laneWidth=canvas.width/laneCount;
  const laneIndex=Math.floor(Math.random()*laneCount);
  const w=laneWidth*0.72, h=34;
  const x=laneIndex*laneWidth+(laneWidth-w)/2;
  const y=-h-8;

  const colors=[
    ["#f97316","#fb923c"],
    ["#22c55e","#4ade80"],
    ["#3b82f6","#6366f1"],
    ["#e11d48","#f97316"],
    ["#a855f7","#6366f1"]
  ];
  const pair=colors[Math.floor(Math.random()*colors.length)];
  const label=badLabels[Math.floor(Math.random()*badLabels.length)];

  enemies.push({
    x,y,w,h,
    speed: enemyBaseSpeed + Math.random()*0.8,
    colorStart:pair[0], colorEnd:pair[1],
    label, isBoss:false,
    points:createBlobPoints(w,h)
  });
}

    function spawnPowerUp(){
      const laneCount=5, laneWidth=canvas.width/laneCount;
      const laneIndex=Math.floor(Math.random()*laneCount);
      const x=laneIndex*laneWidth+laneWidth/2;
      powerUps.push({
        x, y:-15, r:13, speed:1.1,
        type: POWER_TYPES[Math.floor(Math.random()*POWER_TYPES.length)]
      });
    }

    function activatePowerUp(type) {
  if (type === "rocket") return; // ููุดฺฉ ุฒูุงูโุฏุงุฑ ูุณุช

  activePowerUps[type] = true;
  sfxPower();

  if (powerTimers[type]) clearTimeout(powerTimers[type]);

  let duration;
  if (type === "shield") {
    // โฑ ุฒูุงู ุณูพุฑ ุฑู ุงูุฌุง ุชูุธู ฺฉู (ุงูุงู 22000ms โ 22 ุซุงูู)
    duration = 18000;
  } else if (type === "triple") {
    duration = 10000;
  } else {
    duration = 8000;
  }

  powerTimers[type] = setTimeout(() => {
    activePowerUps[type] = false;

    if (type === "shield") {
      // โ ููุช ุณูพุฑ ุชููู ูโุดู: ุดูฺฉ ุชุตูุฑ + ุตุฏุง ุชุฑฺฉ ุดุดู
      hitFlash = 0.9;
      shakeTime = 16;
      sfxShieldBreak();
    }
  }, duration);
}

    function fireBullet(){
      if(!gameRunning) return;

      const base = () => ({
        x: tank.x+tank.w/2,
        y: tank.y-6,
        r: 7,
        speed: 6,
        isRocket:false,
        damage:3
      });

      // ุงฺฏุฑ ููุดฺฉ ูุณูุญ ุดุฏู ุจุงุดุฏุ ุดูฺฉ ุจุนุฏ ููุดฺฉ ุงุณุช (ุงูุชุฎุงุจ)
      if(rocketArmed && inventory.rocket > 0){
        const b = base();
        b.isRocket = true;
        b.r = 11;
        b.speed = 7;
        b.damage = 30;
        bullets.push(b);
        inventory.rocket--;
        rocketArmed = false;
        updateInventoryUI();
        saveState();
      }else if(activePowerUps.triple){
        bullets.push(
          {...base(), x:tank.x+tank.w*0.3},
          {...base(), x:tank.x+tank.w*0.5},
          {...base(), x:tank.x+tank.w*0.7}
        );
      }else{
        bullets.push(base());
      }

      if(navigator.vibrate) navigator.vibrate(15);
      sfxShoot();
    }

    
    function flashLifeDanger(){
  if(!lifeDisplay) return;
  lifeDisplay.classList.add("danger");
  setTimeout(()=>lifeDisplay.classList.remove("danger"),700);
}

    let frameId = null;
let levelClearTimer = null;   // ๐ ุชุงูุฑ ุชุงุฎุฑ ูพุงู ูุฑุญูู ุจุนุฏ

    function update(){
      // ุญุฑฺฉุช ุขุฒุงุฏ ุชุงูฺฉ (ููุดูุ ุญุช ุฒูุงู ุจุงุณโูุงุช)
if (moveLeft)  tank.x -= tank.speed;
if (moveRight) tank.x += tank.speed;
tank.x = Math.max(4, Math.min(canvas.width - tank.w - 4, tank.x));

      const enemySpeedFactor = activePowerUps.slow?0.5:1;
      const enemySpawnFactor = activePowerUps.slow?1.5:1;

      bgOffset += 1.4*enemySpeedFactor;
      if(bgOffset>26) bgOffset-=26;

      bullets.forEach(b=> b.y -= b.speed);
      bullets = bullets.filter(b=> b.y+b.r>0);

      enemies.forEach(e=>{
        if(e.isBoss && inBossFight){
          const targetY = canvas.height * 0.16; // ุฌุง ุงุณุชุงุฏู ุบูู

          if(e.y < targetY){
            e.y += e.speed * enemySpeedFactor;
            if(e.y > targetY) e.y = targetY;
          } else {
            e.y = targetY;
          }

        } else {
          e.y += e.speed * enemySpeedFactor;
        }
      });

      powerUps.forEach(p=> p.y += p.speed);
      powerUps = powerUps.filter(p=> p.y-p.r < canvas.height+10);

      particles.forEach(p=>{
        p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.life--;
      });
      particles = particles.filter(p=>p.life>0);

      const now = performance.now();
      const lvl = LEVELS[currentLevelIndex];

if(!miniBossSpawned && score >= lvl.goal * 0.35){
        spawnMiniBoss();
        miniBossSpawned = true;
      }
      
      if(!bossSpawned && score >= lvl.goal*0.65){
        spawnEnemy(true);
        bossSpawned = true;
        inBossFight = true;

        // ุชุงูฺฉ ุฑู ูุณุท ุตูุญู ูุฑุงุฑ ุจุฏู
        tank.x = (canvas.width - tank.w)/2;
      }

      if(now-lastEnemyTime > spawnInterval*enemySpawnFactor){
        spawnEnemy(false);
        lastEnemyTime = now;
      }

      if(now-lastPowerUpTime>8000){
  spawnPowerUp();
  lastPowerUpTime=now;
}

bullets.forEach((b, bi) => {
  enemies.forEach((e, ei) => {
    if (rectCircleCollide(b.x, b.y, b.r, e.x, e.y, e.w, e.h)) {

      // ๐ธ ฺฏูููู ูุตุฑู ุดูุฏ
      bullets.splice(bi, 1);

      // โจ ุงููุฌุงุฑ ูุนููู ุฑู ุฏุดูู
      const cx = e.x + e.w / 2;
      const cy = e.y + e.h / 2;
      createExplosion(cx, cy, e.colorStart || "#f97316");
      sfxHit();

      // ๐งโโ๏ธ ุงฺฏุฑ ุจุงุณ ุจุฒุฑฺฏ ุงุณุช
      if (e.isBoss) {
        // ฺฉู ฺฉุฑุฏู HP ุจุงุณ
        e.hp -= b.damage;

        const bossHpBar  = document.getElementById("bossHpBar");
        const bossHpFill = document.getElementById("bossHpFill");

        // ุงฺฏุฑ ุจู ูุฑ ุฏูู maxHp ูุจูุฏุ ููู ุงูุงู ุชูุธูุด ฺฉู
        if (e.maxHp === undefined) e.maxHp = e.hp;

        // ุขูพุฏุช ุนุฑุถ ููุงุฑ
        if (bossHpFill) {
          bossHpFill.style.width = Math.max(0, (e.hp / e.maxHp) * 100) + "%";
        }

        // ูุฑฺฏ ุจุงุณ
        if (e.hp <= 0) {

          // ุงูฺฉุช ุตูุช ูุฑฺฏ
          sfxBossDie();

          // ุงููุฌุงุฑ / ุฏูุฏ ุจููุด - ุฏููุง ุงุฒ ุฌุง ุฎูุฏ ุบูู
  const boom = document.createElement("div");
  boom.classList.add("boss-death-flash");

  // ูุฑฺฉุฒ ุบูู ุฑู ุญุณุงุจ ฺฉู
  const centerX = e.x + e.w / 2;
  const centerY = e.y + e.h / 2;

  boom.style.left = centerX + "px";
  boom.style.top  = centerY + "px";

  document.body.appendChild(boom);
  setTimeout(() => boom.remove(), 900);

          // ูุฑุฒุด ุตูุญู
          document.body.classList.add("screen-shake");
          setTimeout(() => document.body.classList.remove("screen-shake"), 500);

          // ๐ข ูุฎู ฺฉุฑุฏู ููุงุฑ ุฌูู ุจุงุณ
          if (bossHpBar) bossHpBar.classList.add("hidden");

          // ููุฌ ุถุฑุจู ุฑู ฺฉู ุตูุญู
          hitFlash = 1;
          shakeTime = 45;

          // ุญุฐู ุจุงุณ ู ูพุงุงู ุจุงุณโูุงุช
          enemies.splice(ei, 1);
          bossAlive   = false;
          inBossFight = false;

          // ุงูุชุงุฒ ู ุณฺฉู
          score += 80;
          coins += 40;
          scoreEl.textContent  = score;
          coinsEl.textContent  = coins;
          saveState();
        }

      // ๐งฟ ููโุจุงุณ
      } else if (e.isMiniBoss) {
        e.hp -= b.damage;
        if (e.hp <= 0) {
          enemies.splice(ei, 1);
          score += 30;
          coins += 15;
          scoreEl.textContent = score;
          coinsEl.textContent = coins;
        }

      // ๐งฑ ุฏุดูู ูุนููู
      } else {
        enemies.splice(ei, 1);
        score += 7;
        coins += 3;
        scoreEl.textContent = score;
        coinsEl.textContent = coins;
      }
    }
  });
});

      // ูพุงูุฑุขูพโูุง: ุจู ุงูุจุงุฑ ุงุถุงูู ุดููุฏ (ุงูุชุฎุงุจ)
      powerUps.forEach((p,pi)=>{
  if (rectCircleCollide(p.x,p.y,p.r, tank.x,tank.y,tank.w,tank.h)) {

    // ุงฺฏุฑ slow ุจูุฏ โ ุจุง ุณูู ท ุชุง ุงูุจุงุฑ ุจุดู
    if (p.type === "slow") {
      inventory.slow = Math.min(
        MAX_SLOW_ITEMS,
        (inventory.slow || 0) + 1
      );
    } else {
      // shield / triple / rocket
      inventory[p.type] = (inventory[p.type] || 0) + 1;
    }

    updateInventoryUI();
    sfxPower();
    saveState();
    powerUps.splice(pi,1);
  }
});

      enemies.forEach((e, ei) => {
        const collideWithTank =
          e.x < tank.x + tank.w &&
          e.x + e.w > tank.x &&
          e.y < tank.y + tank.h &&
          e.y + e.h > tank.y;

        const outBottom = e.y + e.h >= canvas.height - 5;

        // ฑ) ุจุฑุฎูุฑุฏ ูุณุชูู ุจุง ุชุงูฺฉ
        if (collideWithTank) {

          // ุงฺฏุฑ ุณูพุฑ ูุนุงูู โ ููุท ูุญุงูุธุชุ ูู ูุงุจูุฏ ฺฉุฑุฏู ุฏุดูู
          if (activePowerUps.shield) {
            const cx = e.x + e.w / 2;
            const cy = e.y + e.h / 2;

            // ุงูฺฉุช ุจุฑุฎูุฑุฏ ุจุง ุณูพุฑ
            createExplosion(cx, cy, "#38bdf8");

            // ฺฉู ุฏุดูู ุฑุง ุจู ุจุงูุง ุจุฑฺฏุฑุฏููุ ุงูฺฏุงุฑ ุงุฒ ุณูพุฑ ุจุฑฺฏุดุชู ุนูุจ
            e.y -= 18;

            // โ ูู ุฌุงู ฺฉู ูุดูุ ูู ุบูู/ุฏุดูู ูพุงฺฉ ูุดู
            return;
          }

          // ุจุฏูู ุณูพุฑ โ ุจุฑุฎูุฑุฏ ุจุงุนุซ ุงุฒ ุฏุณุช ุฏุงุฏู ุฌุงู ูโุดูุฏ
          enemies.splice(ei, 1);

          lives--;
          livesEl.textContent = lives;
          hitFlash = 1;
          shakeTime = e.isBoss ? 12 : 10;
          flashLifeDanger();
          sfxHit();
          if (navigator.vibrate) navigator.vibrate(e.isBoss ? 100 : 80);

          if (lives <= 0) {
            endGame();
            return;
          } else if (e.isBoss) {
    bossAlive = false;
    bossSpawned = false;
    inBossFight = false;   // ๐ ุงู ุฎุท ุฌุฏุฏู
}

        // ฒ) ุฑุณุฏู ุฏุดูู ุจู ฺฉู ุตูุญู (ุฎุท ูพุงู)
        } else if (outBottom) {

    // ุงฺฏุฑ ุณูพุฑ ุฑูุดูู: ุฏุดูู ูููฺ ุงุซุฑ ูุฏุงุฑู
    if (activePowerUps.shield) {
      // ููุท ุงุฒ ุตูุญู ุญุฐูุด ฺฉูุ ุจุฏูู ฺฉู ุดุฏู ุฌูู
      enemies.splice(ei, 1);
      return;
    }

    // ุจุฏูู ุณูพุฑ โ ูุซู ูุจูุ ุจุฑุฎูุฑุฏ ุจุง ุฎุท ูพุงู ุจุงุนุซ ฺฉู ุดุฏู ุฌุงู ูุดู
    enemies.splice(ei, 1);

    lives--;
    livesEl.textContent = lives;
    hitFlash = 1;
    shakeTime = e.isBoss ? 12 : 10;
    flashLifeDanger();
    sfxHit();
    if (navigator.vibrate) navigator.vibrate(e.isBoss ? 100 : 80);

    if (lives <= 0) {
      endGame();
      return;
    } else if (e.isBoss) {
    bossAlive = false;
    bossSpawned = false;
    inBossFight = false;   // ๐ ุงู ุฎุท ุฌุฏุฏู
}
  }
});

      const levelCleared = score >= lvl.goal && bossSpawned && !bossAlive;

// ๐ ููุช ุจุงุณ ูุฑุฏุ ููุท ฺฉ ุจุงุฑ ุชุงูุฑ ฒ.ณ ุซุงููโุง ุจุฒุงุฑ
if (levelCleared && !levelClearTimer) {
  levelClearTimer = setTimeout(() => {
    lives = Math.min(MAX_LIVES, lives + 2);
    livesEl.textContent = lives;

    gameRunning = false;           // ุญุงูุง ุจุงุฒ ุฑู ูุชููู ฺฉู
    saveState();
    levelOverlay.classList.remove("hidden"); // ูพุงู ูุฑุญูู ุจุนุฏ

    levelClearTimer = null;        // ุฑุณุช ุจุฑุง ูุฑุญููโูุง ุจุนุฏ
  }, 2300); // โ ฒ.ณ ุซุงูู
}
    }

    function gameLoop(){
  if(!gameRunning) return;

  // โ ุงฺฏุฑ ุจุงุฒ ุฑู ุชููู ุงุณุชุ ููุท ุญููู ุฑู ุฒูุฏู ูฺฏู ุฏุงุฑ ู ูฺ ูฺฉุด
  if (isPaused) {
    frameId = requestAnimationFrame(gameLoop);
    return;
  }

  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.save();
  if(shakeTime>0){
    const intensity=4;
    ctx.translate((Math.random()*2-1)*intensity,(Math.random()*2-1)*intensity);
    shakeTime--;
  }

  drawBackground();
  update();
  drawEnemies();
  drawPowerUps();
  drawParticles();
  drawBullets();
  drawTank();

  ctx.restore();

  if(hitFlash>0){
    const alpha = hitFlash*0.45;
    const cx=tank.x+tank.w/2, cy=tank.y+tank.h/2;
    const grad=ctx.createRadialGradient(cx,cy,0,cx,cy,canvas.width);
    grad.addColorStop(0,`rgba(248,113,113,${alpha})`);
    grad.addColorStop(1,"rgba(248,113,113,0)");
    ctx.fillStyle=grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);
    hitFlash-=0.05;
  }

  frameId = requestAnimationFrame(gameLoop);
}

    function resetGameState(startFromLevelIndex = 0){
      bullets=[]; enemies=[]; powerUps=[]; particles=[];
      score=0; lives=3;
      bossSpawned=false; bossAlive=false;
  miniBossSpawned=false;
  inBossFight = false;   // โญ ูุฑ ุจุงุฑ ุจุงุฒ ุงุฒ ููุ ุจุงุณโูุงุช ุฎุงููุด ุดูุฏ
      hitFlash=0; shakeTime=0; bgOffset=0;
      rocketArmed=false;

      currentLevelIndex = startFromLevelIndex;
      const lvl = LEVELS[currentLevelIndex];
      levelGoal = lvl.goal;
      spawnInterval = Math.max(550, lvl.spawnInterval);
      enemyBaseSpeed = lvl.enemySpeed;

      levelLabel.textContent = lvl.label;
      scoreEl.textContent = score;
      livesEl.textContent = lives;
      coinsEl.textContent = coins;

      const ratio = tankImg.naturalHeight / tankImg.naturalWidth || 0.6;
      tank.w = canvas.width * 0.18;
      tank.h = tank.w * ratio;
      tank.x = canvas.width/2 - tank.w/2;
      tank.y = canvas.height - tank.h - 18;
    }

    function startGame(fromLevelIndex = 0) {
  if (frameId) cancelAnimationFrame(frameId);

  // โ ุฏุฑ ุดุฑูุน ูุฑ ุจุงุฒุ ููุงุฑ ุฌูู ุจุงุณ ุฑู ฺฉุงูู ูุฎู ฺฉู
  const bossHpBar = document.getElementById("bossHpBar");
  if (bossHpBar) bossHpBar.classList.add("hidden");

  resetGameState(fromLevelIndex);
  startOverlay.classList.add("hidden");
  levelOverlay.classList.add("hidden");
  gameOverOverlay.classList.add("hidden");

  gameRunning = true;
  lastEnemyTime = performance.now();
  lastPowerUpTime = performance.now();
  gameLoop();
}

function endGame() {
  // ฑ) ููุงุฑ ุฌูู ุจุงุณ ุฑุง ฺฉุงูู ูพููุงู ฺฉู
  const bossHpBar  = document.getElementById("bossHpBar");
  const bossHpFill = document.getElementById("bossHpFill");
  const bossHpText = document.getElementById("bossHpText");

  if (bossHpBar) {
    bossHpBar.classList.add("hidden");
    
  }
  if (bossHpFill) bossHpFill.style.width = "100%";
  if (bossHpText) bossHpText.textContent = "";

  // ฒ) ูุถุนุช ุจุงุณ ุฑุง ุฎุงููุด ฺฉู
  bossAlive   = false;
  inBossFight = false;

  // ณ) ุชููู ุจุงุฒ
  gameRunning = false;
  if (frameId) cancelAnimationFrame(frameId);

  // ด) ุงูุชุงุฒ ููุง ู ุจูุชุฑู ุงูุชุงุฒ
  finalScoreEl.textContent = score;
  const saved = loadState();
  const best = Math.max(score, (saved && saved.bestScore) || 0);
  bestScoreEl.textContent = best;
  saveState();

  // ต) ุตุฏุง ฺฏูโุงูุฑ ู ููุงุด ุตูุญู
  sfxGameOver();
  gameOverOverlay.classList.remove("hidden");
}

    // ุฑูุฏุงุฏูุง ุงุตู
    startBtn.addEventListener("click", ()=> startGame(0));

    continueBtn.addEventListener("click", ()=>{
      const saved=loadState();
      if(!saved){ startGame(0); return; }
      const idx=LEVELS.findIndex(l=>l.id===saved.lastLevel);
      startGame(idx>=0?idx:0);
    });

    nextLevelBtn.addEventListener("click", ()=>{
      currentLevelIndex++;
      if(currentLevelIndex>=LEVELS.length) currentLevelIndex=0;
      startGame(currentLevelIndex);
    });



pauseBtn.addEventListener("click", ()=>{
  isPaused = !isPaused;
  pauseBtn.textContent = isPaused ? "โถ๏ธ" : "โธ๏ธ";
});
          
    restartBtn.addEventListener("click", ()=>{
  if(currentLevelIndex > 2){
    currentLevelIndex--;  // ุงุฒ ูุฑุญูู ณ ุจู ุจุนุฏ ฺฉ ุจุฑฺฏุฑุฏู ุนูุจ
  }
  startGame(currentLevelIndex);
});
    
    document.addEventListener("keydown",(e)=>{
      if(e.code==="ArrowLeft") moveLeft=true;
      else if(e.code==="ArrowRight") moveRight=true;
      else if(e.code==="Space"){
        e.preventDefault();
        fireBullet();
      }
    });
    document.addEventListener("keyup",(e)=>{
      if(e.code==="ArrowLeft") moveLeft=false;
      else if(e.code==="ArrowRight") moveRight=false;
    });

    function bindHold(btn, cb){
      const start=(e)=>{e.preventDefault();cb(true);};
      const end=(e)=>{e.preventDefault();cb(false);};
      btn.addEventListener("mousedown",start);
      btn.addEventListener("mouseup",end);
      btn.addEventListener("mouseleave",end);
      btn.addEventListener("touchstart",start,{passive:false});
      btn.addEventListener("touchend",end);
      btn.addEventListener("touchcancel",end);
    }
    bindHold(leftBtn,(v)=> moveLeft=v);
    bindHold(rightBtn,(v)=> moveRight=v);

    // ฺฉูฺฉ / ุชุงฺ ุฑู ยซุดูฺฉยป
fireBtn.addEventListener("click", (e) => {
    e.preventDefault();
    handleDoubleTap();  // ฺฺฉ ุฏุงุจูโฺฉูฺฉ
    fireBullet();       // ุดูฺฉ ูุนููู
});

fireBtn.addEventListener("touchstart", (e) => {
    e.preventDefault();
    handleDoubleTap();  // ุฑู ููุจุงู ูู ุฏุงุจูโุชุงูพ ุญุณุงุจ ูุดู
    fireBullet();       // ุดูฺฉ ูุนููู
}, { passive: false });

    aboutBtn.addEventListener("click", ()=> aboutModal.classList.remove("hidden"));
aboutCloseBtn.addEventListener("click", ()=> aboutModal.classList.add("hidden"));

helpBtn.addEventListener("click", ()=> helpModal.classList.remove("hidden"));
helpCloseBtn.addEventListener("click", ()=> helpModal.classList.add("hidden"));

shopBtn.addEventListener("click", ()=>{
  shopModal.classList.remove("hidden");
  refreshShopUI();
});
shopCloseBtn.addEventListener("click", ()=> shopModal.classList.add("hidden"));

// ุฏฺฉูู ยซูุฑุงุญู ุจุงุฒยป ุฏุฑ ุตูุญู ุดุฑูุน
if(levelsBtn){
  levelsBtn.addEventListener("click", openLevelModal);
}

// ฺฉูฺฉ ุฑู ฺฉุงุฏุฑ ยซูุฑุญูู: ...ยป ุฏุฑ HUD
if(levelBadge){
  levelBadge.addEventListener("click", openLevelModal);
}

// ุจุณุชู ููุฏุงู ูุฑุงุญู
if(levelCloseBtn){
  levelCloseBtn.addEventListener("click", ()=>{
    levelModal.classList.add("hidden");
  });
}
    
    function refreshShopUI(){
  shopCoinsEl.textContent = coins;

  // ููุชโูุง ุจุฑ ุงุณุงุณ SHOP_PRICES
  buyTripleBtn.disabled = coins < SHOP_PRICES.triple;
  buyRocketBtn.disabled = coins < SHOP_PRICES.rocket;
  buyShieldBtn.disabled = coins < SHOP_PRICES.shield;

  // ุฌุงู: ุชุง ููุช ูู ุณฺฉู ฺฉุงู ุฏุงุฑุ ูู ุฌุงู ุจู ุณูู ูุฑุณุฏู ู ูู ฺฉูุชุฑ ุงุฒ ท ุจุงุฑ ุฎุฑุฏ ฺฉุฑุฏ
  buyLifeBtn.disabled =
    coins < SHOP_PRICES.life ||
    lifeBuys >= MAX_LIFE_BUYS ||
    lives >= MAX_LIVES;

  // ุฒูุงู: ูู ุณฺฉูุ ูู ุณูู ุขุชู ุงูุจุงุฑุ ูู ุณูู ุฎุฑุฏ
  buySlowBtn.disabled =
    coins < SHOP_PRICES.slow ||
    slowBuys >= MAX_SLOW_BUYS ||
    inventory.slow >= MAX_SLOW_ITEMS;

// ุงุณฺฉูโูุง ุชุงูฺฉ
  tankSkinButtons.forEach(btn => {
    const id = btn.dataset.skinId;
    const skin = TANK_SKINS[id];
    if (!skin) return;

    if (id === selectedTankSkinId) {
      btn.textContent = "ุงูุชุฎุงุจ ุดุฏู โ";
      btn.disabled = true;
    } else if (unlockedTankSkins.includes(id)) {
      btn.textContent = "ุงูุชุฎุงุจ ๐ฏ";
      btn.disabled = false;
    } else {
      btn.textContent = `ุฎุฑุฏ ${skin.price} ๐ช`;
      btn.disabled = coins < skin.price;
    }
  });
}
    
    // ุฎุฑุฏ ุขุชูโูุง -> ููุท ุจู ุงูุจุงุฑ ุงุถุงูู ูโุดููุฏ
    // ุฎุฑุฏ ุดูฺฉ ุณูโุชุง
buyTripleBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.triple) return;
  coins -= SHOP_PRICES.triple;
  coinsEl.textContent = coins;
  inventory.triple = (inventory.triple || 0) + 1;
  updateInventoryUI();
  saveState();
  refreshShopUI();
});

// ุฎุฑุฏ ููุดฺฉ
buyRocketBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.rocket) return;
  coins -= SHOP_PRICES.rocket;
  coinsEl.textContent = coins;
  inventory.rocket = (inventory.rocket || 0) + 1;
  updateInventoryUI();
  saveState();
  refreshShopUI();
});

// ุฎุฑุฏ ุณูพุฑ
buyShieldBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.shield) return;
  coins -= SHOP_PRICES.shield;
  coinsEl.textContent = coins;
  inventory.shield = (inventory.shield || 0) + 1;
  updateInventoryUI();
  saveState();
  refreshShopUI();
});

// ุฎุฑุฏ ุฌุงู
buyLifeBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.life) return;
  if(lifeBuys >= MAX_LIFE_BUYS) return;
  if(lives >= MAX_LIVES) return;

  coins -= SHOP_PRICES.life;
  coinsEl.textContent = coins;

  lives = Math.min(MAX_LIVES, lives + 1);
  livesEl.textContent = lives;

  lifeBuys++;
  saveState();
  refreshShopUI();
});

// ุฎุฑุฏ ูพุงูุฑุขูพ ุฒูุงู (slow)
buySlowBtn.addEventListener("click", ()=>{
  if(coins < SHOP_PRICES.slow) return;
  if(slowBuys >= MAX_SLOW_BUYS) return;
  if(inventory.slow >= MAX_SLOW_ITEMS) return;

  coins -= SHOP_PRICES.slow;
  coinsEl.textContent = coins;

  inventory.slow = Math.min(
    MAX_SLOW_ITEMS,
    (inventory.slow || 0) + 1
  );

  slowBuys++;
  updateInventoryUI();
  saveState();
  refreshShopUI();
});

// ุฎุฑุฏ / ุงูุชุฎุงุจ ุงุณฺฉูโูุง ุชุงูฺฉ
tankSkinButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const id = btn.dataset.skinId;
    const skin = TANK_SKINS[id];
    if (!skin) return;

    // ุงฺฏุฑ ูุจูุงู ุจุงุฒ ุดุฏู โ ููุท ุงูุชุฎุงุจ
    if (unlockedTankSkins.includes(id)) {
      applyTankSkin(id);
      saveState();
      refreshShopUI();
      return;
    }

    // ุฎุฑุฏ ุงุณฺฉู
    if (coins < skin.price) return;
    coins -= skin.price;
    coinsEl.textContent = coins;

    unlockedTankSkins.push(id);
    applyTankSkin(id);
    saveState();
    refreshShopUI();
  });
});

    
    // ุงุณุชูุงุฏู ุงูุชุฎุงุจ ุงุฒ ุขุชูโูุง
    shieldUseBtn.addEventListener("click", ()=>{
      if(!gameRunning) return;
      if(inventory.shield>0 && !activePowerUps.shield){
        inventory.shield--;
        updateInventoryUI();
        activatePowerUp("shield");
        saveState();
      }
    });

    tripleUseBtn.addEventListener("click", ()=>{
      if(!gameRunning) return;
      if(inventory.triple>0 && !activePowerUps.triple){
        inventory.triple--;
        updateInventoryUI();
        activatePowerUp("triple");
        saveState();
      }
    });

    rocketUseBtn.addEventListener("click", ()=>{
      if(!gameRunning) return;
      if(inventory.rocket>0){
        rocketArmed = true; // ุดูฺฉ ุจุนุฏ ููุดฺฉ ุงุณุช
        if(navigator.vibrate) navigator.vibrate(30);
      }
    });

slowUseBtn.addEventListener("click", ()=>{
    if(!gameRunning) return;
    if(inventory.slow > 0 && !activePowerUps.slow){
        inventory.slow--;
        updateInventoryUI();
        activatePowerUp("slow");
        saveState();
    }
});
    
    // ุดุฑูุน ุงููู
    resetGameState(0);
    drawBackground(); drawTank();
    applyLoadedState();
    updateInventoryUI();
    updateMotivation();
    setInterval(updateMotivation, 10000);

// --- ุญุฑฺฉุช ุจุง ุงูฺฏุดุช (Touch Move) ---
let isTouching = false;

canvas.addEventListener("touchstart", (e) => {
  if (!gameRunning) return;
  isTouching = true;
  handleTouchMove(e);
});

canvas.addEventListener("touchmove", (e) => {
  if (!isTouching || !gameRunning) return;
  e.preventDefault();
  handleTouchMove(e);
}, { passive: false });

canvas.addEventListener("touchend", () => {
  isTouching = false;
});

function handleTouchMove(e) {
  const rect = canvas.getBoundingClientRect();
  const touchX = e.touches[0].clientX - rect.left;

  // ูุฑฺฉุฒ ุชุงูฺฉ ุฑุง ุจู ูููุนุช ุงูฺฏุดุช ุจุจุฑ
  tank.x = touchX - tank.w / 2;

  // ุฌููฺฏุฑ ุงุฒ ุฎุฑูุฌ ุชุงูฺฉ ุงุฒ ูุจูโูุง
  if (tank.x < 4) tank.x = 4;
  if (tank.x + tank.w > canvas.width - 4) {
    tank.x = canvas.width - tank.w - 4;
  }
}
    
  </script>

</body>
</html>
